{"version":3,"file":"ExtendLease-f2dde26f.js","sources":["../../src/components/layout/ExtendLease/ExtendLease.tsx"],"sourcesContent":["import { AoArNSNameData, isLeasedArNSRecord, mIOToken } from '@ar.io/sdk/web';\nimport WarningCard from '@src/components/cards/WarningCard/WarningCard';\nimport { getTransactionDescription } from '@src/components/pages/Transaction/transaction-descriptions';\nimport { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { ArweaveTransactionID } from '../../../services/arweave/ArweaveTransactionID';\nimport { useGlobalState } from '../../../state/contexts/GlobalState';\nimport { useTransactionState } from '../../../state/contexts/TransactionState';\nimport { useWalletState } from '../../../state/contexts/WalletState';\nimport {\n  ARNS_INTERACTION_TYPES,\n  ExtendLeasePayload,\n  TRANSACTION_TYPES,\n} from '../../../types';\nimport {\n  formatDate,\n  getLeaseDurationFromEndTimestamp,\n  lowerCaseDomain,\n  sleep,\n} from '../../../utils';\nimport {\n  ARNS_REGISTRY_ADDRESS,\n  MAX_LEASE_DURATION,\n  MIN_LEASE_DURATION,\n  YEAR_IN_MILLISECONDS,\n} from '../../../utils/constants';\nimport eventEmitter from '../../../utils/events';\nimport { InfoIcon } from '../../icons';\nimport Counter from '../../inputs/Counter/Counter';\nimport WorkflowButtons from '../../inputs/buttons/WorkflowButtons/WorkflowButtons';\nimport DialogModal from '../../modals/DialogModal/DialogModal';\nimport TransactionCost from '../TransactionCost/TransactionCost';\nimport PageLoader from '../progress/PageLoader/PageLoader';\n\nfunction ExtendLease() {\n  // TODO: remove use of source contract\n  const [{ ioTicker, arioContract }] = useGlobalState();\n  const [{ walletAddress }] = useWalletState();\n  const [, dispatchTransactionState] = useTransactionState();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const name = location.pathname.split('/').at(-2);\n  const [record, setRecord] = useState<AoArNSNameData>();\n  const [registrationType, setRegistrationType] = useState<TRANSACTION_TYPES>();\n  const [newLeaseDuration, setNewLeaseDuration] = useState<number>(1);\n  const [maxIncrease, setMaxIncrease] = useState<number>(0);\n  const [ioFee, setIoFee] = useState<number | undefined>();\n  const [ioBalance, setIoBalance] = useState<number>(0);\n\n  useEffect(() => {\n    if (!name) {\n      navigate(`/manage/names`);\n      return;\n    }\n    onLoad(lowerCaseDomain(name));\n  }, [name]);\n\n  useEffect(() => {\n    if (!record || !name || !isLeasedArNSRecord(record)) {\n      return;\n    }\n\n    setIoFee(undefined);\n    const updateIoFee = async () => {\n      const price = await arioContract\n        .getTokenCost({\n          intent: 'Extend-Lease',\n          name: name,\n          years: newLeaseDuration,\n        })\n        .then((p) => new mIOToken(p).toIO().valueOf());\n      setIoFee(price);\n    };\n    updateIoFee();\n  }, [newLeaseDuration, maxIncrease, record, name]);\n\n  async function onLoad(domain: string) {\n    try {\n      // TODO: make this generic so we get back the correct type\n\n      const domainRecord = await arioContract.getArNSRecord({\n        name: lowerCaseDomain(domain),\n      });\n      if (!domainRecord) {\n        throw new Error(`Unable to get record for ${domain}`);\n      }\n      setRegistrationType(domainRecord.type as TRANSACTION_TYPES);\n      setRecord(domainRecord);\n\n      if (!isLeasedArNSRecord(domainRecord)) {\n        setRegistrationType(TRANSACTION_TYPES.BUY);\n        return;\n      }\n\n      if (!walletAddress) {\n        // TODO: navigate to connect\n        throw new Error('Wallet address not found');\n      }\n\n      const balance = await arioContract.getBalance({\n        address: walletAddress.toString(),\n      });\n      setIoBalance(balance ?? 0);\n\n      setMaxIncrease(\n        Math.max(\n          0,\n          MAX_LEASE_DURATION -\n            getLeaseDurationFromEndTimestamp(\n              domainRecord.startTimestamp,\n              domainRecord.endTimestamp,\n            ),\n        ),\n      );\n    } catch (error) {\n      eventEmitter.emit('error', error);\n      // sleep 2000 to make page transition less jarring\n      await sleep(2000);\n      navigate(`/manage/names`);\n    }\n  }\n\n  if (!record || !name) {\n    return (\n      <PageLoader loading={!record} message={`Loading info for ${name}`} />\n    );\n  }\n\n  if (\n    !isLeasedArNSRecord(record) ||\n    registrationType === TRANSACTION_TYPES.BUY\n  ) {\n    return (\n      <div className=\"page center\">\n        <DialogModal\n          showClose={false}\n          cancelText=\"Manage\"\n          body={\n            <span\n              className=\"flex flex-column white center\"\n              style={{\n                height: '100%',\n              }}\n            >\n              This domain is permanently registered and its lease cannot be\n              extended.\n            </span>\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"page center\">\n      <div className=\"flex flex-column\" style={{ maxWidth: '1000px' }}>\n        <div\n          className=\"flex flex-row center\"\n          style={{ justifyContent: 'space-between' }}\n        >\n          <h1 className=\"white\">Extend Lease</h1>\n\n          <div\n            className=\"flex flex-row center white\"\n            style={{\n              border: 'solid 1px var(--text-faded)',\n              borderRadius: 'var(--corner-radius)',\n              gap: '8px',\n              width: 'fit-content',\n              padding: '12px',\n            }}\n          >\n            <InfoIcon width={'22px'} height={'22px'} fill=\"var(--text-grey)\" />\n            Expiring on {formatDate(record.endTimestamp)}\n          </div>\n        </div>\n        <div\n          className=\"flex flex-column\"\n          style={{\n            width: '100%',\n            height: '100%',\n            background: 'var(--card-bg)',\n            borderRadius: 'var(--corner-radius)',\n            padding: '30px',\n            boxSizing: 'border-box',\n            position: 'relative',\n          }}\n        >\n          {/* maxxed out duration overlay */}\n          {maxIncrease < 1 ? (\n            <div\n              className=\"flex flex-column center modal-container\"\n              style={{\n                position: 'absolute',\n                top: '0',\n                left: '0',\n                width: '100%',\n                height: '100%',\n                background: 'rgba(0,0,0,0.5)',\n                borderRadius: 'var(--corner-radius)',\n                zIndex: 1,\n              }}\n            >\n              <div\n                className=\"flex flex-row center\"\n                style={{\n                  width: 'fit-content',\n                  height: 'fit-content',\n                  borderRadius: 'var(--corner-radius)',\n                  border: 'solid 1px var(--error-red)',\n                  background: '#1D1314',\n                  padding: '10px',\n                  boxSizing: 'border-box',\n                  color: 'var(--error-red)',\n                  gap: '10px',\n                }}\n              >\n                {' '}\n                <InfoIcon\n                  width={'24px'}\n                  height={'24px'}\n                  fill=\"var(--error-red)\"\n                />\n                <span className=\"center\">Maximum lease extension reached</span>\n              </div>\n            </div>\n          ) : (\n            <></>\n          )}\n          <Counter\n            setValue={setNewLeaseDuration}\n            value={newLeaseDuration}\n            maxValue={maxIncrease}\n            minValue={MIN_LEASE_DURATION}\n            valueName={newLeaseDuration > 1 ? 'years' : 'year'}\n            valueStyle={{ padding: '10px 80px' }}\n            detail={\n              <span>\n                until{' '}\n                {formatDate(\n                  record.endTimestamp + newLeaseDuration * YEAR_IN_MILLISECONDS,\n                )}\n              </span>\n            }\n            title={\n              <span\n                className=\"white\"\n                style={{ padding: '0px 10px 10px 10px', fontWeight: '500' }}\n              >{`Extension Duration ( up to ${Math.max(1, maxIncrease)} year${\n                maxIncrease > 1 ? 's' : ''\n              } )`}</span>\n            }\n          />\n        </div>\n        {/* TODO: [PE-4563] implement contract read api for extend record */}\n        <TransactionCost\n          feeWrapperStyle={{\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '100%',\n          }}\n          fee={{\n            [ioTicker]: ioFee,\n          }}\n          ioRequired={true}\n          info={\n            <div>\n              <WarningCard\n                wrapperStyle={{\n                  padding: '10px',\n                  fontSize: '14px',\n                  alignItems: 'center',\n                }}\n                customIcon={<InfoIcon width={'20px'} fill={'var(--accent)'} />}\n                text={\n                  getTransactionDescription({\n                    workflowName: ARNS_INTERACTION_TYPES.EXTEND_LEASE,\n                    ioTicker,\n                  }) || ''\n                }\n              />\n            </div>\n          }\n        />\n        <WorkflowButtons\n          backText=\"Cancel\"\n          nextText=\"Continue\"\n          customNextStyle={{\n            background: maxIncrease < 1 && 'var(--text-grey)',\n            color: maxIncrease < 1 && 'var(--text-white)',\n          }}\n          onBack={() => {\n            navigate(`/manage/names/${lowerCaseDomain(name)}`);\n          }}\n          onNext={\n            !ioFee || ioFee < 0\n              ? undefined\n              : maxIncrease >= 1 || ioFee <= ioBalance\n              ? () => {\n                  const payload: ExtendLeasePayload = {\n                    name,\n                    years: newLeaseDuration,\n                    processId: new ArweaveTransactionID(record.processId),\n                    qty: ioFee,\n                  };\n\n                  dispatchTransactionState({\n                    type: 'setInteractionType',\n                    payload: ARNS_INTERACTION_TYPES.EXTEND_LEASE,\n                  });\n                  dispatchTransactionState({\n                    type: 'setTransactionData',\n                    payload: {\n                      assetId: ARNS_REGISTRY_ADDRESS.toString(),\n                      functionName: 'extendRecord',\n                      ...payload,\n                      arnsRecord: record,\n                      interactionPrice: ioFee,\n                    },\n                  });\n                  dispatchTransactionState({\n                    type: 'setWorkflowName',\n                    payload: ARNS_INTERACTION_TYPES.EXTEND_LEASE,\n                  });\n                  navigate('/transaction/review', {\n                    state: `/manage/names/${lowerCaseDomain(name)}/extend`,\n                  });\n                }\n              : undefined\n          }\n          detail={\n            ioFee && ioFee > ioBalance && maxIncrease > 0 ? (\n              <div\n                className=\"flex flex-row center\"\n                style={{\n                  width: 'fit-content',\n                  height: 'fit-content',\n                  borderRadius: 'var(--corner-radius)',\n                  border: 'solid 1px var(--error-red)',\n                  background: '#1D1314',\n                  padding: '8px',\n                  boxSizing: 'border-box',\n                  color: 'var(--error-red)',\n                  gap: '10px',\n                  whiteSpace: 'nowrap',\n                  fontSize: '13px',\n                }}\n              >\n                {' '}\n                <InfoIcon\n                  width={'24px'}\n                  height={'24px'}\n                  fill=\"var(--error-red)\"\n                />\n                <span className=\"center\">Insufficient funds.</span>\n              </div>\n            ) : (\n              <></>\n            )\n          }\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default ExtendLease;\n"],"names":["ExtendLease","ioTicker","arioContract","useGlobalState","walletAddress","useWalletState","dispatchTransactionState","useTransactionState","location","useLocation","navigate","useNavigate","name","record","setRecord","reactExports","registrationType","setRegistrationType","newLeaseDuration","setNewLeaseDuration","maxIncrease","setMaxIncrease","ioFee","setIoFee","ioBalance","setIoBalance","onLoad","lowerCaseDomain","isLeasedArNSRecord","price","p","mIOToken","domain","domainRecord","TRANSACTION_TYPES","balance","MAX_LEASE_DURATION","getLeaseDurationFromEndTimestamp","error","eventEmitter","sleep","jsxRuntimeExports","PageLoader","DialogModal","SvgInfo","formatDate","Counter","MIN_LEASE_DURATION","YEAR_IN_MILLISECONDS","TransactionCost","WarningCard","getTransactionDescription","ARNS_INTERACTION_TYPES","WorkflowButtons","payload","ArweaveTransactionID","ARNS_REGISTRY_ADDRESS"],"mappings":"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"}
{"version":3,"file":"UpgradeUndernames-f829e5d7.js","sources":["../../src/hooks/useIncreaseUndernameCost.tsx","../../src/components/layout/UpgradeUndernames/UpgradeUndernames.tsx"],"sourcesContent":["import { useGlobalState } from '@src/state';\nimport { useQuery } from '@tanstack/react-query';\n\nexport function useIncreaseUndernameCost({\n  name,\n  quantity,\n}: {\n  name: string;\n  quantity: number;\n}) {\n  const [{ ioProcessId, arioContract }] = useGlobalState();\n  return useQuery({\n    queryKey: ['increaseUndernameCost', quantity, ioProcessId.toString()],\n    queryFn: async () => {\n      return await arioContract.getTokenCost({\n        intent: 'Increase-Undername-Limit',\n        quantity,\n        name,\n      });\n    },\n    staleTime: 1000 * 60 * 5,\n  });\n}\n","import { ANT, AoArNSNameData, mIOToken } from '@ar.io/sdk/web';\nimport WarningCard from '@src/components/cards/WarningCard/WarningCard';\nimport { getTransactionDescription } from '@src/components/pages/Transaction/transaction-descriptions';\nimport { useIncreaseUndernameCost } from '@src/hooks/useIncreaseUndernameCost';\nimport { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { useIsMobile } from '../../../hooks';\nimport { ArweaveTransactionID } from '../../../services/arweave/ArweaveTransactionID';\nimport { useGlobalState } from '../../../state/contexts/GlobalState';\nimport { useTransactionState } from '../../../state/contexts/TransactionState';\nimport {\n  ARNS_INTERACTION_TYPES,\n  IncreaseUndernamesPayload,\n} from '../../../types';\nimport { isARNSDomainNameValid, lowerCaseDomain } from '../../../utils';\nimport { MAX_UNDERNAME_COUNT } from '../../../utils/constants';\nimport eventEmitter from '../../../utils/events';\nimport { InfoIcon } from '../../icons';\nimport Counter from '../../inputs/Counter/Counter';\nimport WorkflowButtons from '../../inputs/buttons/WorkflowButtons/WorkflowButtons';\nimport Loader from '../Loader/Loader';\nimport TransactionCost from '../TransactionCost/TransactionCost';\n\nfunction UpgradeUndernames() {\n  const isMobile = useIsMobile();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [{ arweaveDataProvider, ioTicker, ioProcessId }] = useGlobalState();\n  const name = location.pathname.split('/').at(-2);\n  const [, dispatchTransactionState] = useTransactionState();\n  const [record, setRecord] = useState<AoArNSNameData>();\n  const [antContract, setAntContract] = useState<ANT>();\n  const [undernameCount, setUndernameCount] = useState<number>(0);\n  // min count of 1 ~ contract rule\n  const [newUndernameCount, setNewUndernameCount] = useState<number>(0);\n\n  const { data: fee } = useIncreaseUndernameCost({\n    name: lowerCaseDomain(name ?? ''),\n    quantity: newUndernameCount,\n  });\n  const [loading, setLoading] = useState<boolean>(false);\n\n  useEffect(() => {\n    onLoad();\n  }, [name]);\n\n  async function onLoad() {\n    try {\n      setLoading(true);\n      if (name && isARNSDomainNameValid({ name: lowerCaseDomain(name) })) {\n        const record = await arweaveDataProvider.getRecord({\n          domain: lowerCaseDomain(name),\n        });\n        if (!record) {\n          throw new Error(`Unable to get record for ${name}`);\n        }\n        setRecord(record);\n        const processId = new ArweaveTransactionID(record?.processId);\n        const contract = ANT.init({\n          processId: processId.toString(),\n        });\n        const existingUndernameCount = await contract.getRecords().then((r) => {\n          return Object.keys(r).filter((k) => k !== '@').length; // exclude @ record\n        });\n        setUndernameCount(existingUndernameCount);\n        setAntContract(contract);\n      }\n    } catch (error) {\n      eventEmitter.emit('error', error);\n      navigate(`/manage/names`);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (loading || !record || !antContract || !name) {\n    return (\n      <div className=\"page center\">\n        <Loader size={80} message=\"Loading domain record\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"page center\">\n      <div className=\"flex flex-column\" style={{ maxWidth: '1000px' }}>\n        <h1 className=\"flex white text-[2rem]\">Increase Undernames</h1>\n        <div\n          className=\"flex center\"\n          style={{\n            justifyContent: 'space-between',\n            border: '1px solid var(--text-faded)',\n            padding: '35px 40px',\n            borderRadius: 'var(--corner-radius)',\n            flexDirection: isMobile ? 'column' : 'row',\n            gap: '30px',\n          }}\n        >\n          <div\n            className=\"flex flex-column\"\n            style={{ fontSize: '16px', width: 'fit-content', gap: '5px' }}\n          >\n            <span\n              className=\"flex grey center\"\n              style={{ gap: '8px', whiteSpace: 'nowrap' }}\n            >\n              Total Undernames:{' '}\n              <span className=\"white\">{record.undernameLimit}</span>\n              <span className=\"flex add-box center\" style={{}}>\n                +{newUndernameCount}\n              </span>\n            </span>\n            <span className=\"flex grey\">\n              Used:&nbsp;\n              <span className=\"white\"> {undernameCount}</span>\n            </span>\n          </div>\n          <Counter\n            maxValue={MAX_UNDERNAME_COUNT - record.undernameLimit}\n            minValue={0}\n            value={newUndernameCount}\n            setValue={setNewUndernameCount}\n            containerStyle={{\n              width: 'fit-content',\n              justifyContent: 'center',\n              alignItems: 'center',\n            }}\n            valueStyle={{\n              background: 'var(--card-bg)',\n              width: '50px',\n              height: '40px',\n              alignItems: 'center',\n              justifyContent: 'center',\n              border: '1px solid var(--text-faded)',\n              borderRadius: 'var(--corner-radius)',\n              margin: '0px 10px',\n              fontSize: '14px',\n            }}\n            editable={true}\n          />\n        </div>\n        <TransactionCost\n          feeWrapperStyle={{\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '100%',\n          }}\n          ioRequired={true}\n          fee={{\n            [ioTicker]:\n              newUndernameCount === 0\n                ? 0\n                : fee\n                ? new mIOToken(fee).toIO().valueOf()\n                : undefined,\n            ar: 0,\n          }}\n          info={\n            <div>\n              <WarningCard\n                wrapperStyle={{\n                  padding: '10px',\n                  fontSize: '14px',\n                  alignItems: 'center',\n                }}\n                customIcon={<InfoIcon width={'20px'} fill={'var(--accent)'} />}\n                text={\n                  getTransactionDescription({\n                    workflowName: ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                    ioTicker,\n                  }) || ''\n                }\n              />\n            </div>\n          }\n        />\n        <WorkflowButtons\n          backText=\"Cancel\"\n          nextText=\"Confirm\"\n          onBack={() => navigate(`/manage/names/${lowerCaseDomain(name)}`)}\n          onNext={\n            !fee || fee < 0\n              ? undefined\n              : () => {\n                  const increaseUndernamePayload: IncreaseUndernamesPayload = {\n                    name: lowerCaseDomain(name),\n                    qty: newUndernameCount,\n                    oldQty: record.undernameLimit,\n                    processId: record.processId,\n                  };\n                  dispatchTransactionState({\n                    type: 'setTransactionData',\n                    payload: {\n                      assetId: ioProcessId,\n                      functionName: 'increaseundernameLimit',\n                      ...increaseUndernamePayload,\n                      interactionPrice: new mIOToken(fee).toIO().valueOf(),\n                    },\n                  });\n                  dispatchTransactionState({\n                    type: 'setInteractionType',\n                    payload: ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                  });\n                  dispatchTransactionState({\n                    type: 'setWorkflowName',\n                    payload: ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                  });\n                  // navigate to the transaction page, which will load the updated state of the transaction context\n                  navigate('/transaction/review', {\n                    state: `/manage/names/${lowerCaseDomain(\n                      name,\n                    )}/upgrade-undernames`,\n                  });\n                }\n          }\n          customBackStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n          customNextStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default UpgradeUndernames;\n"],"names":["useIncreaseUndernameCost","name","quantity","ioProcessId","arioContract","useGlobalState","useQuery","UpgradeUndernames","isMobile","useIsMobile","location","useLocation","navigate","useNavigate","arweaveDataProvider","ioTicker","dispatchTransactionState","useTransactionState","record","setRecord","reactExports","antContract","setAntContract","undernameCount","setUndernameCount","newUndernameCount","setNewUndernameCount","fee","lowerCaseDomain","loading","setLoading","onLoad","isARNSDomainNameValid","record2","processId","ArweaveTransactionID","contract","ANT","existingUndernameCount","r","k","error","eventEmitter","jsxRuntimeExports","Loader","Counter","MAX_UNDERNAME_COUNT","TransactionCost","mIOToken","WarningCard","SvgInfo","getTransactionDescription","ARNS_INTERACTION_TYPES","WorkflowButtons","increaseUndernamePayload"],"mappings":"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"}
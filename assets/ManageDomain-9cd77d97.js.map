{"version":3,"file":"ManageDomain-9cd77d97.js","sources":["../../src/components/pages/ManageDomain/ManageDomain.tsx"],"sourcesContent":["import { ArNSBaseNameData, ArNSLeaseData } from '@ar.io/sdk/web';\nimport TransactionSuccessCard from '@src/components/cards/TransactionSuccessCard/TransactionSuccessCard';\nimport DomainSettings from '@src/components/forms/DomainSettings/DomainSettings';\nimport useDomainInfo from '@src/hooks/useDomainInfo';\nimport { useTransactionState } from '@src/state/contexts/TransactionState';\nimport { Tooltip } from 'antd';\nimport { useEffect, useState } from 'react';\nimport { useLocation, useNavigate, useParams } from 'react-router-dom';\n\nimport { useWalletState } from '../../../state/contexts/WalletState';\nimport { getLeaseDurationFromEndTimestamp } from '../../../utils';\nimport {\n  MAX_LEASE_DURATION,\n  MAX_UNDERNAME_COUNT,\n} from '../../../utils/constants';\nimport eventEmitter from '../../../utils/events';\nimport { HamburgerOutlineIcon } from '../../icons';\nimport './styles.css';\n\nfunction ManageDomain() {\n  const { name } = useParams();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [{ walletAddress }] = useWalletState();\n  const [isMaxLeaseDuration, setIsMaxLeaseDuration] = useState<boolean>(false);\n  const [isMaxUndernameCount, setIsMaxUndernameCount] =\n    useState<boolean>(false);\n  const [undernameCount, setUndernameCount] = useState<number>();\n  const [loading, setLoading] = useState<boolean>(true);\n\n  const { data, isLoading: isLoadingDomainDetails } = useDomainInfo({\n    domain: name,\n  });\n  const [{ workflowName, interactionResult }, dispatchTransactionState] =\n    useTransactionState();\n\n  useEffect(() => {\n    if (!name || !walletAddress) {\n      navigate('/manage/names');\n      return;\n    }\n\n    fetchDomainDetails({ arnsRecord: data.arnsRecord });\n  }, [data, interactionResult, isLoadingDomainDetails]);\n\n  // TODO: [PE-4630] tech debt, refactor this into smaller pure functions\n  async function fetchDomainDetails({\n    arnsRecord,\n  }: {\n    arnsRecord?: ArNSLeaseData & ArNSBaseNameData;\n  }) {\n    if (isLoadingDomainDetails || !arnsRecord) {\n      return;\n    }\n    try {\n      setLoading(true);\n      const txId = arnsRecord?.contractTxId;\n      if (!txId) {\n        throw Error('This name is not registered');\n      }\n\n      const duration = arnsRecord?.endTimestamp\n        ? getLeaseDurationFromEndTimestamp(\n            arnsRecord.startTimestamp * 1000,\n            arnsRecord.endTimestamp * 1000,\n          )\n        : 'Indefinite';\n\n      setIsMaxLeaseDuration(\n        (duration &&\n          typeof duration === 'number' &&\n          duration >= MAX_LEASE_DURATION) ||\n          duration === 'Indefinite',\n      );\n      setUndernameCount(arnsRecord.undernames);\n      setIsMaxUndernameCount(\n        !!undernameCount && arnsRecord.undernames >= MAX_UNDERNAME_COUNT,\n      );\n\n      setLoading(false);\n    } catch (error) {\n      eventEmitter.emit('error', error);\n      navigate('/manage/names', { state: location.pathname });\n    }\n  }\n\n  return (\n    <>\n      <div className=\"page\" style={{ gap: '30px' }}>\n        {interactionResult ? (\n          <TransactionSuccessCard\n            txId={interactionResult.id}\n            title={`${workflowName} completed`}\n            close={() => {\n              dispatchTransactionState({\n                type: 'reset',\n              });\n            }}\n          />\n        ) : (\n          <></>\n        )}\n        <div\n          className=\"flex flex-row\"\n          style={{ justifyContent: 'space-between', width: '100%' }}\n        >\n          <h2 className=\"flex white center\" style={{ gap: '16px' }}>\n            <HamburgerOutlineIcon\n              width={'20px'}\n              height={'20px'}\n              fill=\"var(--text-white)\"\n            />\n            {name}\n          </h2>\n          <div\n            className=\"flex flex-row\"\n            style={{ gap: '20px', width: 'fit-content' }}\n          >\n            <Tooltip\n              trigger={['hover']}\n              title={\n                isMaxUndernameCount\n                  ? 'Max undername support reached'\n                  : 'Increase undername support'\n              }\n              color=\"#222224\"\n              placement=\"top\"\n              rootClassName=\"notification-tooltip\"\n            >\n              <button\n                disabled={loading || isMaxUndernameCount}\n                className={`button-secondary ${\n                  loading || isMaxUndernameCount ? 'disabled-button' : 'hover'\n                }`}\n                style={{\n                  padding: loading || isMaxUndernameCount ? '0px' : '9px',\n                  gap: '8px',\n                  fontSize: '14px',\n                  color: 'var(--accent)',\n                  fontFamily: 'Rubik',\n                }}\n                onClick={() =>\n                  navigate(`/manage/names/${name}/upgrade-undernames`)\n                }\n              >\n                Increase Undernames\n              </button>\n            </Tooltip>\n            <Tooltip\n              trigger={['hover']}\n              title={\n                isMaxLeaseDuration\n                  ? 'Max lease duration reached'\n                  : 'Extend lease'\n              }\n              color=\"#222224\"\n              placement=\"top\"\n              rootClassName=\"notification-tooltip\"\n            >\n              <button\n                disabled={loading || isMaxLeaseDuration}\n                className={`button-primary ${\n                  loading || isMaxLeaseDuration ? 'disabled-button' : 'hover'\n                }`}\n                style={{\n                  padding: loading || isMaxLeaseDuration ? '0px' : '9px',\n                  gap: '8px',\n                  fontSize: '14px',\n                  color: 'var(--text-black)',\n                  fontFamily: 'Rubik',\n                }}\n                onClick={() => navigate(`/manage/names/${name}/extend`)}\n              >\n                Extend Lease\n              </button>\n            </Tooltip>\n          </div>\n        </div>\n        <div style={{ width: '100%' }}>\n          <DomainSettings domain={name} />\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default ManageDomain;\n"],"names":["ManageDomain","name","useParams","navigate","useNavigate","location","useLocation","walletAddress","useWalletState","isMaxLeaseDuration","setIsMaxLeaseDuration","reactExports","isMaxUndernameCount","setIsMaxUndernameCount","undernameCount","setUndernameCount","loading","setLoading","data","isLoadingDomainDetails","useDomainInfo","workflowName","interactionResult","dispatchTransactionState","useTransactionState","fetchDomainDetails","arnsRecord","duration","getLeaseDurationFromEndTimestamp","MAX_LEASE_DURATION","MAX_UNDERNAME_COUNT","error","eventEmitter","jsxRuntimeExports","TransactionSuccessCard","SvgHamburgerOutline","Tooltip","DomainSettings"],"mappings":"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"}
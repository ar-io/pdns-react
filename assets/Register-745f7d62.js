import{r as i,d as re,A as _,g as de,j as e,aR as ue,bB as he,aS as xe,bC as fe,b6 as me,bA as ge,bm as G,bD as se,bE as te,bF as ae,bg as $,bG as be,c as ve,u as we,a as ye,bH as Se,bI as ne,bJ as je,bK as Ne,bL as Ie,bM as ke,b8 as Ee,bN as j,bO as oe,bP as Ae,bQ as Te,bR as ie,bS as le,bT as Re,bU as Ce,bV as Pe}from"./index-894af6b3.js";import{C as De,T as Le}from"./TransactionCost-b4c61e2b.js";import{P as Fe}from"./Pagination-8896b714.js";import{S as Be}from"./StepProgressBar-e5aa1c84.js";import"./useBreakpoint-3dc4c317.js";(function(){try{var a=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new Error().stack;x&&(a._sentryDebugIds=a._sentryDebugIds||{},a._sentryDebugIds[x]="a8fa7b84-bfdf-4b31-4bc5-f12f097b7155",a._sentryDebugIdIdentifier="sentry-dbid-a8fa7b84-bfdf-4b31-4bc5-f12f097b7155")}catch{}})();function pe(a){const[x,p]=i.useState(!1);return i.useEffect(()=>{if(!a)return;const s=document.getElementById(a);if(!s){console.error(`No element found with id: ${a}`);return}const c=()=>p(!0),v=()=>p(!1);return s.addEventListener("focus",c),s.addEventListener("blur",v),()=>{s.removeEventListener("focus",c),s.removeEventListener("blur",v)}},[a]),x}const ce={isReserved:!1,reservedFor:void 0};function Oe(a){const[{arweaveDataProvider:x}]=re(),[p,s]=i.useState(!1),[c,v]=i.useState(ce),[n,P]=i.useState(!1),[h,N]=i.useState(!1);i.useEffect(()=>{h||(a.length||f(),k(a))},[a]);function f(){s(!1),v(ce),P(!1)}async function k(m){try{if(f(),N(!0),P(!1),!m.length)return f();const w=x.isDomainAvailable({domain:m}),D=x.isDomainReserved({domain:m}),[y,E]=await Promise.all([w,D]);s(y),v({...E,reservedFor:E.reservedFor?new _(E.reservedFor):void 0}),P(!0)}catch(w){console.error(w),f()}finally{N(!1)}}return{isAvailable:p,isReserved:c==null?void 0:c.isReserved,reservedFor:c==null?void 0:c.reservedFor,loading:h,validated:n}}function Ve({selectedTokenCallback:a}){var d;const[{arweaveDataProvider:x,antAoClient:p}]=re(),[{walletAddress:s}]=de(),[c,v]=i.useState(),[n,P]=i.useState(),[h,N]=i.useState(!1),[f,k]=i.useState(),[m,w]=i.useState(void 0),[D,y]=i.useState(!1),[E,F]=i.useState(!1),[J,z]=i.useState(void 0),O=pe("name-token-input"),A=i.useRef(null),[T,R]=i.useState(1),C=3;i.useEffect(()=>{a(m?new _(m.id):void 0),R(1)},[m]),i.useEffect(()=>{if(A.current)return document.addEventListener("click",U),()=>{document.removeEventListener("click",U)}},[A]);function U(t){A.current&&t.target!==A.current&&!A.current.contains(t.target)&&(v(""),F(!1),k(void 0),R(1))}async function L(t,l=[]){try{if(N(!0),!t)throw new Error("No address provided");const r=[],u=l.length?await Promise.all(l.map(async o=>{try{const g=te.init({process:new ae({processId:o.toString(),ao:p})}),V=await g.getInfo();if(!g||!V)throw new Error("Unable to get contract");return z(!0),o}catch(g){$.emit("error",g)}})).then(o=>o.filter(g=>!!g)):[];if(!r.length&&!u.length)return;const b=r.concat(u),S=await x.getRecords({filters:{processId:b}}),I=await Promise.all(b.map(async o=>{const g=te.init({process:new ae({processId:o.toString(),ao:p})}),V=Object.keys(S).reduce((M,ee)=>(S[ee].processId===o.toString()&&(M[ee]=S[ee]),M),{}),[X,q,K,Z]=await Promise.all([g.getOwner(),g.getControllers(),g.getTicker(),g.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:o,names:V,owner:X,controllers:q,ticker:K,name:Z}})).then(o=>o.filter(g=>!!g));if(!I.length)throw new Error("Unable to get details for Name Tokens");const B=I.reduce(async(o,g)=>{const{processId:V,owner:X,controllers:q,name:K,ticker:Z,names:M}=g;return{...o,[V.toString()]:{owner:X,controllers:q,name:K,ticker:Z,names:Object.keys(M)}}},{});if(P(await B),u.length){const o=B[u[0].toString()];w({name:o==null?void 0:o.name,ticker:o==null?void 0:o.ticker,id:u[0].toString(),names:(o==null?void 0:o.names)??[]})}}catch(r){$.emit("error",r)}finally{N(!1),R(1)}}function W(t){try{if(y(!0),z(void 0),!t){v("");return}if(v(t),!n)throw new Error("No Name Tokens Found");const l=Object.keys(n).filter(r=>{const{owner:u,controllers:b,name:S,ticker:I}=n[r];return[u,b,S,I,r].some(o=>o&&o.toString().toLowerCase().includes(t.toLowerCase()))}).map(r=>{const{name:u,ticker:b,names:S}=n[r];return{id:r,name:u??"",ticker:b??"",names:S}}).filter(r=>!!r);if(!l.length)throw new Error("No ANT tokens found for that search");k(l)}catch{k(void 0)}finally{y(!1),R(1)}}function Y({id:t,name:l,ticker:r,names:u}){try{if(v(""),k(void 0),t===void 0)throw new Error(`No ID provided for ${l??r??""}`);w({id:t,name:l??"",ticker:r??"",names:u}),a(new _(t)),R(1)}catch(b){$.emit("error",b)}finally{F(!1)}}const Q=(t,l,r)=>{if(n&&!(l==="next"||l==="prev"))return l==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:T==t?"white":"var(--text-grey)",width:"32px"},children:t}):r};function H(t){R(t)}return e.jsxs("div",{ref:A,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:O||E?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(ue,{inputId:"name-token-input",onClick:()=>F(!0),showValidationIcon:!0,setValue:t=>W(t),value:c??"",maxCharLength:he,placeholder:m?(d=m.name)!=null&&d.length?m.name:m.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[xe.ARWEAVE_ID]:{fn:t=>x.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${m?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${m?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:h||D?e.jsx(fe,{size:20,color:"var(--text-white)"}):c&&J===!1?e.jsx(e.Fragment,{}):c&&me(c)&&!Object.keys(n??[]).includes(c)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{L(s,[new _(c)])},children:"Import"}):m?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{w(void 0),a(void 0)},children:[e.jsx(ge,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(G,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),n&&E?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[c&&!(f!=null&&f.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):f?f.slice(Math.max((T-1)*C,0),T*C).map((t,l)=>{var r;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{Y({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(r=t.names)!=null&&r.length?e.jsx(G,{icon:e.jsx(se,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(u=>e.jsx("span",{children:u},u))})},l):e.jsx(e.Fragment,{})]},l)}):Object.entries(n).slice(Math.max((T-1)*C,0),T*C).map((t,l)=>{if(!t)return;const[r,u]=t,{name:b,ticker:S,names:I}=u;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{Y({id:r,name:b??"",ticker:S??"",names:I??[]})},children:[b&&S?`${b.slice(0,20)} ${b.length>20?"...":""} (${S}) - ${r}`:r,I!=null&&I.length?e.jsx(G,{icon:e.jsx(se,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:I.map(B=>e.jsx("span",{children:B},B))})}):e.jsx(e.Fragment,{})]},l)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[n.length||f!=null&&f.length||!c?e.jsx(Fe,{total:Object.keys(n).length&&!f?Object.keys(n).length:f?f.length:0,itemRender:Q,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:H,current:T,defaultPageSize:C}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Ye(){const[{domain:a,fee:x,leaseDuration:p,registrationType:s,antID:c,targetId:v},n]=be(),[{arweaveDataProvider:P,arioTicker:h,arioContract:N,arioProcessId:f,antAoClient:k}]=re(),[{walletAddress:m,balances:w}]=de(),[,D]=ve(),{name:y}=we(),{loading:E}=Oe(y??a),[F,J]=i.useState(),z=pe("target-id-input"),O=ye(),[A,T]=Se(),[R,C]=i.useState(!1),[U,L]=i.useState(!1),W=x==null?void 0:x[h],Y=W&&W<0;i.useEffect(()=>{if(A.get("redirect")&&y){if(!w[h])return;T(),H();return}},[w,x]),i.useEffect(()=>{if(!N||!a||!h||!s)return;(async()=>{n({type:"setFee",payload:{ar:0,[h]:void 0}}),L(!0);const t=await N.getTokenCost({intent:"Buy-Record",name:a,type:s,years:p}).then(l=>new ne(l).toARIO().valueOf()).catch(()=>{});L(!1),n({type:"setFee",payload:{ar:0,[h]:t}})})()},[N,n,a,h,p,s]),i.useEffect(()=>{y&&a!==y&&n({type:"setDomainName",payload:y})},[y,a]);async function Q(d){if(!d){n({type:"setANTID",payload:void 0});return}if(n({type:"setANTID",payload:d}),!te.init({process:new ae({processId:d.toString(),ao:k})}))throw new Error("Contract not found")}if(!s)return e.jsx(fe,{size:80});async function H(){try{if(!m){const u=new URLSearchParams({redirect:"true"});O("/connect",{state:{to:`/register/${a}?${u.toString()}`,from:`/register/${a}`}});return}L(!0);const l=await N.getBalance({address:m.toString()}).then(u=>new ne(u).toARIO()),r=je({balances:{AR:w.ar,[h]:l.valueOf()},costs:{AR:x.ar,[h]:x[h]}});if(r.length){r.forEach(u=>{$.emit("error",new Ne(u.message))});return}if(Y)throw new Error("Issue calculating transaction cost.");if(R)throw new Ie("Please fix the errors above before continuing.")}catch(l){$.emit("error",l),L(!1);return}finally{L(!1)}const t={name:a&&ke().test(a)?Ee(a):a,processId:(c==null?void 0:c.toString())??"atomic",years:s===j.LEASE?p:void 0,type:s,targetId:v};D({type:"setTransactionData",payload:{assetId:f,functionName:"buyRecord",...t,interactionPrice:x==null?void 0:x[h]}}),D({type:"setInteractionType",payload:oe.BUY_RECORD}),n({type:"reset"}),D({type:"setWorkflowName",payload:oe.BUY_RECORD}),O("/transaction/review",{state:`/register/${a}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Ae,{message:"Loading Domain info, please wait.",loading:E}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Be,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[a," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Te,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>n({type:"setRegistrationType",payload:j.LEASE}),style:{position:"relative",background:s===j.LEASE?"var(--text-white)":"",color:s===j.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",s===j.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:s===j.BUY?"var(--text-white)":"",color:s===j.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>n({type:"setRegistrationType",payload:j.BUY}),children:["Buy"," ",s===j.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:s===j.LEASE?e.jsx(De,{value:p,setValue:d=>{n({type:"setLeaseDuration",payload:d})},minValue:ie,maxValue:le,valueStyle:{padding:"20px 120px"},valueName:p>1?"years":"year",detail:`Until ${Re(Date.now()+p*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${ie}-${le} years)`})}):s===j.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ce,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:z||F?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(ue,{inputId:"target-id-input",value:F??"",setValue:d=>{J(d.trim()),me(d.trim())&&n({type:"setTargetId",payload:new _(d.trim())}),d.trim().length===0&&C(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[xe.ARWEAVE_ID]:{fn:d=>P.validateArweaveId(d)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:d=>{C(!d)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(G,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Ve,{selectedTokenCallback:d=>Q(d)})]})},"1"),e.jsx(Le,{ioRequired:!0,fee:x,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(Pe,{nextText:"Next",backText:"Back",onNext:U?void 0:H,onBack:()=>O("/",{state:`/register/${a}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{Ye as default};
//# sourceMappingURL=Register-745f7d62.js.map

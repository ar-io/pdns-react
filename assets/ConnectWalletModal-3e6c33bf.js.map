{"version":3,"file":"ConnectWalletModal-3e6c33bf.js","sources":["../../src/components/icons/ArConnectIcon.svg","../../src/components/icons/ArweaveAppIcon.png","../../src/services/wallets/ArweaveAppWalletConnector.ts","../../src/components/modals/ConnectWalletModal/ConnectWalletModal.tsx"],"sourcesContent":["export default \"__VITE_ASSET__771decb0__\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOeSURBVHgBvVjNaxNREJ+kNoK9hFw8eDBSrb21UD9AhS69C3qpHjxEULAVbAXxT/CmjfUP0IsHD2ovnlcrtGALQZD2mFwKHlLSzyRtPp6/Sd4ms2s2u5uP/mBIdvfNvN+bmTfzdkMUEEqpOH7uQMYgBiSqhbEDyWj5AVkKhUIZ6gdAJAExVXCkWJd6BRgzIGmXyUqVSmVTEzWPj4/X2hBLd0UMylHIgtNquVxeLZVKL/b29i6bpnnKRXe8UCg81mSdYJtRCgIoxLWrJUz2FgXE7u7u1UKhuCwNVavVtKrnom8yaaGfQyhmqEvAzhyIZB0hjHspRTX7hlKxWLxIPUKLxabahk/Zc8Z7Bb0hteA2MCFinO0HGTHXMKeCIGW0GiRZP6M+A6kwI6PhJNPwDrbrMgUAEv4662OLv8TvE5SESb+6yl5oE/JBY4vzNvVpbEy5V+405IEPG4bQMa2bcZE7m+QDWienPIAies/LVrlcXRUq58NUb5Q1HB0dvSEfAPFX1GyoGUw8hd8LCN99qjfWGsLh8FsvW6GQ+iwu7/JqvwqG4+QDIPRFh8vkFiGfgdxt6SW0mNF2trgFieHvbflDXWBxcfH0+vr6ma2trVuOyBnt9LgfYkzJyj2ycgEr+0UBcHBwcBY76zW89QdSVe4wvGyJJpzjbl3LhYGBgUPyie3t7RtDQ0PfqJlHXQG59hc/HNpomDpALBb7aJFB3fmEzTAyPT19CqfDEG49pG5ghQxe3/Azfn9/f9KKBXTKnDcOe4mgIRMHuxx7aEffv+R24JKIRCLnrP9wiJqYmIjI58iHKQqIwcHBK/pvhlf0wVoK+suIlzIqeUwun1cHEk8hs6p15Tba2cPzcTF2iW/MW1d8NCUfwOTvlAsQxry89qrWXMfE8Hlb6wBWyCdA6jkmzzSJqAquTST4KC4Phc2khx157o7XbjpcbVAAwKs3Vb1JBi4B3MjFvKnGA2XfGSadEJCz8vCfsD1U4oDWi0O9FzDNnCCTbjVAnk24Ng1Tn8C54ngDSbgNTErW6mQO+cl2g/ltNdUvUqp+uG+Q0a9cUS+luEOJXTtHXQIJPKvsp0z/i9Uxlm5V+Xz+ZzabvUYBoXPTVHakAntehy+p/scGduEj5XK65H7ILYirPha10kI/qTqoWZJYQrl/juF2s6Y9YKLqboBEyWVoWnXwscKLWEoFh6kCfBcKUUCo5ic9fiGMa5Gf9Fi+Q35TB5/0/gFbBojUzDhjzAAAAABJRU5ErkJggg==\"","import { ARWEAVE_APP_API } from '@src/utils/constants';\nimport { ArweaveAppError } from '@src/utils/errors';\nimport { PermissionType } from 'arconnect';\nimport { ReactiveConnector } from 'arweave-wallet-connector/lib/browser/Reactive';\nimport { ApiConfig } from 'arweave/node/lib/api';\nimport { CustomSignature, SignatureType, Transaction } from 'warp-contracts';\n\nimport { ARCONNECT_UNRESPONSIVE_ERROR } from '../../components/layout/Notifications/Notifications';\nimport { ArweaveWalletConnector, WALLET_TYPES } from '../../types';\nimport { executeWithTimeout } from '../../utils';\nimport { ArweaveTransactionID } from '../arweave/ArweaveTransactionID';\n\nexport const ARCONNECT_WALLET_PERMISSIONS: PermissionType[] = [\n  'ACCESS_ADDRESS',\n  'ACCESS_ALL_ADDRESSES',\n  'ACCESS_PUBLIC_KEY',\n  'SIGN_TRANSACTION',\n  'ACCESS_ARWEAVE_CONFIG',\n];\n\nexport class ArweaveAppWalletConnector implements ArweaveWalletConnector {\n  private _wallet: ReactiveConnector & { namespaces: any };\n  signer: CustomSignature;\n\n  constructor() {\n    this._wallet = ARWEAVE_APP_API as any;\n    this.signer = {\n      signer: async (transaction: Transaction) => {\n        await ARWEAVE_APP_API.signTransaction(transaction);\n      },\n      type: 'arweave' as SignatureType,\n    };\n  }\n\n  // The API has been shown to be unreliable, so we call each function with a timeout\n  async safeArconnectApiExecutor<T>(fn: () => T): Promise<T> {\n    /**\n     * This is here because occasionally arconnect injects but does not initialize internally properly,\n     * allowing the api to be called but then hanging.\n     * This is a workaround to check that and emit appropriate errors,\n     * and to trigger the workaround workflow of reloading the page and re-initializing arconnect.\n     */\n\n    const res = await executeWithTimeout(() => fn(), 20_000);\n\n    if (res === 'timeout') {\n      throw new Error(ARCONNECT_UNRESPONSIVE_ERROR);\n    }\n    return res as T;\n  }\n\n  async connect(): Promise<void> {\n    // confirm they have the extension installed\n    try {\n      localStorage.setItem('walletType', WALLET_TYPES.ARWEAVE_APP);\n\n      await this._wallet.connect({\n        name: 'ARNS - ar.io',\n      });\n\n      this.signer.signer.bind(this);\n    } catch (error) {\n      localStorage.removeItem('walletType');\n      throw new ArweaveAppError('User cancelled authentication.');\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    localStorage.removeItem('walletType');\n    return await this._wallet.disconnect();\n  }\n\n  async getWalletAddress(): Promise<ArweaveTransactionID> {\n    const address =\n      await this._wallet.namespaces.arweaveWallet.getActiveAddress();\n    return new ArweaveTransactionID(address);\n  }\n\n  async getGatewayConfig(): Promise<ApiConfig> {\n    return {\n      host: 'ar-io.dev',\n      port: 443,\n      protocol: 'https',\n    };\n  }\n}\n","import { ArConnectWalletConnector } from '@src/services/wallets';\nimport { ArweaveAppWalletConnector } from '@src/services/wallets/ArweaveAppWalletConnector';\nimport { useEffect, useRef, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router';\n\nimport { ArweaveTransactionID } from '../../../services/arweave/ArweaveTransactionID';\nimport { dispatchNewGateway } from '../../../state/actions';\nimport { useGlobalState } from '../../../state/contexts/GlobalState';\nimport { useWalletState } from '../../../state/contexts/WalletState';\nimport { ArweaveWalletConnector } from '../../../types';\nimport eventEmitter from '../../../utils/events';\nimport { ArConnectIcon, ArweaveAppIcon, CloseIcon } from '../../icons';\nimport PageLoader from '../../layout/progress/PageLoader/PageLoader';\nimport './styles.css';\n\nfunction ConnectWalletModal(): JSX.Element {\n  const modalRef = useRef<HTMLDivElement>(null);\n  const [, dispatchGlobalState] = useGlobalState();\n  const [\n    { wallet, walletAddress, walletStateInitialized },\n    dispatchWalletState,\n  ] = useWalletState();\n  const navigate = useNavigate();\n  const { state } = useLocation();\n  const [connecting, setConnecting] = useState(false);\n  const [loading, setLoading] = useState(!walletStateInitialized);\n\n  useEffect(() => {\n    if (walletStateInitialized) {\n      setLoading(false);\n    }\n  }, [walletStateInitialized]);\n\n  useEffect(() => {\n    // disable scrolling when modal is in view\n    if (wallet && walletAddress) {\n      closeModal({ next: true, address: walletAddress });\n    }\n    document.body.style.overflow = 'hidden';\n    return () => {\n      document.body.style.overflow = 'scroll';\n    };\n  }, [wallet, walletAddress]);\n\n  function handleClickOutside(e: any) {\n    if (modalRef.current && modalRef.current === e.target) {\n      closeModal({ next: false });\n    }\n    return;\n  }\n\n  async function closeModal({\n    next,\n    address,\n  }: {\n    next: boolean;\n    address?: ArweaveTransactionID;\n  }) {\n    if (!address) {\n      navigate(state?.from ?? '/', { state: { from: state?.from ?? '/' } });\n      return;\n    }\n\n    if (next) {\n      navigate(state?.to ?? '/');\n    } else {\n      navigate(state?.from ?? '/');\n    }\n  }\n\n  async function connect(walletConnector: ArweaveWalletConnector) {\n    try {\n      setConnecting(true);\n      await walletConnector.connect();\n      const arweaveGate = await walletConnector.getGatewayConfig();\n      if (arweaveGate?.host) {\n        await dispatchNewGateway(\n          arweaveGate.host,\n          walletConnector,\n          dispatchGlobalState,\n        );\n      }\n\n      const address = await walletConnector.getWalletAddress();\n\n      dispatchWalletState({\n        type: 'setWalletAddress',\n        payload: address,\n      });\n      dispatchWalletState({\n        type: 'setWallet',\n        payload: walletConnector,\n      });\n\n      closeModal({ next: true, address });\n    } catch (error: any) {\n      if (walletConnector) {\n        eventEmitter.emit('error', error);\n      }\n    } finally {\n      setConnecting(false);\n    }\n  }\n\n  if (loading) {\n    return <PageLoader loading={true} message={'Connecting to Wallet'} />; // Replace with your loading component\n  }\n\n  return (\n    // eslint-disable-next-line\n    <div\n      className=\"modal-container\"\n      ref={modalRef}\n      onClick={handleClickOutside}\n    >\n      <div className=\"connect-wallet-modal\">\n        <p\n          className=\"section-header\"\n          style={{ marginBottom: '1em', fontFamily: 'Rubik-Bold' }}\n        >\n          Connect with an Arweave wallet\n        </p>\n        <button\n          className=\"modal-close-button\"\n          onClick={() => closeModal({ next: false })}\n        >\n          <CloseIcon width=\"30px\" height={'30px'} fill=\"var(--text-white)\" />\n        </button>\n        <button\n          disabled={connecting}\n          className=\"wallet-connect-button h2\"\n          onClick={() => {\n            connect(new ArConnectWalletConnector());\n          }}\n        >\n          <ArConnectIcon\n            className=\"external-icon\"\n            width={'47px'}\n            height={'47px'}\n          />\n          Connect via ArConnect\n        </button>\n        <button\n          className=\"wallet-connect-button h2\"\n          onClick={() => {\n            connect(new ArweaveAppWalletConnector());\n          }}\n        >\n          <img className=\"external-icon\" src={ArweaveAppIcon} alt=\"\" />\n          Connect using Arweave.app\n        </button>{' '}\n        <span\n          className=\"flex flex-row white flex-center\"\n          style={{ whiteSpace: 'nowrap', gap: '5px', paddingTop: '16px' }}\n        >\n          Don&apos;t have a wallet?&nbsp;\n          <a\n            target=\"_blank\"\n            href=\"https://ar.io/wallet\"\n            style={{\n              color: 'inherit',\n              textDecoration: 'underline',\n            }}\n            rel=\"noreferrer\"\n            className=\"bold\"\n          >\n            Get one here.\n          </a>\n        </span>\n      </div>\n    </div>\n  );\n}\nexport default ConnectWalletModal;\n"],"names":["SvgArConnectIcon","props","reactExports","ArweaveAppIcon","ArweaveAppWalletConnector","__publicField","ARWEAVE_APP_API","transaction","fn","res","executeWithTimeout","ARCONNECT_UNRESPONSIVE_ERROR","WALLET_TYPES","ArweaveAppError","address","ArweaveTransactionID","ConnectWalletModal","modalRef","dispatchGlobalState","useGlobalState","wallet","walletAddress","walletStateInitialized","dispatchWalletState","useWalletState","navigate","useNavigate","state","useLocation","connecting","setConnecting","loading","setLoading","closeModal","handleClickOutside","e","next","connect","walletConnector","arweaveGate","dispatchNewGateway","error","eventEmitter","jsxRuntimeExports","PageLoader","SvgClose","ArConnectWalletConnector"],"mappings":"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"}
import{B as ie,a3 as oe,r as c,a8 as ce,A as U,j as e,V as le,a9 as pe,I as de,a4 as xe,J as ue,aa as me,ab as Y,P as fe,ac as ee,e as _,ad as he,b as ge,u as we,ae as ye,a as ve,af as be,ag as te,ah as Se,ai as je,aj as Ne,ak as Ie,al as ke,am as y,an as Te,ao as Ee,ap as ae,aq as Ae,ar as Re,as as re,M as se,at as Ce,au as Pe,av as De}from"./index-ebf86eb7.js";import{C as Le}from"./Counter-f4b46480.js";import{S as ne}from"./HamburgerOutline-04c3ef7d.js";import{T as Be}from"./TransactionCost-2210e4d2.js";import{S as Oe}from"./StepProgressBar-39e2786d.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[l]="d933bac0-99ae-431b-143e-4438f12696f3",s._sentryDebugIdIdentifier="sentry-dbid-d933bac0-99ae-431b-143e-4438f12696f3")}catch{}})();function _e({selectedTokenCallback:s}){var C;const[{arweaveDataProvider:l}]=ie(),[{walletAddress:b}]=oe(),[n,j]=c.useState(),[p,f]=c.useState(),[H,h]=c.useState(!1),[d,N]=c.useState(),[m,A]=c.useState(void 0),[I,F]=c.useState(!1),[L,B]=c.useState(!1),[M,P]=c.useState(void 0),G=ce("name-token-input"),k=c.useRef(null),[T,S]=c.useState(1),R=3;c.useEffect(()=>{s(m?new U(m.id):void 0),S(1)},[m]),c.useEffect(()=>{if(k.current)return document.addEventListener("click",E),()=>{document.removeEventListener("click",E)}},[k]);function E(t){k.current&&t.target!==k.current&&!k.current.contains(t.target)&&(j(""),B(!1),N(void 0),S(1))}async function V(t,o=[]){try{if(h(!0),!t)throw new Error("No address provided");const a=[],x=o.length?await Promise.all(o.map(async r=>{try{const u=ee.init({processId:r.toString()}),O=await u.getInfo();if(!u||!O)throw new Error("Unable to get contract");return P(!0),r}catch(u){_.emit("error",u)}})).then(r=>r.filter(u=>!!u)):[];if(!a.length&&!x.length)return;const g=a.concat(x),w=await l.getRecords({filters:{processId:g}}),v=await Promise.all(g.map(async r=>{const u=ee.init({processId:r.toString()}),O=Object.keys(w).reduce((W,Z)=>(w[Z].processId===r.toString()&&(W[Z]=w[Z]),W),{}),[q,X,Q,K]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:r,names:O,owner:q,controllers:X,ticker:Q,name:K}})).then(r=>r.filter(u=>!!u));if(!v.length)throw new Error("Unable to get details for Name Tokens");const D=v.reduce(async(r,u)=>{const{processId:O,owner:q,controllers:X,name:Q,ticker:K,names:W}=u;return{...r,[O.toString()]:{owner:q,controllers:X,name:Q,ticker:K,names:Object.keys(W)}}},{});if(f(await D),x.length){const r=D[x[0].toString()];A({name:r==null?void 0:r.name,ticker:r==null?void 0:r.ticker,id:x[0].toString(),names:(r==null?void 0:r.names)??[]})}}catch(a){_.emit("error",a)}finally{h(!1),S(1)}}function J(t){try{if(F(!0),P(void 0),!t){j("");return}if(j(t),!p)throw new Error("No Name Tokens Found");const o=Object.keys(p).filter(a=>{const{owner:x,controllers:g,name:w,ticker:v}=p[a];return[x,g,w,v,a].some(r=>r&&r.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:x,ticker:g,names:w}=p[a];return{id:a,name:x??"",ticker:g??"",names:w}}).filter(a=>!!a);if(!o.length)throw new Error("No ANT tokens found for that search");N(o)}catch{N(void 0)}finally{F(!1),S(1)}}function z({id:t,name:o,ticker:a,names:x}){try{if(j(""),N(void 0),t===void 0)throw new Error(`No ID provided for ${o??a??""}`);A({id:t,name:o??"",ticker:a??"",names:x}),s(new U(t)),S(1)}catch(g){_.emit("error",g)}finally{B(!1)}}const $=(t,o,a)=>{if(p&&!(o==="next"||o==="prev"))return o==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:T==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function i(t){S(t)}return e.jsxs("div",{ref:k,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:G||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(le,{inputId:"name-token-input",onClick:()=>B(!0),showValidationIcon:!0,setValue:t=>J(t),value:n??"",maxCharLength:pe,placeholder:m?(C=m.name)!=null&&C.length?m.name:m.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>l.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${m?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${m?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:H||I?e.jsx(xe,{size:20,color:"var(--text-white)"}):n&&M===!1?e.jsx(e.Fragment,{}):n&&ue(n)&&!Object.keys(p??[]).includes(n)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{V(b,[new U(n)])},children:"Import"}):m?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{A(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(Y,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),p&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[n&&!(d!=null&&d.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):d?d.slice(Math.max((T-1)*R,0),T*R).map((t,o)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(x=>e.jsx("span",{children:x},x))})},o):e.jsx(e.Fragment,{})]},o)}):Object.entries(p).slice(Math.max((T-1)*R,0),T*R).map((t,o)=>{if(!t)return;const[a,x]=t,{name:g,ticker:w,names:v}=x;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:a,name:g??"",ticker:w??"",names:v??[]})},children:[g&&w?`${g.slice(0,20)} ${g.length>20?"...":""} (${w}) - ${a}`:a,v!=null&&v.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:v.map(D=>e.jsx("span",{children:D},D))})}):e.jsx(e.Fragment,{})]},o)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[p.length||d!=null&&d.length||!n?e.jsx(fe,{total:Object.keys(p).length&&!d?Object.keys(p).length:d?d.length:0,itemRender:$,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:i,current:T,defaultPageSize:R}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Ue(){const[{domain:s,fee:l,leaseDuration:b,registrationType:n,antID:j,targetId:p},f]=he(),[{arweaveDataProvider:H,ioTicker:h,arioContract:d}]=ie(),[{walletAddress:N,balances:m}]=oe(),[,A]=ge(),{name:I}=we(),{loading:F}=ye(I??s),[L,B]=c.useState(),M=ce("target-id-input"),P=ve(),[G,k]=be(),[T,S]=c.useState(!1),[R,E]=c.useState(!1),V=l==null?void 0:l[h],J=V&&V<0;c.useEffect(()=>{if(G.get("redirect")&&I){if(!m[h])return;k(),$();return}},[m,l]),c.useEffect(()=>{if(!d||!s||!h||!n)return;(async()=>{f({type:"setFee",payload:{ar:0,[h]:void 0}}),E(!0);const C=await d.getTokenCost({intent:"Buy-Record",name:s,purchaseType:n,years:b}).then(t=>new te(t).toIO().valueOf()).catch(()=>{});E(!1),f({type:"setFee",payload:{ar:0,[h]:C}})})()},[d,f,s,h,b,n]),c.useEffect(()=>{I&&s!==I&&f({type:"setDomainName",payload:I})},[I,s]);async function z(i){if(!i){f({type:"setANTID",payload:void 0});return}if(f({type:"setANTID",payload:i}),!ee.init({processId:i.toString()}))throw new Error("Contract not found")}if(!n)return e.jsx(xe,{size:80});async function $(){try{if(!N){const a=new URLSearchParams({redirect:"true"});P("/connect",{state:{to:`/register/${s}?${a.toString()}`,from:`/register/${s}`}});return}E(!0);const t=await d.getBalance({address:N.toString()}).then(a=>new te(a).toIO()),o=Se({balances:{AR:m.ar,[h]:t.valueOf()},costs:{AR:l.ar,[h]:l[h]}});if(o.length){o.forEach(a=>{_.emit("error",new je(a.message))});return}if(J)throw new Error("Issue calculating transaction cost.");if(T)throw new Ne("Please fix the errors above before continuing.")}catch(t){_.emit("error",t),E(!1);return}finally{E(!1)}const i=s&&Ie().test(s)?ke(s):s,C={name:i,processId:(j==null?void 0:j.toString())??"atomic",years:n===y.LEASE?b:void 0,type:n,targetId:p,state:Te(i,N,p)};A({type:"setTransactionData",payload:{assetId:Ee.toString(),functionName:"buyRecord",...C,interactionPrice:l==null?void 0:l[h]}}),A({type:"setInteractionType",payload:ae.BUY_RECORD}),f({type:"reset"}),A({type:"setWorkflowName",payload:ae.BUY_RECORD}),P("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Ae,{message:"Loading Domain info, please wait.",loading:F}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Oe,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Re,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>f({type:"setRegistrationType",payload:y.LEASE}),style:{position:"relative",background:n===y.LEASE?"var(--text-white)":"",color:n===y.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",n===y.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:n===y.BUY?"var(--text-white)":"",color:n===y.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>f({type:"setRegistrationType",payload:y.BUY}),children:["Buy"," ",n===y.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:n===y.LEASE?e.jsx(Le,{value:b,setValue:i=>{f({type:"setLeaseDuration",payload:i})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:b>1?"years":"year",detail:`Until ${Ce(Date.now()+b*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):n===y.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Pe,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:M||L?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(le,{inputId:"target-id-input",value:L??"",setValue:i=>{B(i.trim()),ue(i.trim())&&f({type:"setTargetId",payload:new U(i.trim())}),i.trim().length===0&&S(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:i=>H.validateArweaveId(i)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:i=>{S(!i)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(Y,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(_e,{selectedTokenCallback:i=>z(i)})]})},"1"),e.jsx(Be,{ioRequired:!0,fee:l,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(De,{nextText:"Next",backText:"Back",onNext:R?void 0:$,onBack:()=>P("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{Ue as default};
//# sourceMappingURL=Register-d3168d8f.js.map

{"version":3,"file":"UpgradeUndernames-a4862f82.js","sources":["../../src/components/layout/UpgradeUndernames/UpgradeUndernames.tsx"],"sourcesContent":["import { ANT, AoArNSNameData, mIOToken } from '@ar.io/sdk/web';\nimport { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { useIsMobile } from '../../../hooks';\nimport { ArweaveTransactionID } from '../../../services/arweave/ArweaveTransactionID';\nimport { useGlobalState } from '../../../state/contexts/GlobalState';\nimport { useTransactionState } from '../../../state/contexts/TransactionState';\nimport {\n  ARNS_INTERACTION_TYPES,\n  IncreaseUndernamesPayload,\n} from '../../../types';\nimport { isARNSDomainNameValid, lowerCaseDomain } from '../../../utils';\nimport {\n  ARNS_REGISTRY_ADDRESS,\n  MAX_UNDERNAME_COUNT,\n} from '../../../utils/constants';\nimport eventEmitter from '../../../utils/events';\nimport { InfoIcon } from '../../icons';\nimport Counter from '../../inputs/Counter/Counter';\nimport WorkflowButtons from '../../inputs/buttons/WorkflowButtons/WorkflowButtons';\nimport Loader from '../Loader/Loader';\nimport TransactionCost from '../TransactionCost/TransactionCost';\n\nfunction UpgradeUndernames() {\n  const isMobile = useIsMobile();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [{ arweaveDataProvider, ioTicker, arioContract }] = useGlobalState();\n  const name = location.pathname.split('/').at(-2);\n  const [, dispatchTransactionState] = useTransactionState();\n  const [record, setRecord] = useState<AoArNSNameData>();\n  const [antContract, setAntContract] = useState<ANT>();\n  const [undernameCount, setUndernameCount] = useState<number>(0);\n  // min count of 1 ~ contract rule\n  const [newUndernameCount, setNewUndernameCount] = useState<number>(0);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [fee, setFee] = useState<number | undefined>(0);\n\n  useEffect(() => {\n    onLoad();\n  }, [name]);\n\n  useEffect(() => {\n    if (!name || !record) {\n      return;\n    }\n    setFee(undefined);\n    const updateFee = async () => {\n      if (newUndernameCount === 0) {\n        setFee(0);\n        return;\n      }\n      if (Number.isNaN(newUndernameCount)) {\n        eventEmitter.emit(\n          'error',\n          new Error('Invalid undername count, must be a number greater than 0'),\n        );\n      }\n      // TODO; implement\n      const price = await arioContract\n        .getTokenCost({\n          intent: 'Increase-Undername-Limit',\n          name: lowerCaseDomain(name),\n          quantity: newUndernameCount,\n        })\n        .then((p) => new mIOToken(p).toIO().valueOf());\n      setFee(price);\n    };\n\n    updateFee();\n  }, [newUndernameCount, record, name]);\n\n  async function onLoad() {\n    try {\n      setLoading(true);\n      if (name && isARNSDomainNameValid({ name: lowerCaseDomain(name) })) {\n        const record = await arweaveDataProvider.getRecord({\n          domain: lowerCaseDomain(name),\n        });\n        if (!record) {\n          throw new Error(`Unable to get record for ${name}`);\n        }\n        setRecord(record);\n        const processId = new ArweaveTransactionID(record?.processId);\n        const contract = ANT.init({\n          processId: processId.toString(),\n        });\n        const existingUndernameCount = await contract.getRecords().then((r) => {\n          return Object.keys(r).filter((k) => k === '@').length; // exclude @ record\n        });\n        setUndernameCount(existingUndernameCount);\n        setAntContract(contract);\n      }\n    } catch (error) {\n      eventEmitter.emit('error', error);\n      navigate(`/manage/names`);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (loading || !record || !antContract || !name) {\n    return (\n      <div className=\"page center\">\n        <Loader size={80} message=\"Loading domain record\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"page center\">\n      <div className=\"flex flex-column\" style={{ maxWidth: '1000px' }}>\n        <h1 className=\"flex white\">Increase Undernames</h1>\n        <div\n          className=\"flex center\"\n          style={{\n            justifyContent: 'space-between',\n            border: '1px solid var(--text-faded)',\n            padding: '35px 40px',\n            borderRadius: 'var(--corner-radius)',\n            flexDirection: isMobile ? 'column' : 'row',\n            gap: '30px',\n          }}\n        >\n          <div\n            className=\"flex flex-column\"\n            style={{ fontSize: '16px', width: 'fit-content', gap: '5px' }}\n          >\n            <span\n              className=\"flex grey center\"\n              style={{ gap: '8px', whiteSpace: 'nowrap' }}\n            >\n              Total Undernames:{' '}\n              <span className=\"white\">{record.undernameLimit}</span>\n              <span className=\"flex add-box center\" style={{}}>\n                +{newUndernameCount}\n              </span>\n            </span>\n            <span className=\"flex grey\">\n              Used:&nbsp;\n              <span className=\"white\"> {undernameCount}</span>\n            </span>\n          </div>\n          <Counter\n            maxValue={MAX_UNDERNAME_COUNT - record.undernameLimit}\n            minValue={0}\n            value={newUndernameCount}\n            setValue={setNewUndernameCount}\n            containerStyle={{\n              width: 'fit-content',\n              justifyContent: 'center',\n              alignItems: 'center',\n            }}\n            valueStyle={{\n              background: 'var(--card-bg)',\n              width: '50px',\n              height: '40px',\n              alignItems: 'center',\n              justifyContent: 'center',\n              border: '1px solid var(--text-faded)',\n              borderRadius: 'var(--corner-radius)',\n              margin: '0px 10px',\n              fontSize: '14px',\n            }}\n            editable={true}\n          />\n        </div>\n        <TransactionCost\n          ioRequired={true}\n          fee={{\n            [ioTicker]: fee,\n            ar: 0,\n          }}\n          info={\n            <div\n              className=\"flex flex-row flex-left\"\n              style={{\n                gap: '10px',\n                maxWidth: '50%',\n                justifyContent: 'flex-start',\n                alignItems: 'flex-start',\n              }}\n            >\n              <InfoIcon\n                width={'20px'}\n                height={'20px'}\n                fill=\"var(--text-grey)\"\n              />\n              <span\n                className=\"flex flex-column flex-left grey text\"\n                style={{ textAlign: 'left', lineHeight: '1.5em' }}\n              >\n                Increasing the undername limit is paid in {ioTicker} tokens.\n              </span>\n            </div>\n          }\n        />\n        <WorkflowButtons\n          backText=\"Cancel\"\n          nextText=\"Confirm\"\n          onBack={() => navigate(`/manage/names/${lowerCaseDomain(name)}`)}\n          onNext={\n            !fee || fee < 0\n              ? undefined\n              : () => {\n                  const increaseUndernamePayload: IncreaseUndernamesPayload = {\n                    name: lowerCaseDomain(name),\n                    qty: newUndernameCount,\n                    oldQty: record.undernameLimit,\n                    processId: record.processId,\n                  };\n                  dispatchTransactionState({\n                    type: 'setTransactionData',\n                    payload: {\n                      assetId: ARNS_REGISTRY_ADDRESS.toString(),\n                      functionName: 'increaseundernameLimit',\n                      ...increaseUndernamePayload,\n                      interactionPrice: fee,\n                    },\n                  });\n                  dispatchTransactionState({\n                    type: 'setInteractionType',\n                    payload: ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                  });\n                  dispatchTransactionState({\n                    type: 'setWorkflowName',\n                    payload: ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                  });\n                  // navigate to the transaction page, which will load the updated state of the transaction context\n                  navigate('/transaction/review', {\n                    state: `/manage/names/${lowerCaseDomain(\n                      name,\n                    )}/upgrade-undernames`,\n                  });\n                }\n          }\n          customBackStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n          customNextStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default UpgradeUndernames;\n"],"names":["UpgradeUndernames","isMobile","useIsMobile","location","useLocation","navigate","useNavigate","arweaveDataProvider","ioTicker","arioContract","useGlobalState","name","dispatchTransactionState","useTransactionState","record","setRecord","reactExports","antContract","setAntContract","undernameCount","setUndernameCount","newUndernameCount","setNewUndernameCount","loading","setLoading","fee","setFee","onLoad","eventEmitter","price","lowerCaseDomain","p","mIOToken","isARNSDomainNameValid","record2","processId","ArweaveTransactionID","contract","ANT","existingUndernameCount","r","k","error","jsxRuntimeExports","Loader","Counter","MAX_UNDERNAME_COUNT","TransactionCost","SvgInfo","WorkflowButtons","increaseUndernamePayload","ARNS_REGISTRY_ADDRESS","ARNS_INTERACTION_TYPES"],"mappings":"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"}
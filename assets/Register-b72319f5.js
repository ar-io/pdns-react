import{r as o,d as te,A as V,aU as le,j as e,aP as ce,bl as me,aQ as de,bm as ue,b2 as xe,bk as pe,b5 as M,bn as ee,aX as z,bo as he,c as ge,u as ve,a as be,bp as we,bq as re,br as ye,bs as Se,bt as je,bu as Ne,bv as Ie,bw as N,bx as ae,by as ke,bz as Ee,bA as se,bB as ne,bC as Te,bD as Ae,bE as Re,bF as Ce}from"./index-df90c1e3.js";import{C as Pe}from"./Counter-8b099878.js";import{S as oe}from"./HamburgerOutline-dcd4287f.js";import{P as De}from"./Pagination-2a27bba3.js";import{S as Le}from"./StepProgressBar-41081751.js";import"./useBreakpoint-ec5026cd.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[d]="8701453e-72e5-4493-b432-5c024d57b2b9",r._sentryDebugIdIdentifier="sentry-dbid-8701453e-72e5-4493-b432-5c024d57b2b9")}catch{}})();function fe(r){const[d,v]=o.useState(!1);return o.useEffect(()=>{if(!r)return;const a=document.getElementById(r);if(!a){console.error(`No element found with id: ${r}`);return}const f=()=>v(!0),u=()=>v(!1);return a.addEventListener("focus",f),a.addEventListener("blur",u),()=>{a.removeEventListener("focus",f),a.removeEventListener("blur",u)}},[r]),d}const ie={isReserved:!1,reservedFor:void 0};function Fe(r){const[{arweaveDataProvider:d}]=te(),[v,a]=o.useState(!1),[f,u]=o.useState(ie),[p,P]=o.useState(!1),[m,x]=o.useState(!1);o.useEffect(()=>{m||(r.length||w(),h(r))},[r]);function w(){a(!1),u(ie),P(!1)}async function h(y){try{if(w(),x(!0),P(!1),!y.length)return w();const E=d.isDomainAvailable({domain:y}),S=d.isDomainReserved({domain:y}),[L,I]=await Promise.all([E,S]);a(L),u({...I,reservedFor:I.reservedFor?new V(I.reservedFor):void 0}),P(!0)}catch(E){console.error(E),w()}finally{x(!1)}}return{isAvailable:v,isReserved:f==null?void 0:f.isReserved,reservedFor:f==null?void 0:f.reservedFor,loading:m,validated:p}}function Be({selectedTokenCallback:r}){var l;const[{arweaveDataProvider:d}]=te(),[{walletAddress:v}]=le(),[a,f]=o.useState(),[u,p]=o.useState(),[P,m]=o.useState(!1),[x,w]=o.useState(),[h,y]=o.useState(void 0),[E,S]=o.useState(!1),[L,I]=o.useState(!1),[X,_]=o.useState(void 0),B=fe("name-token-input"),T=o.useRef(null),[A,R]=o.useState(1),C=3;o.useEffect(()=>{r(h?new V(h.id):void 0),R(1)},[h]),o.useEffect(()=>{if(T.current)return document.addEventListener("click",$),()=>{document.removeEventListener("click",$)}},[T]);function $(t){T.current&&t.target!==T.current&&!T.current.contains(t.target)&&(f(""),I(!1),w(void 0),R(1))}async function D(t,i=[]){try{if(m(!0),!t)throw new Error("No address provided");const s=[],c=i.length?await Promise.all(i.map(async n=>{try{const g=ee.init({processId:n.toString()}),O=await g.getInfo();if(!g||!O)throw new Error("Unable to get contract");return _(!0),n}catch(g){z.emit("error",g)}})).then(n=>n.filter(g=>!!g)):[];if(!s.length&&!c.length)return;const b=s.concat(c),j=await d.getRecords({filters:{processId:b}}),k=await Promise.all(b.map(async n=>{const g=ee.init({processId:n.toString()}),O=Object.keys(j).reduce((H,Z)=>(j[Z].processId===n.toString()&&(H[Z]=j[Z]),H),{}),[G,J,Q,K]=await Promise.all([g.getOwner(),g.getControllers(),g.getTicker(),g.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:n,names:O,owner:G,controllers:J,ticker:Q,name:K}})).then(n=>n.filter(g=>!!g));if(!k.length)throw new Error("Unable to get details for Name Tokens");const F=k.reduce(async(n,g)=>{const{processId:O,owner:G,controllers:J,name:Q,ticker:K,names:H}=g;return{...n,[O.toString()]:{owner:G,controllers:J,name:Q,ticker:K,names:Object.keys(H)}}},{});if(p(await F),c.length){const n=F[c[0].toString()];y({name:n==null?void 0:n.name,ticker:n==null?void 0:n.ticker,id:c[0].toString(),names:(n==null?void 0:n.names)??[]})}}catch(s){z.emit("error",s)}finally{m(!1),R(1)}}function U(t){try{if(S(!0),_(void 0),!t){f("");return}if(f(t),!u)throw new Error("No Name Tokens Found");const i=Object.keys(u).filter(s=>{const{owner:c,controllers:b,name:j,ticker:k}=u[s];return[c,b,j,k,s].some(n=>n&&n.toString().toLowerCase().includes(t.toLowerCase()))}).map(s=>{const{name:c,ticker:b,names:j}=u[s];return{id:s,name:c??"",ticker:b??"",names:j}}).filter(s=>!!s);if(!i.length)throw new Error("No ANT tokens found for that search");w(i)}catch{w(void 0)}finally{S(!1),R(1)}}function W({id:t,name:i,ticker:s,names:c}){try{if(f(""),w(void 0),t===void 0)throw new Error(`No ID provided for ${i??s??""}`);y({id:t,name:i??"",ticker:s??"",names:c}),r(new V(t)),R(1)}catch(b){z.emit("error",b)}finally{I(!1)}}const q=(t,i,s)=>{if(u&&!(i==="next"||i==="prev"))return i==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:A==t?"white":"var(--text-grey)",width:"32px"},children:t}):s};function Y(t){R(t)}return e.jsxs("div",{ref:T,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:B||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(ce,{inputId:"name-token-input",onClick:()=>I(!0),showValidationIcon:!0,setValue:t=>U(t),value:a??"",maxCharLength:me,placeholder:h?(l=h.name)!=null&&l.length?h.name:h.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>d.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${h?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${h?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:P||E?e.jsx(ue,{size:20,color:"var(--text-white)"}):a&&X===!1?e.jsx(e.Fragment,{}):a&&xe(a)&&!Object.keys(u??[]).includes(a)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{D(v,[new V(a)])},children:"Import"}):h?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{y(void 0),r(void 0)},children:[e.jsx(pe,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(M,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),u&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[a&&!(x!=null&&x.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):x?x.slice(Math.max((A-1)*C,0),A*C).map((t,i)=>{var s;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{W({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(s=t.names)!=null&&s.length?e.jsx(M,{icon:e.jsx(oe,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(c=>e.jsx("span",{children:c},c))})},i):e.jsx(e.Fragment,{})]},i)}):Object.entries(u).slice(Math.max((A-1)*C,0),A*C).map((t,i)=>{if(!t)return;const[s,c]=t,{name:b,ticker:j,names:k}=c;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{W({id:s,name:b??"",ticker:j??"",names:k??[]})},children:[b&&j?`${b.slice(0,20)} ${b.length>20?"...":""} (${j}) - ${s}`:s,k!=null&&k.length?e.jsx(M,{icon:e.jsx(oe,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:k.map(F=>e.jsx("span",{children:F},F))})}):e.jsx(e.Fragment,{})]},i)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[u.length||x!=null&&x.length||!a?e.jsx(De,{total:Object.keys(u).length&&!x?Object.keys(u).length:x?x.length:0,itemRender:q,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:Y,current:A,defaultPageSize:C}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function We(){const[{domain:r,fee:d,leaseDuration:v,registrationType:a,antID:f,targetId:u},p]=he(),[{arweaveDataProvider:P,ioTicker:m,arioContract:x,ioProcessId:w}]=te(),[{walletAddress:h,balances:y}]=le(),[,E]=ge(),{name:S}=ve(),{loading:L}=Fe(S??r),[I,X]=o.useState(),_=fe("target-id-input"),B=be(),[T,A]=we(),[R,C]=o.useState(!1),[$,D]=o.useState(!1),U=d==null?void 0:d[m],W=U&&U<0;o.useEffect(()=>{if(T.get("redirect")&&S){if(!y[m])return;A(),Y();return}},[y,d]),o.useEffect(()=>{if(!x||!r||!m||!a)return;(async()=>{p({type:"setFee",payload:{ar:0,[m]:void 0}}),D(!0);const t=await x.getTokenCost({intent:"Buy-Record",name:r,type:a,years:v}).then(i=>new re(i).toIO().valueOf()).catch(()=>{});D(!1),p({type:"setFee",payload:{ar:0,[m]:t}})})()},[x,p,r,m,v,a]),o.useEffect(()=>{S&&r!==S&&p({type:"setDomainName",payload:S})},[S,r]);async function q(l){if(!l){p({type:"setANTID",payload:void 0});return}if(p({type:"setANTID",payload:l}),!ee.init({processId:l.toString()}))throw new Error("Contract not found")}if(!a)return e.jsx(ue,{size:80});async function Y(){try{if(!h){const c=new URLSearchParams({redirect:"true"});B("/connect",{state:{to:`/register/${r}?${c.toString()}`,from:`/register/${r}`}});return}D(!0);const i=await x.getBalance({address:h.toString()}).then(c=>new re(c).toIO()),s=ye({balances:{AR:y.ar,[m]:i.valueOf()},costs:{AR:d.ar,[m]:d[m]}});if(s.length){s.forEach(c=>{z.emit("error",new Se(c.message))});return}if(W)throw new Error("Issue calculating transaction cost.");if(R)throw new je("Please fix the errors above before continuing.")}catch(i){z.emit("error",i),D(!1);return}finally{D(!1)}const t={name:r&&Ne().test(r)?Ie(r):r,processId:(f==null?void 0:f.toString())??"atomic",years:a===N.LEASE?v:void 0,type:a,targetId:u};E({type:"setTransactionData",payload:{assetId:w,functionName:"buyRecord",...t,interactionPrice:d==null?void 0:d[m]}}),E({type:"setInteractionType",payload:ae.BUY_RECORD}),p({type:"reset"}),E({type:"setWorkflowName",payload:ae.BUY_RECORD}),B("/transaction/review",{state:`/register/${r}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(ke,{message:"Loading Domain info, please wait.",loading:L}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Le,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[r," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Ee,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>p({type:"setRegistrationType",payload:N.LEASE}),style:{position:"relative",background:a===N.LEASE?"var(--text-white)":"",color:a===N.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",a===N.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:a===N.BUY?"var(--text-white)":"",color:a===N.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>p({type:"setRegistrationType",payload:N.BUY}),children:["Buy"," ",a===N.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:a===N.LEASE?e.jsx(Pe,{value:v,setValue:l=>{p({type:"setLeaseDuration",payload:l})},minValue:se,maxValue:ne,valueStyle:{padding:"20px 120px"},valueName:v>1?"years":"year",detail:`Until ${Te(Date.now()+v*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${se}-${ne} years)`})}):a===N.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ae,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:_||I?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(ce,{inputId:"target-id-input",value:I??"",setValue:l=>{X(l.trim()),xe(l.trim())&&p({type:"setTargetId",payload:new V(l.trim())}),l.trim().length===0&&C(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:l=>P.validateArweaveId(l)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:l=>{C(!l)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(M,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Be,{selectedTokenCallback:l=>q(l)})]})},"1"),e.jsx(Re,{ioRequired:!0,fee:d,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(Ce,{nextText:"Next",backText:"Back",onNext:$?void 0:Y,onBack:()=>B("/",{state:`/register/${r}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{We as default};
//# sourceMappingURL=Register-b72319f5.js.map

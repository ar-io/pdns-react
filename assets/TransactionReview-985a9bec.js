import{aw as j,ax as h,ay as U,az as W,aA as k,aB as B,ap as u,l as y,aC as N,aD as S,e as D,j as a,a as L,B as P,a3 as F,b as M,E as X,r as g,aE as T,aF as Y,aq as q,X as z,W as G,av as H,aG as J}from"./index-f634a417.js";import{W as V}from"./WarningCard-a20f3d15.js";import{g as A,T as $}from"./transaction-descriptions-e6389ae4.js";import{S as K}from"./StepProgressBar-56805def.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="37b42603-de02-42b8-cf7b-0d34f884b995",e._sentryDebugIdIdentifier="sentry-dbid-37b42603-de02-42b8-cf7b-0d34f884b995")}catch{}})();async function Q({signer:e,module:s=U,luaCodeTxId:d=W,ao:c=k(),scheduler:f=B,state:i,stateContractTxId:n}){const r=await j.transactions.getData(d,{decode:!0,string:!0}),t=await c.spawn({module:s,scheduler:f,signer:await h.createAoSigner(e)}),o=new h({processId:t,ao:c});return await o.send({tags:[{name:"Action",value:"Eval"},{name:"App-Name",value:"ArNS-ANT"},{name:"Source-Code-TX-ID",value:d}],data:r,signer:e}),i&&await o.send({tags:[{name:"Action",value:"Initialize-State"},...n!==void 0?[{name:"State-Contract-TX-ID",value:n}]:[]],data:JSON.stringify(i),signer:e}),t}const Z="rYRd9foqUVvMScTnX63FuyUOaP5tmlJx5tG1btCx6sg";async function ee({payload:e,workflowName:s,owner:d,arioContract:c,processId:f,dispatch:i,signer:n}){let r,t;try{if(!c)throw new Error("ArIO provider is not defined");if(!n)throw new Error("signer is not defined");switch(i({type:"setSigning",payload:!0}),s){case u.BUY_RECORD:{const{name:w,type:x,years:m}=e;let p=e.processId;p==="atomic"&&(p=await Q({state:e.state,signer:n,luaCodeTxId:Z}));const l=await c.buyRecord({name:y(w),type:x,years:m,processId:p});e.processId=p,r=l,t=S.BUY_RECORD;break}case u.EXTEND_LEASE:r=await c.extendLease({name:y(e.name),years:e.years},N),t=S.EXTEND_RECORD;break;case u.INCREASE_UNDERNAMES:r=await c.increaseUndernameLimit({name:y(e.name),increaseCount:e.qty},N),t=S.INCREASE_UNDERNAME_COUNT;break;default:throw new Error(`Unsupported workflow name: ${s}`)}}catch(w){D.emit("error",w)}finally{i({type:"setSigning",payload:!1})}if(!r)throw new Error("Failed to dispatch ArIO interaction");if(!t)throw new Error("Failed to set workflow name");const o={deployer:d.toString(),processId:f.toString(),id:r.id,payload:{...e,function:t},type:"interaction"};return i({type:"setWorkflowName",payload:s}),i({type:"setInteractionResult",payload:o}),o}function b({workflowName:e,...s}){switch(e){case u.INCREASE_UNDERNAMES:case u.EXTEND_LEASE:return a.jsx("h1",{className:"flex white",style:{width:"100%",paddingBottom:"30px"},children:"Review"});case u.BUY_RECORD:return"Review your Purchase";default:return}}function re(){const e=L(),[{ioTicker:s,arioContract:d,arnsContractId:c}]=P(),[{walletAddress:f,wallet:i}]=F(),[{workflowName:n,interactionType:r,transactionData:t,interactionResult:o},w]=M(),x=X(),[m,p]=g.useState(),[l,R]=g.useState(T(r)),[E,_]=g.useState(b({workflowName:n})),[I,v]=g.useState(A({workflowName:n,ioTicker:s}));g.useEffect(()=>{if(!t&&!n){e("/");return}p(Y({interactionType:r,transactionData:{...t,deployedTransactionId:o==null?void 0:o.id}})),v(A({workflowName:n,ioTicker:s})),R(T(r)),_(b({workflowName:n}))},[t,o,n,r,f]);async function C(){try{if(!(d instanceof J))throw new Error("Wallet must be connected to dispatch transactions.");if(!t||!n)throw new Error("Transaction data is missing");if(!f)throw new Error("Wallet address is missing");await ee({arioContract:d,workflowName:n,payload:t,owner:f,processId:c,dispatch:w,signer:i==null?void 0:i.arconnectSigner}),e("/transaction/complete")}catch(O){D.emit("error",O)}}return m?a.jsx("div",{className:"page",children:a.jsxs("div",{className:"flex flex-column center",style:x?{}:{gap:"0px",maxWidth:"900px",width:"100%"},children:[l&&l.length?a.jsx("div",{className:"flex flex-row",style:{marginBottom:"20px",width:"100%"},children:a.jsx(K,{stage:3,stages:l})}):a.jsx(a.Fragment,{}),typeof E=="string"?a.jsx("div",{className:"flex flex-row text-large white bold center",style:{height:"100%",padding:"50px 0px",borderTop:l!=null&&l.length?"solid 1px var(--text-faded)":""},children:E}):E,a.jsx(z,{...m,bordered:!0,compact:!0}),a.jsx($,{feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"},fee:{[s]:t==null?void 0:t.interactionPrice},info:I&&a.jsx("div",{children:a.jsx(V,{wrapperStyle:{padding:"10px",fontSize:"14px",alignItems:"center"},customIcon:a.jsx(G,{width:"20px",fill:"var(--accent)"}),text:I})})}),a.jsx("div",{className:"flex",style:{marginTop:20,width:"100%",justifyContent:"flex-end"},children:a.jsx(H,{onNext:()=>C(),onBack:()=>e(-1),backText:"Back",nextText:"Confirm"})})]})}):a.jsx(q,{loading:!0,message:"Loading transaction data..."})}export{re as default};
//# sourceMappingURL=TransactionReview-985a9bec.js.map

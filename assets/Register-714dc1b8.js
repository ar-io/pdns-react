import{x as ie,$ as oe,r as c,a5 as ce,A as U,j as e,V as le,a6 as pe,F as de,a0 as xe,B as ue,a7 as me,a8 as Y,a9 as ee,e as F,aa as fe,b as he,u as ge,ab as we,a as ye,ac as ve,ad as te,ae as be,af as Se,ag as je,ah as Ne,ai as ke,aj as y,ak as Ie,al as ae,am as Te,an as Ee,ao as re,M as se,ap as Re,aq as Ae,ar as Ce}from"./index-6123a64c.js";import{C as Pe}from"./Counter-7ab00ecd.js";import{S as ne}from"./HamburgerOutline-0f4f9bad.js";import{P as De}from"./Pagination-68f62c1d.js";import{T as Le}from"./TransactionCost-5a11f36b.js";import{S as Be}from"./StepProgressBar-d5c45363.js";import"./useBreakpoint-c8c70551.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new Error().stack;l&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[l]="fa378897-52eb-4b5c-6ba4-6184fc718679",s._sentryDebugIdIdentifier="sentry-dbid-fa378897-52eb-4b5c-6ba4-6184fc718679")}catch{}})();function Oe({selectedTokenCallback:s}){var C;const[{arweaveDataProvider:l}]=ie(),[{walletAddress:b}]=oe(),[n,j]=c.useState(),[m,f]=c.useState(),[H,h]=c.useState(!1),[d,E]=c.useState(),[p,R]=c.useState(void 0),[N,_]=c.useState(!1),[L,B]=c.useState(!1),[M,P]=c.useState(void 0),G=ce("name-token-input"),k=c.useRef(null),[I,S]=c.useState(1),A=3;c.useEffect(()=>{s(p?new U(p.id):void 0),S(1)},[p]),c.useEffect(()=>{if(k.current)return document.addEventListener("click",T),()=>{document.removeEventListener("click",T)}},[k]);function T(t){k.current&&t.target!==k.current&&!k.current.contains(t.target)&&(j(""),B(!1),E(void 0),S(1))}async function V(t,o=[]){try{if(h(!0),!t)throw new Error("No address provided");const a=[],x=o.length?await Promise.all(o.map(async r=>{try{const u=ee.init({processId:r.toString()}),O=await u.getInfo();if(!u||!O)throw new Error("Unable to get contract");return P(!0),r}catch(u){F.emit("error",u)}})).then(r=>r.filter(u=>!!u)):[];if(!a.length&&!x.length)return;const g=a.concat(x),w=await l.getRecords({filters:{processId:g}}),v=await Promise.all(g.map(async r=>{const u=ee.init({processId:r.toString()}),O=Object.keys(w).reduce((W,Z)=>(w[Z].processId===r.toString()&&(W[Z]=w[Z]),W),{}),[J,X,Q,K]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:r,names:O,owner:J,controllers:X,ticker:Q,name:K}})).then(r=>r.filter(u=>!!u));if(!v.length)throw new Error("Unable to get details for Name Tokens");const D=v.reduce(async(r,u)=>{const{processId:O,owner:J,controllers:X,name:Q,ticker:K,names:W}=u;return{...r,[O.toString()]:{owner:J,controllers:X,name:Q,ticker:K,names:Object.keys(W)}}},{});if(f(await D),x.length){const r=D[x[0].toString()];R({name:r==null?void 0:r.name,ticker:r==null?void 0:r.ticker,id:x[0].toString(),names:(r==null?void 0:r.names)??[]})}}catch(a){F.emit("error",a)}finally{h(!1),S(1)}}function q(t){try{if(_(!0),P(void 0),!t){j("");return}if(j(t),!m)throw new Error("No Name Tokens Found");const o=Object.keys(m).filter(a=>{const{owner:x,controllers:g,name:w,ticker:v}=m[a];return[x,g,w,v,a].some(r=>r&&r.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:x,ticker:g,names:w}=m[a];return{id:a,name:x??"",ticker:g??"",names:w}}).filter(a=>!!a);if(!o.length)throw new Error("No ANT tokens found for that search");E(o)}catch{E(void 0)}finally{_(!1),S(1)}}function $({id:t,name:o,ticker:a,names:x}){try{if(j(""),E(void 0),t===void 0)throw new Error(`No ID provided for ${o??a??""}`);R({id:t,name:o??"",ticker:a??"",names:x}),s(new U(t)),S(1)}catch(g){F.emit("error",g)}finally{B(!1)}}const z=(t,o,a)=>{if(m&&!(o==="next"||o==="prev"))return o==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:I==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function i(t){S(t)}return e.jsxs("div",{ref:k,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:G||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(le,{inputId:"name-token-input",onClick:()=>B(!0),showValidationIcon:!0,setValue:t=>q(t),value:n??"",maxCharLength:pe,placeholder:p?(C=p.name)!=null&&C.length?p.name:p.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>l.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${p?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${p?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:H||N?e.jsx(xe,{size:20,color:"var(--text-white)"}):n&&M===!1?e.jsx(e.Fragment,{}):n&&ue(n)&&!Object.keys(m??[]).includes(n)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{V(b,[new U(n)])},children:"Import"}):p?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{R(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(Y,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),m&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[n&&!(d!=null&&d.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):d?d.slice(Math.max((I-1)*A,0),I*A).map((t,o)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(x=>e.jsx("span",{children:x},x))})},o):e.jsx(e.Fragment,{})]},o)}):Object.entries(m).slice(Math.max((I-1)*A,0),I*A).map((t,o)=>{if(!t)return;const[a,x]=t,{name:g,ticker:w,names:v}=x;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:a,name:g??"",ticker:w??"",names:v??[]})},children:[g&&w?`${g.slice(0,20)} ${g.length>20?"...":""} (${w}) - ${a}`:a,v!=null&&v.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:v.map(D=>e.jsx("span",{children:D},D))})}):e.jsx(e.Fragment,{})]},o)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[m.length||d!=null&&d.length||!n?e.jsx(De,{total:Object.keys(m).length&&!d?Object.keys(m).length:d?d.length:0,itemRender:z,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:i,current:I,defaultPageSize:A}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Ye(){const[{domain:s,fee:l,leaseDuration:b,registrationType:n,antID:j,targetId:m},f]=fe(),[{arweaveDataProvider:H,ioTicker:h,arioContract:d}]=ie(),[{walletAddress:E,balances:p}]=oe(),[,R]=he(),{name:N}=ge(),{loading:_}=we(N??s),[L,B]=c.useState(),M=ce("target-id-input"),P=ye(),[G,k]=ve(),[I,S]=c.useState(!1),[A,T]=c.useState(!1),V=l==null?void 0:l[h],q=V&&V<0;c.useEffect(()=>{if(G.get("redirect")&&N){if(!p[h])return;k(),z();return}},[p,l]),c.useEffect(()=>{if(!d||!s||!h||!n)return;(async()=>{f({type:"setFee",payload:{ar:0,[h]:void 0}}),T(!0);const C=await d.getTokenCost({intent:"Buy-Record",name:s,purchaseType:n,years:b}).then(t=>new te(t).toIO().valueOf()).catch(()=>{});T(!1),f({type:"setFee",payload:{ar:0,[h]:C}})})()},[d,f,s,h,b,n]),c.useEffect(()=>{N&&s!==N&&f({type:"setDomainName",payload:N})},[N,s]);async function $(i){if(!i){f({type:"setANTID",payload:void 0});return}if(f({type:"setANTID",payload:i}),!ee.init({processId:i.toString()}))throw new Error("Contract not found")}if(!n)return e.jsx(xe,{size:80});async function z(){try{if(!E){const a=new URLSearchParams({redirect:"true"});P("/connect",{state:{to:`/register/${s}?${a.toString()}`,from:`/register/${s}`}});return}T(!0);const t=await d.getBalance({address:E.toString()}).then(a=>new te(a).toIO()),o=be({balances:{AR:p.ar,[h]:t.valueOf()},costs:{AR:l.ar,[h]:l[h]}});if(o.length){o.forEach(a=>{F.emit("error",new Se(a.message))});return}if(q)throw new Error("Issue calculating transaction cost.");if(I)throw new je("Please fix the errors above before continuing.")}catch(t){F.emit("error",t),T(!1);return}finally{T(!1)}const C={name:s&&Ne().test(s)?ke(s):s,processId:(j==null?void 0:j.toString())??"atomic",years:n===y.LEASE?b:void 0,type:n,targetId:m};R({type:"setTransactionData",payload:{assetId:Ie.toString(),functionName:"buyRecord",...C,interactionPrice:l==null?void 0:l[h]}}),R({type:"setInteractionType",payload:ae.BUY_RECORD}),f({type:"reset"}),R({type:"setWorkflowName",payload:ae.BUY_RECORD}),P("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Te,{message:"Loading Domain info, please wait.",loading:_}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Be,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Ee,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>f({type:"setRegistrationType",payload:y.LEASE}),style:{position:"relative",background:n===y.LEASE?"var(--text-white)":"",color:n===y.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",n===y.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:n===y.BUY?"var(--text-white)":"",color:n===y.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>f({type:"setRegistrationType",payload:y.BUY}),children:["Buy"," ",n===y.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:n===y.LEASE?e.jsx(Pe,{value:b,setValue:i=>{f({type:"setLeaseDuration",payload:i})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:b>1?"years":"year",detail:`Until ${Re(Date.now()+b*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):n===y.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ae,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:M||L?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(le,{inputId:"target-id-input",value:L??"",setValue:i=>{B(i.trim()),ue(i.trim())&&f({type:"setTargetId",payload:new U(i.trim())}),i.trim().length===0&&S(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:i=>H.validateArweaveId(i)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:i=>{S(!i)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(Y,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Oe,{selectedTokenCallback:i=>$(i)})]})},"1"),e.jsx(Le,{ioRequired:!0,fee:l,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(Ce,{nextText:"Next",backText:"Back",onNext:A?void 0:z,onBack:()=>P("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{Ye as default};
//# sourceMappingURL=Register-714dc1b8.js.map

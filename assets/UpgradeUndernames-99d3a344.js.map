{"version":3,"file":"UpgradeUndernames-99d3a344.js","sources":["../../src/components/layout/UpgradeUndernames/UpgradeUndernames.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { useIsMobile } from '../../../hooks';\nimport { ANTContract } from '../../../services/arweave/ANTContract';\nimport { ArweaveTransactionID } from '../../../services/arweave/ArweaveTransactionID';\nimport { useGlobalState } from '../../../state/contexts/GlobalState';\nimport { useTransactionState } from '../../../state/contexts/TransactionState';\nimport {\n  ARNSRecordEntry,\n  INTERACTION_NAMES,\n  INTERACTION_TYPES,\n  IncreaseUndernamesPayload,\n} from '../../../types';\nimport { isARNSDomainNameValid, lowerCaseDomain, sleep } from '../../../utils';\nimport {\n  ARNS_REGISTRY_ADDRESS,\n  MAX_UNDERNAME_COUNT,\n} from '../../../utils/constants';\nimport eventEmitter from '../../../utils/events';\nimport { InfoIcon } from '../../icons';\nimport Counter from '../../inputs/Counter/Counter';\nimport WorkflowButtons from '../../inputs/buttons/WorkflowButtons/WorkflowButtons';\nimport Loader from '../Loader/Loader';\nimport TransactionCost from '../TransactionCost/TransactionCost';\n\nfunction UpgradeUndernames() {\n  const isMobile = useIsMobile();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const [{ arweaveDataProvider, ioTicker }] = useGlobalState();\n  const name = location.pathname.split('/').at(-2);\n  const [, dispatchTransactionState] = useTransactionState();\n  const [record, setRecord] = useState<ARNSRecordEntry>();\n  const [antContract, setAntContract] = useState<ANTContract>();\n  // min count of 1 ~ contract rule\n  const [newUndernameCount, setNewUndernameCount] = useState<number>(0);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [fee, setFee] = useState<number | undefined>(0);\n\n  useEffect(() => {\n    onLoad();\n  }, [name]);\n\n  useEffect(() => {\n    if (!name || !record) {\n      return;\n    }\n    setFee(undefined);\n    const updateFee = async () => {\n      if (newUndernameCount === 0) {\n        setFee(0);\n        return;\n      }\n      if (Number.isNaN(newUndernameCount)) {\n        eventEmitter.emit(\n          'error',\n          new Error('Invalid undername count, must be a number greater than 0'),\n        );\n      }\n      const price = await arweaveDataProvider\n        .getPriceForInteraction({\n          interactionName: INTERACTION_NAMES.INCREASE_UNDERNAME_COUNT,\n          payload: {\n            name: name,\n            qty: newUndernameCount,\n          },\n        })\n        .catch(() => {\n          eventEmitter.emit(\n            'error',\n            new Error('Unable to get price for undername increase'),\n          );\n          return -1;\n        });\n\n      setFee(price);\n    };\n\n    updateFee();\n  }, [newUndernameCount, record, name]);\n\n  async function onLoad() {\n    try {\n      setLoading(true);\n      if (name && isARNSDomainNameValid({ name: lowerCaseDomain(name) })) {\n        const record = await arweaveDataProvider.getRecord({\n          domain: lowerCaseDomain(name),\n        });\n        if (!record) {\n          throw new Error(`Unable to get record for ${name}`);\n        }\n        setRecord(record);\n        const contractTxId = new ArweaveTransactionID(record?.contractTxId);\n        const contract = await arweaveDataProvider.buildANTContract(\n          contractTxId,\n        );\n        if (!contract.state) {\n          throw new Error(`Unable to get contract state for ${name}`);\n        }\n\n        if (!contract.isValid) {\n          throw new Error(`Invalid contract for ${name}`);\n        }\n        setAntContract(contract);\n      }\n    } catch (error) {\n      eventEmitter.emit('error', error);\n      await sleep(2000); // TODO: why are we sleeping for 2 seconds?\n      navigate(`/manage/names`);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (loading || !record || !antContract || !name) {\n    return (\n      <div className=\"page center\">\n        <Loader size={80} message=\"Loading domain record\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"page center\">\n      <div className=\"flex flex-column\" style={{ maxWidth: '1000px' }}>\n        <h1 className=\"flex white\">Increase Undernames</h1>\n        <div\n          className=\"flex center\"\n          style={{\n            justifyContent: 'space-between',\n            border: '1px solid var(--text-faded)',\n            padding: '35px 40px',\n            borderRadius: 'var(--corner-radius)',\n            flexDirection: isMobile ? 'column' : 'row',\n            gap: '30px',\n          }}\n        >\n          <div\n            className=\"flex flex-column\"\n            style={{ fontSize: '16px', width: 'fit-content', gap: '5px' }}\n          >\n            <span\n              className=\"flex grey center\"\n              style={{ gap: '8px', whiteSpace: 'nowrap' }}\n            >\n              Total Undernames:{' '}\n              <span className=\"white\">{record.undernames}</span>\n              <span className=\"flex add-box center\" style={{}}>\n                +{newUndernameCount}\n              </span>\n            </span>\n            <span className=\"flex grey\">\n              Used:&nbsp;\n              <span className=\"white\">\n                {Object.keys(antContract.records).length - 1}\n              </span>\n            </span>\n          </div>\n          <Counter\n            maxValue={MAX_UNDERNAME_COUNT - record.undernames}\n            minValue={0}\n            value={newUndernameCount}\n            setValue={setNewUndernameCount}\n            containerStyle={{\n              width: 'fit-content',\n              justifyContent: 'center',\n              alignItems: 'center',\n            }}\n            valueStyle={{\n              background: 'var(--card-bg)',\n              width: '50px',\n              height: '40px',\n              alignItems: 'center',\n              justifyContent: 'center',\n              border: '1px solid var(--text-faded)',\n              borderRadius: 'var(--corner-radius)',\n              margin: '0px 10px',\n              fontSize: '14px',\n            }}\n            editable={true}\n          />\n        </div>\n        <TransactionCost\n          ioRequired={true}\n          fee={{\n            [ioTicker]: fee,\n            ar: 0,\n          }}\n          info={\n            <div\n              className=\"flex flex-row flex-left\"\n              style={{\n                gap: '10px',\n                maxWidth: '50%',\n                justifyContent: 'flex-start',\n                alignItems: 'flex-start',\n              }}\n            >\n              <InfoIcon\n                width={'20px'}\n                height={'20px'}\n                fill=\"var(--text-grey)\"\n              />\n              <span\n                className=\"flex flex-column flex-left grey text\"\n                style={{ textAlign: 'left', lineHeight: '1.5em' }}\n              >\n                Increasing your undernames is paid in {ioTicker} tokens, and an\n                Arweave network fee paid in AR tokens.\n              </span>\n            </div>\n          }\n        />\n        <WorkflowButtons\n          backText=\"Cancel\"\n          nextText=\"Confirm\"\n          onBack={() => navigate(`/manage/names/${name}`)}\n          onNext={\n            !fee || fee < 0\n              ? undefined\n              : () => {\n                  const increaseUndernamePayload: IncreaseUndernamesPayload = {\n                    name: lowerCaseDomain(name),\n                    qty: newUndernameCount,\n                    oldQty: record.undernames,\n                    contractTxId: record.contractTxId,\n                  };\n                  dispatchTransactionState({\n                    type: 'setTransactionData',\n                    payload: {\n                      assetId: ARNS_REGISTRY_ADDRESS.toString(),\n                      functionName: 'increaseUndernameCount',\n                      ...increaseUndernamePayload,\n                      interactionPrice: fee,\n                    },\n                  });\n                  dispatchTransactionState({\n                    type: 'setInteractionType',\n                    payload: INTERACTION_TYPES.INCREASE_UNDERNAMES,\n                  });\n                  // navigate to the transaction page, which will load the updated state of the transaction context\n                  navigate('/transaction', {\n                    state: `/manage/names/${name}/upgrade-undernames`,\n                  });\n                }\n          }\n          customBackStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n          customNextStyle={{\n            minWidth: '100px',\n            padding: ' 12px 16px',\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default UpgradeUndernames;\n"],"names":["UpgradeUndernames","isMobile","useIsMobile","location","useLocation","navigate","useNavigate","arweaveDataProvider","ioTicker","useGlobalState","name","dispatchTransactionState","useTransactionState","record","setRecord","reactExports","antContract","setAntContract","newUndernameCount","setNewUndernameCount","loading","setLoading","fee","setFee","onLoad","eventEmitter","price","INTERACTION_NAMES","isARNSDomainNameValid","lowerCaseDomain","record2","contractTxId","ArweaveTransactionID","contract","error","sleep","jsxRuntimeExports","Loader","Counter","MAX_UNDERNAME_COUNT","TransactionCost","SvgInfo","WorkflowButtons","increaseUndernamePayload","ARNS_REGISTRY_ADDRESS","INTERACTION_TYPES"],"mappings":"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"}
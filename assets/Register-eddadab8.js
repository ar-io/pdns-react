import{r as p,y as ne,b as ie,a5 as oe,A as F,a6 as ge,f as D,j as e,V as le,Q,F as J,U as ce,G as de,a7 as me,T as G,P as fe,a8 as we,c as ye,u as ve,a9 as be,aa as Se,ab as Ae,a as Ne,ac as Ce,ad as Te,ae as je,af as Ie,ag as Ee,ah as ke,ai as Re,aj as X,ak as h,al as Be,am as De,an as Pe,ao as K,ap as ee,aq as Le,ar as te,M as ae,as as Ve,at as Fe,au as Oe,av as _e,aw as Ue}from"./index-7a6bb8c8.js";import{C as ze}from"./Counter-2f6ddcc1.js";import{S as re}from"./HamburgerOutline-db488fdd.js";import{T as We}from"./TransactionCost-1196e164.js";import{S as Ye}from"./StepProgressBar-2538469a.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="3d96fee9-46c6-4361-6910-1f3e4d26c912",s._sentryDebugIdIdentifier="sentry-dbid-3d96fee9-46c6-4361-6910-1f3e4d26c912")}catch{}})();const se=s=>p.createElement("svg",{width:"current",height:"current",viewBox:"0 0 16 18",fill:"current",xmlns:"http://www.w3.org/2000/svg",...s},p.createElement("path",{d:"M14.25 6.25H11.75V4.375C11.75 3.38044 11.3549 2.42661 10.6517 1.72335C9.94839 1.02009 8.99456 0.625 8 0.625C7.00544 0.625 6.05161 1.02009 5.34835 1.72335C4.64509 2.42661 4.25 3.38044 4.25 4.375V6.25H1.75C1.41848 6.25 1.10054 6.3817 0.866116 6.61612C0.631696 6.85054 0.5 7.16848 0.5 7.5V16.25C0.5 16.5815 0.631696 16.8995 0.866116 17.1339C1.10054 17.3683 1.41848 17.5 1.75 17.5H14.25C14.5815 17.5 14.8995 17.3683 15.1339 17.1339C15.3683 16.8995 15.5 16.5815 15.5 16.25V7.5C15.5 7.16848 15.3683 6.85054 15.1339 6.61612C14.8995 6.3817 14.5815 6.25 14.25 6.25ZM5.5 4.375C5.5 3.71196 5.76339 3.07607 6.23223 2.60723C6.70107 2.13839 7.33696 1.875 8 1.875C8.66304 1.875 9.29893 2.13839 9.76777 2.60723C10.2366 3.07607 10.5 3.71196 10.5 4.375V6.25H5.5V4.375ZM14.25 16.25H1.75V7.5H14.25V16.25ZM8.9375 11.875C8.9375 12.0604 8.88252 12.2417 8.7795 12.3958C8.67649 12.55 8.53007 12.6702 8.35877 12.7411C8.18746 12.8121 7.99896 12.8307 7.8171 12.7945C7.63525 12.7583 7.4682 12.669 7.33709 12.5379C7.20598 12.4068 7.11669 12.2398 7.08051 12.0579C7.04434 11.876 7.06291 11.6875 7.13386 11.5162C7.20482 11.3449 7.32498 11.1985 7.47915 11.0955C7.63332 10.9925 7.81458 10.9375 8 10.9375C8.24864 10.9375 8.4871 11.0363 8.66291 11.2121C8.83873 11.3879 8.9375 11.6264 8.9375 11.875Z",fill:"current"}));function $e({selectedTokenCallback:s}){var H;const[{arweaveDataProvider:n}]=ne(),[{walletAddress:w}]=ie(),[o,A]=p.useState(),[m,g]=p.useState(),[O,C]=p.useState(!1),[c,k]=p.useState(),[y,T]=p.useState(void 0),[P,R]=p.useState(!1),[N,t]=p.useState(!1),[B,_]=p.useState(void 0),U=oe("name-token-input"),j=p.useRef(null),[I,S]=p.useState(1),E=3;p.useEffect(()=>{s(y?new F(y.id):void 0),S(1)},[y]),p.useEffect(()=>{w&&W(w)},[w]),p.useEffect(()=>{if(j.current)return document.addEventListener("click",z),()=>{document.removeEventListener("click",z)}},[j]);function z(a){j.current&&a.target!==j.current&&!j.current.contains(a.target)&&(A(""),t(!1),k(void 0),S(1))}async function W(a,x=[]){try{if(C(!0),!a)throw new Error("No address provided");const{contractTxIds:i}=await n.getContractsForWallet(a,"ant").catch(()=>{throw new Error("Unable to get contracts for wallet")}),r=x.length?await Promise.all(x.map(async l=>{try{await n.validateTransactionTags({id:l.toString(),requiredTags:{"App-Name":["SmartWeaveContract"]}}).catch(()=>{throw new Error("Import is not a SmartWeave Contract")});const b=await n.getContractState(l);if(!Object.keys(b).length)throw new Error("Unable to get Contract State");if(!new ge(b).isValid())throw new Error("Invalid ANT Contract.");return _(!0),l}catch(b){D.emit("error",b)}})).then(l=>l.filter(b=>!!b)):[];if(!i.length&&!r.length)return;const d=i.concat(r),u=await n.getRecords({filters:{contractTxId:d}}),f=await Promise.all(d.map(async l=>{const b=await n.buildANTContract(l).catch(()=>{throw new Error("Unable to get Contract State")});if(!b.isValid())throw new Error("Invalid ANT Contract.");const Z=Object.keys(u).reduce((q,V)=>(u[V].contractTxId===l.toString()&&(q[V]=u[V]),q),{});return[l,b.state,Z]}));if(!f.length)throw new Error("Unable to get details for Name Tokens");const v=f.reduce((l,b)=>{if(!b)return{...l};const[Z,q,V]=b,{owner:xe,controller:pe,name:ue,ticker:he}=q;return{...l,[Z.toString()]:{owner:xe,controller:pe,name:ue,ticker:he,names:Object.keys(V)}}},{});if(g(v),r.length){const l=v[r[0].toString()];T({name:l==null?void 0:l.name,ticker:l==null?void 0:l.ticker,id:r[0].toString(),names:(l==null?void 0:l.names)??[]})}}catch(i){D.emit("error",i)}finally{C(!1),S(1)}}function Y(a){try{if(R(!0),_(void 0),!a){A("");return}if(A(a),!m)throw new Error("No Name Tokens Found");const x=Object.keys(m).filter(i=>{const{owner:r,controller:d,name:u,ticker:f}=m[i];return[r,d,u,f,i].some(l=>l&&l.toString().toLowerCase().includes(a.toLowerCase()))}).map(i=>{const{name:r,ticker:d,names:u}=m[i];return{id:i,name:r??"",ticker:d??"",names:u}}).filter(i=>!!i);if(!x.length)throw new Error("No ANT tokens found for that search");k(x)}catch{k(void 0)}finally{R(!1),S(1)}}function $({id:a,name:x,ticker:i,names:r}){try{if(A(""),k(void 0),a===void 0)throw new Error(`No ID provided for ${x??i??""}`);T({id:a,name:x??"",ticker:i??"",names:r}),s(new F(a)),S(1)}catch(d){D.emit("error",d)}finally{t(!1)}}const L=(a,x,i)=>{if(m&&!(x==="next"||x==="prev"))return x==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:I==a?"white":"var(--text-grey)",width:"32px"},children:a}):i};function M(a){S(a)}return e.jsxs("div",{ref:j,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:U||N?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(le,{inputId:"name-token-input",onClick:()=>t(!0),showValidationIcon:B!==void 0,setValue:a=>Y(a.length===Q?a.trim():a),value:o??"",maxCharLength:Q,placeholder:y?(H=y.name)!=null&&H.length?y.name:y.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[J.SMARTWEAVE_CONTRACT]:{fn:a=>n.validateTransactionTags({id:a,requiredTags:{"App-Name":["SmartWeaveContract"]}})},[J.TRANSACTION_CONFIRMATIONS]:{fn:a=>n.validateConfirmations(a)}},validityCallback:a=>a,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${y?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${y?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:O||P?e.jsx(ce,{size:20,color:"var(--text-white)"}):o&&B===!1?e.jsx(e.Fragment,{}):o&&de(o)&&!Object.keys(m??[]).includes(o)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{W(w,[new F(o)])},children:"Import"}):y?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{T(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(G,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"You can import an ANT by entering its contract ID, or search for one of your own by name, ticker, owner, or controller status, as well is its own contract ID",children:"Optional"})})]}),m&&N?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[o&&!(c!=null&&c.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):c?c.slice(Math.max((I-1)*E,0),I*E).map((a,x)=>{var i;if(a)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:a.id,name:a.name??"",ticker:a.ticker??"",names:a.names??[]})},children:[a.name&&a.ticker?`${a.name.slice(0,20)} (${a.ticker}) - ${a.id}`:a.id,(i=a.names)!=null&&i.length?e.jsxs(G,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:a.names.map(r=>e.jsx("span",{children:r},r))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(re,{width:20,height:20,fill:"var(--text-grey)"})," "]},x):e.jsx(e.Fragment,{})]},x)}):Object.entries(m).slice(Math.max((I-1)*E,0),I*E).map((a,x)=>{if(!a)return;const[i,r]=a,{name:d,ticker:u,names:f}=r;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:i,name:d??"",ticker:u??"",names:f??[]})},children:[d&&u?`${d.slice(0,20)} ${d.length>20?"...":""} (${u}) - ${i}`:i,f!=null&&f.length?e.jsxs(G,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:f.map(v=>e.jsx("span",{children:v},v))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(re,{width:20,height:20,fill:"var(--text-grey)"})," "]}):e.jsx(e.Fragment,{})]},x)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[m.length||c!=null&&c.length||!o?e.jsx(fe,{total:Object.keys(m).length&&!c?Object.keys(m).length:c?c.length:0,itemRender:L,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:M,current:I,defaultPageSize:E}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Je(){var i;const[{domain:s,fee:n,leaseDuration:w,registrationType:o,antID:A,targetId:m},g]=we(),[{blockHeight:O,arweaveDataProvider:C,ioTicker:c,arioContract:k},y]=ne(),[{walletAddress:T,balances:P}]=ie(),[,R]=ye(),{name:N}=ve(),{auction:t,loadingAuctionInfo:B}=be(Se(N??s),o),{loading:_}=Ae(N??s),[U,j]=p.useState(),I=oe("target-id-input"),S=Ne(),[E,z]=Ce(),[W,Y]=p.useState(!1),[$,L]=p.useState(!1),M=n==null?void 0:n[c],H=M&&M<0;p.useEffect(()=>{if(E.get("redirect")&&N){if(!P[c])return;z(),x();return}},[P,n]),p.useEffect(()=>{O||C.getCurrentBlockHeight().then(r=>{y({type:"setBlockHeight",payload:r})}),!B&&t&&g({type:"setRegistrationType",payload:t.type})},[B,s]),p.useEffect(()=>{if(N&&s!==N&&g({type:"setDomainName",payload:N}),t&&(t.isRequiredToBeAuctioned||t.isActive)&&s&&O)g({type:"setFee",payload:{ar:n.ar,[c]:t.currentPrice}});else{if(!t)return;(async()=>{if(s)try{g({type:"setFee",payload:{ar:n.ar,[c]:void 0}});const d=await C.getArPrice(_e),u=await C.getPriceForInteraction({interactionName:Ue.BUY_RECORD,payload:{name:s,years:w,type:t.type,contractTxId:X}}).catch(()=>{throw new Error("Unable to get purchase price for domain")});g({type:"setFee",payload:{ar:d,[c]:u}})}catch(d){D.emit("error",d)}})()}},[w,s,t]);async function a(r){try{const d=new F(r.toString());if(g({type:"setANTID",payload:d}),!(await C.buildANTContract(d)).isValid())throw Error("ANT contract state does not match required schema.")}catch(d){console.error(d)}}if(!o)return e.jsx(ce,{size:80});async function x(){try{if(!T){const v=new URLSearchParams({redirect:"true"});S("/connect",{state:{to:`/register/${s}?${v.toString()}`,from:`/register/${s}`}});return}L(!0);const u=await k.getBalance({address:T.toString()}).then(v=>new Te(v).toIO()),f=je({balances:{AR:P.ar,[c]:u.valueOf()},costs:{AR:n.ar,[c]:n[c]}});if(f.length){f.forEach(v=>{D.emit("error",new Ie(v.message))});return}if(H)throw new Error("Issue calculating transaction cost.");if(W)throw new Ee("Please fix the errors above before continuing.")}catch(u){D.emit("error",u),L(!1);return}finally{L(!1)}const r=t!=null&&t.isRequiredToBeAuctioned?1:w,d={name:s&&ke().test(s)?Re(s):s,contractTxId:A?A.toString():X,years:o===h.LEASE?r:void 0,type:o,auction:((t==null?void 0:t.isRequiredToBeAuctioned)||(t==null?void 0:t.isActive))??!1,isBid:(t==null?void 0:t.isActive)??!1,targetId:m};R({type:"setTransactionData",payload:{walletAddress:T,assetId:Be.toString(),functionName:"buyRecord",...d,state:A?await De.init({contractTxId:A.toString()}).getState():Pe(s,T),interactionPrice:n==null?void 0:n[c]}}),R({type:"setInteractionType",payload:K.BUY_RECORD}),g({type:"reset"}),R({type:"setWorkflowName",payload:K.BUY_RECORD}),S("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(ee,{message:"Loading Domain info, please wait.",loading:B||_}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",margin:"50px",gap:"80px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"40px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Ye,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Le,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"25px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",disabled:(t==null?void 0:t.isActive)&&o===h.BUY,onClick:()=>g({type:"setRegistrationType",payload:h.LEASE}),style:{position:"relative",background:o===h.LEASE?"var(--text-white)":"",color:o===h.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",(o===h.LEASE||(t==null?void 0:t.type)===h.LEASE)&&(t!=null&&t.isActive)?e.jsx(se,{width:"20px",height:"20px",fill:"var(--text-black)",style:{position:"absolute",right:"20px"}}):e.jsx(e.Fragment,{}),o===h.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",disabled:(t==null?void 0:t.isActive)&&o===h.LEASE,style:{position:"relative",background:o===h.BUY?"var(--text-white)":"",color:o===h.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>g({type:"setRegistrationType",payload:h.BUY}),children:["Buy"," ",(o===h.BUY||(t==null?void 0:t.type)===h.BUY)&&(t!=null&&t.isActive)?e.jsx(se,{width:"20px",height:"20px",fill:"var(--text-black)",style:{position:"absolute",right:"20px"}}):e.jsx(e.Fragment,{}),o===h.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"35px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:o===h.LEASE?e.jsx(ze,{value:w,setValue:r=>{g({type:"setLeaseDuration",payload:r})},minValue:t!=null&&t.isActive||t!=null&&t.isRequiredToBeAuctioned?1:te,maxValue:t!=null&&t.isActive||t!=null&&t.isRequiredToBeAuctioned?1:ae,valueStyle:{padding:"20px 120px"},valueName:w>1?"years":"year",detail:`Until ${Ve(Date.now()+w*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${te}-${ae} years)`})}):o===h.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx($e,{selectedTokenCallback:r=>r?a(r.toString()):g({type:"setANTID",payload:void 0})}),e.jsxs("div",{className:"name-token-input-wrapper",style:{border:I||U?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(le,{inputId:"target-id-input",value:U??"",setValue:r=>{j(r.trim()),de(r.trim())&&g({type:"setTargetId",payload:new F(r.trim())}),r.trim().length===0&&Y(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[J.ARWEAVE_ID]:{fn:r=>C.validateArweaveId(r)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:r=>{Y(!r)}}),e.jsx("span",{className:"grey pointer hover",style:{fontSize:"12px"},children:e.jsx(G,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"The Target ID is the arweave ID that will be resolved by the ArNS name.",children:"Optional"})})]}),e.jsx(We,{ioRequired:!0,fee:n,feeWrapperStyle:{alignItems:"flex-start"}}),s&&t&&t.isRequiredToBeAuctioned&&(n!=null&&n[c])?e.jsx("div",{className:"flex flex-row warning-container",style:{gap:"1em",justifyContent:"flex-start",alignItems:"flex-start",boxSizing:"border-box",position:"relative"},children:e.jsxs("span",{className:"flex flex-column",style:{textAlign:"left",fontSize:"13px",gap:"1em"},children:["Buying this name involves a Dutch auction. You start by bidding at the floor price of"," ",(i=n==null?void 0:n[c])==null?void 0:i.toLocaleString()," ",c,". The name's price begins at 10 times your bid and decreases over 2 weeks until it matches your bid, securing your win. You can also buy instantly at the ongoing price throughout the auction; if someone else does, you will lose the auction and have your initial bid returned.",e.jsx(Fe,{to:"https://docs.ar.io/arns/#bid-initiated-dutch-auctions-bida",rel:"noreferrer",target:"_blank",className:"link",style:{textDecoration:"underline",color:"inherit"},children:"Learn more."})]})}):e.jsx(e.Fragment,{})," ",e.jsx("div",{style:{marginTop:"30px"},children:e.jsx(Oe,{nextText:"Next",backText:"Back",onNext:x,onBack:()=>S("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]}),e.jsx(ee,{loading:$,message:"Validating transaction parameters..."})]})}export{Je as default};
//# sourceMappingURL=Register-eddadab8.js.map

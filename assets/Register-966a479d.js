import{y as re,b as ne,r as c,a5 as se,A as _,a6 as pe,f as F,j as e,V as oe,Q as X,F as Q,U as ie,G as le,a7 as me,T as q,P as he,a8 as fe,c as ge,u as we,a9 as ve,a as be,aa as ye,ab as Se,ac as Ne,ad as je,ae as Te,af as Ie,ag as Ae,ah as ke,ai as w,aj as Ce,ak as Ee,al as Re,am as Z,an as K,ao as De,ap as ee,M as te,aq as Pe,ar as Oe}from"./index-8036de61.js";import{C as Le}from"./Counter-d1d45aab.js";import{S as ae}from"./HamburgerOutline-0a9b27f5.js";import{T as Be}from"./TransactionCost-22634ffc.js";import{S as Ve}from"./StepProgressBar-ce0aa390.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[o]="4ad51236-eb3e-45ca-a4f4-90fa96ad6b25",s._sentryDebugIdIdentifier="sentry-dbid-4ad51236-eb3e-45ca-a4f4-90fa96ad6b25")}catch{}})();function _e({selectedTokenCallback:s}){var f;const[{arweaveDataProvider:o}]=re(),[{walletAddress:v}]=ne(),[i,S]=c.useState(),[u,b]=c.useState(),[z,N]=c.useState(!1),[p,j]=c.useState(),[x,C]=c.useState(void 0),[I,W]=c.useState(!1),[O,L]=c.useState(!1),[U,R]=c.useState(void 0),H=se("name-token-input"),A=c.useRef(null),[k,T]=c.useState(1),E=3;c.useEffect(()=>{s(x?new _(x.id):void 0),T(1)},[x]),c.useEffect(()=>{v&&B(v)},[v]),c.useEffect(()=>{if(A.current)return document.addEventListener("click",D),()=>{document.removeEventListener("click",D)}},[A]);function D(t){A.current&&t.target!==A.current&&!A.current.contains(t.target)&&(S(""),L(!1),j(void 0),T(1))}async function B(t,r=[]){try{if(N(!0),!t)throw new Error("No address provided");const{contractTxIds:n}=await o.getContractsForWallet(t,"ant").catch(()=>{throw new Error("Unable to get contracts for wallet")}),d=r.length?await Promise.all(r.map(async a=>{try{await o.validateTransactionTags({id:a.toString(),requiredTags:{"App-Name":["SmartWeaveContract"]}}).catch(()=>{throw new Error("Import is not a SmartWeave Contract")});const h=await o.getContractState(a);if(!Object.keys(h).length)throw new Error("Unable to get Contract State");if(!new pe(h).isValid())throw new Error("Invalid ANT Contract.");return R(!0),a}catch(h){F.emit("error",h)}})).then(a=>a.filter(h=>!!h)):[];if(!n.length&&!d.length)return;const m=n.concat(d),g=await o.getRecords({filters:{contractTxId:m}}),y=await Promise.all(m.map(async a=>{const h=await o.buildANTContract(a).catch(()=>{throw new Error("Unable to get Contract State")});if(!h.isValid())throw new Error("Invalid ANT Contract.");const J=Object.keys(g).reduce((M,V)=>(g[V].contractTxId===a.toString()&&(M[V]=g[V]),M),{});return[a,h.state,J]}));if(!y.length)throw new Error("Unable to get details for Name Tokens");const P=y.reduce((a,h)=>{if(!h)return{...a};const[J,M,V]=h,{owner:ce,controller:de,name:xe,ticker:ue}=M;return{...a,[J.toString()]:{owner:ce,controller:de,name:xe,ticker:ue,names:Object.keys(V)}}},{});if(b(P),d.length){const a=P[d[0].toString()];C({name:a==null?void 0:a.name,ticker:a==null?void 0:a.ticker,id:d[0].toString(),names:(a==null?void 0:a.names)??[]})}}catch(n){F.emit("error",n)}finally{N(!1),T(1)}}function G(t){try{if(W(!0),R(void 0),!t){S("");return}if(S(t),!u)throw new Error("No Name Tokens Found");const r=Object.keys(u).filter(n=>{const{owner:d,controller:m,name:g,ticker:y}=u[n];return[d,m,g,y,n].some(a=>a&&a.toString().toLowerCase().includes(t.toLowerCase()))}).map(n=>{const{name:d,ticker:m,names:g}=u[n];return{id:n,name:d??"",ticker:m??"",names:g}}).filter(n=>!!n);if(!r.length)throw new Error("No ANT tokens found for that search");j(r)}catch{j(void 0)}finally{W(!1),T(1)}}function $({id:t,name:r,ticker:n,names:d}){try{if(S(""),j(void 0),t===void 0)throw new Error(`No ID provided for ${r??n??""}`);C({id:t,name:r??"",ticker:n??"",names:d}),s(new _(t)),T(1)}catch(m){F.emit("error",m)}finally{L(!1)}}const Y=(t,r,n)=>{if(u&&!(r==="next"||r==="prev"))return r==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:k==t?"white":"var(--text-grey)",width:"32px"},children:t}):n};function l(t){T(t)}return e.jsxs("div",{ref:A,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:H||O?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(oe,{inputId:"name-token-input",onClick:()=>L(!0),showValidationIcon:U!==void 0,setValue:t=>G(t.length===X?t.trim():t),value:i??"",maxCharLength:X,placeholder:x?(f=x.name)!=null&&f.length?x.name:x.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[Q.SMARTWEAVE_CONTRACT]:{fn:t=>o.validateTransactionTags({id:t,requiredTags:{"App-Name":["SmartWeaveContract"]}})},[Q.TRANSACTION_CONFIRMATIONS]:{fn:t=>o.validateConfirmations(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${x?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${x?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:z||I?e.jsx(ie,{size:20,color:"var(--text-white)"}):i&&U===!1?e.jsx(e.Fragment,{}):i&&le(i)&&!Object.keys(u??[]).includes(i)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{B(v,[new _(i)])},children:"Import"}):x?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{C(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(q,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"You can import an ANT by entering its contract ID, or search for one of your own by name, ticker, owner, or controller status, as well is its own contract ID",children:"Optional"})})]}),u&&O?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[i&&!(p!=null&&p.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):p?p.slice(Math.max((k-1)*E,0),k*E).map((t,r)=>{var n;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(n=t.names)!=null&&n.length?e.jsxs(q,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(d=>e.jsx("span",{children:d},d))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(ae,{width:20,height:20,fill:"var(--text-grey)"})," "]},r):e.jsx(e.Fragment,{})]},r)}):Object.entries(u).slice(Math.max((k-1)*E,0),k*E).map((t,r)=>{if(!t)return;const[n,d]=t,{name:m,ticker:g,names:y}=d;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:n,name:m??"",ticker:g??"",names:y??[]})},children:[m&&g?`${m.slice(0,20)} ${m.length>20?"...":""} (${g}) - ${n}`:n,y!=null&&y.length?e.jsxs(q,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:y.map(P=>e.jsx("span",{children:P},P))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(ae,{width:20,height:20,fill:"var(--text-grey)"})," "]}):e.jsx(e.Fragment,{})]},r)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[u.length||p!=null&&p.length||!i?e.jsx(he,{total:Object.keys(u).length&&!p?Object.keys(u).length:p?p.length:0,itemRender:Y,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:l,current:k,defaultPageSize:E}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Ye(){const[{domain:s,fee:o,leaseDuration:v,registrationType:i,antID:S,targetId:u},b]=fe(),[{arweaveDataProvider:z,ioTicker:N,arioContract:p}]=re(),[{walletAddress:j,balances:x}]=ne(),[,C]=ge(),{name:I}=we(),{loading:W}=ve(I??s),[O,L]=c.useState(),U=se("target-id-input"),R=be(),[H,A]=ye(),[k,T]=c.useState(!1),[E,D]=c.useState(!1),B=o==null?void 0:o[N],G=B&&B<0;c.useEffect(()=>{if(H.get("redirect")&&I){if(!x[N])return;A(),Y();return}},[x,o]),c.useEffect(()=>{I&&s!==I&&b({type:"setDomainName",payload:I})},[I,s]);async function $(l){try{const f=new _(l.toString());if(b({type:"setANTID",payload:f}),!(await z.buildANTContract(f)).isValid())throw Error("ANT contract state does not match required schema.")}catch(f){console.error(f)}}if(!i)return e.jsx(ie,{size:80});async function Y(){try{if(!j){const r=new URLSearchParams({redirect:"true"});R("/connect",{state:{to:`/register/${s}?${r.toString()}`,from:`/register/${s}`}});return}D(!0);const f=await p.getBalance({address:j.toString()}).then(r=>new Se(r).toIO()),t=Ne({balances:{AR:x.ar,[N]:f.valueOf()},costs:{AR:o.ar,[N]:o[N]}});if(t.length){t.forEach(r=>{F.emit("error",new je(r.message))});return}if(G)throw new Error("Issue calculating transaction cost.");if(k)throw new Te("Please fix the errors above before continuing.")}catch(f){F.emit("error",f),D(!1);return}finally{D(!1)}const l={name:s&&Ie().test(s)?Ae(s):s,contractTxId:S?S.toString():ke,years:i===w.LEASE?v:void 0,type:i,targetId:u};C({type:"setTransactionData",payload:{walletAddress:j,assetId:Ce.toString(),functionName:"buyRecord",...l,state:S?await Ee.init({contractTxId:S.toString()}).getState():Re(s,j),interactionPrice:o==null?void 0:o[N]}}),C({type:"setInteractionType",payload:Z.BUY_RECORD}),b({type:"reset"}),C({type:"setWorkflowName",payload:Z.BUY_RECORD}),R("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(K,{message:"Loading Domain info, please wait.",loading:W}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",margin:"50px",gap:"80px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"40px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Ve,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(De,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"25px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>b({type:"setRegistrationType",payload:w.LEASE}),style:{position:"relative",background:i===w.LEASE?"var(--text-white)":"",color:i===w.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",i===w.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:i===w.BUY?"var(--text-white)":"",color:i===w.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>b({type:"setRegistrationType",payload:w.BUY}),children:["Buy"," ",i===w.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"35px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:i===w.LEASE?e.jsx(Le,{value:v,setValue:l=>{b({type:"setLeaseDuration",payload:l})},minValue:ee,maxValue:te,valueStyle:{padding:"20px 120px"},valueName:v>1?"years":"year",detail:`Until ${Pe(Date.now()+v*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${ee}-${te} years)`})}):i===w.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(_e,{selectedTokenCallback:l=>l?$(l.toString()):b({type:"setANTID",payload:void 0})}),e.jsxs("div",{className:"name-token-input-wrapper",style:{border:U||O?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(oe,{inputId:"target-id-input",value:O??"",setValue:l=>{L(l.trim()),le(l.trim())&&b({type:"setTargetId",payload:new _(l.trim())}),l.trim().length===0&&T(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[Q.ARWEAVE_ID]:{fn:l=>z.validateArweaveId(l)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:l=>{T(!l)}}),e.jsx("span",{className:"grey pointer hover",style:{fontSize:"12px"},children:e.jsx(q,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"The Target ID is the arweave ID that will be resolved by the ArNS name.",children:"Optional"})})]}),e.jsx(Be,{ioRequired:!0,fee:o,feeWrapperStyle:{alignItems:"flex-start"}}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx(Oe,{nextText:"Next",backText:"Back",onNext:Y,onBack:()=>R("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]}),e.jsx(K,{loading:E,message:"Validating transaction parameters..."})]})}export{Ye as default};
//# sourceMappingURL=Register-966a479d.js.map

import{z as ie,a1 as oe,r as l,a7 as ce,A as Y,j as e,V as le,a8 as pe,H as de,a2 as xe,E as ue,a9 as me,aa as H,ab as ee,e as O,ac as fe,b as he,u as ge,ad as we,a as ye,ae as ve,af as te,ag as be,ah as je,ai as Se,aj as Ne,ak as ke,al as y,am as ae,an as Ie,ao as Te,ap as re,M as se,aq as Ee,ar as Ae,as as Re}from"./index-7431f6f4.js";import{C as Ce}from"./Counter-3be24d28.js";import{S as ne}from"./HamburgerOutline-78763d9d.js";import{P as Pe}from"./Pagination-72187916.js";import{T as De}from"./TransactionCost-95d7189f.js";import{S as Le}from"./StepProgressBar-f2efa770.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[d]="01c53bce-ac4c-412c-31c4-3b3ce7406b3c",s._sentryDebugIdIdentifier="sentry-dbid-01c53bce-ac4c-412c-31c4-3b3ce7406b3c")}catch{}})();function Be({selectedTokenCallback:s}){var o;const[{arweaveDataProvider:d}]=ie(),[{walletAddress:b}]=oe(),[i,S]=l.useState(),[p,m]=l.useState(),[M,f]=l.useState(!1),[x,R]=l.useState(),[h,E]=l.useState(void 0),[D,j]=l.useState(!1),[F,C]=l.useState(!1),[q,V]=l.useState(void 0),L=ce("name-token-input"),N=l.useRef(null),[k,I]=l.useState(1),T=3;l.useEffect(()=>{s(h?new Y(h.id):void 0),I(1)},[h]),l.useEffect(()=>{if(N.current)return document.addEventListener("click",z),()=>{document.removeEventListener("click",z)}},[N]);function z(t){N.current&&t.target!==N.current&&!N.current.contains(t.target)&&(S(""),C(!1),R(void 0),I(1))}async function A(t,n=[]){try{if(f(!0),!t)throw new Error("No address provided");const a=[],c=n.length?await Promise.all(n.map(async r=>{try{const u=ee.init({processId:r.toString()}),B=await u.getInfo();if(!u||!B)throw new Error("Unable to get contract");return V(!0),r}catch(u){O.emit("error",u)}})).then(r=>r.filter(u=>!!u)):[];if(!a.length&&!c.length)return;const g=a.concat(c),w=await d.getRecords({filters:{processId:g}}),v=await Promise.all(g.map(async r=>{const u=ee.init({processId:r.toString()}),B=Object.keys(w).reduce((U,Z)=>(w[Z].processId===r.toString()&&(U[Z]=w[Z]),U),{}),[J,X,Q,K]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:r,names:B,owner:J,controllers:X,ticker:Q,name:K}})).then(r=>r.filter(u=>!!u));if(!v.length)throw new Error("Unable to get details for Name Tokens");const P=v.reduce(async(r,u)=>{const{processId:B,owner:J,controllers:X,name:Q,ticker:K,names:U}=u;return{...r,[B.toString()]:{owner:J,controllers:X,name:Q,ticker:K,names:Object.keys(U)}}},{});if(m(await P),c.length){const r=P[c[0].toString()];E({name:r==null?void 0:r.name,ticker:r==null?void 0:r.ticker,id:c[0].toString(),names:(r==null?void 0:r.names)??[]})}}catch(a){O.emit("error",a)}finally{f(!1),I(1)}}function _(t){try{if(j(!0),V(void 0),!t){S("");return}if(S(t),!p)throw new Error("No Name Tokens Found");const n=Object.keys(p).filter(a=>{const{owner:c,controllers:g,name:w,ticker:v}=p[a];return[c,g,w,v,a].some(r=>r&&r.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:c,ticker:g,names:w}=p[a];return{id:a,name:c??"",ticker:g??"",names:w}}).filter(a=>!!a);if(!n.length)throw new Error("No ANT tokens found for that search");R(n)}catch{R(void 0)}finally{j(!1),I(1)}}function $({id:t,name:n,ticker:a,names:c}){try{if(S(""),R(void 0),t===void 0)throw new Error(`No ID provided for ${n??a??""}`);E({id:t,name:n??"",ticker:a??"",names:c}),s(new Y(t)),I(1)}catch(g){O.emit("error",g)}finally{C(!1)}}const G=(t,n,a)=>{if(p&&!(n==="next"||n==="prev"))return n==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:k==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function W(t){I(t)}return e.jsxs("div",{ref:N,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:L||F?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(le,{inputId:"name-token-input",onClick:()=>C(!0),showValidationIcon:!0,setValue:t=>_(t),value:i??"",maxCharLength:pe,placeholder:h?(o=h.name)!=null&&o.length?h.name:h.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>d.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${h?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${h?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:M||D?e.jsx(xe,{size:20,color:"var(--text-white)"}):i&&q===!1?e.jsx(e.Fragment,{}):i&&ue(i)&&!Object.keys(p??[]).includes(i)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{A(b,[new Y(i)])},children:"Import"}):h?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{E(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(H,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),p&&F?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[i&&!(x!=null&&x.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):x?x.slice(Math.max((k-1)*T,0),k*T).map((t,n)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsx(H,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(c=>e.jsx("span",{children:c},c))})},n):e.jsx(e.Fragment,{})]},n)}):Object.entries(p).slice(Math.max((k-1)*T,0),k*T).map((t,n)=>{if(!t)return;const[a,c]=t,{name:g,ticker:w,names:v}=c;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{$({id:a,name:g??"",ticker:w??"",names:v??[]})},children:[g&&w?`${g.slice(0,20)} ${g.length>20?"...":""} (${w}) - ${a}`:a,v!=null&&v.length?e.jsx(H,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:v.map(P=>e.jsx("span",{children:P},P))})}):e.jsx(e.Fragment,{})]},n)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[p.length||x!=null&&x.length||!i?e.jsx(Pe,{total:Object.keys(p).length&&!x?Object.keys(p).length:x?x.length:0,itemRender:G,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:W,current:k,defaultPageSize:T}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function We(){const[{domain:s,fee:d,leaseDuration:b,registrationType:i,antID:S,targetId:p},m]=fe(),[{arweaveDataProvider:M,ioTicker:f,arioContract:x,ioProcessId:R}]=ie(),[{walletAddress:h,balances:E}]=oe(),[,D]=he(),{name:j}=ge(),{loading:F}=we(j??s),[C,q]=l.useState(),V=ce("target-id-input"),L=ye(),[N,k]=ve(),[I,T]=l.useState(!1),[z,A]=l.useState(!1),_=d==null?void 0:d[f],$=_&&_<0;l.useEffect(()=>{if(N.get("redirect")&&j){if(!E[f])return;k(),W();return}},[E,d]),l.useEffect(()=>{if(!x||!s||!f||!i)return;(async()=>{m({type:"setFee",payload:{ar:0,[f]:void 0}}),A(!0);const t=await x.getTokenCost({intent:"Buy-Record",name:s,purchaseType:i,years:b}).then(n=>new te(n).toIO().valueOf()).catch(()=>{});A(!1),m({type:"setFee",payload:{ar:0,[f]:t}})})()},[x,m,s,f,b,i]),l.useEffect(()=>{j&&s!==j&&m({type:"setDomainName",payload:j})},[j,s]);async function G(o){if(!o){m({type:"setANTID",payload:void 0});return}if(m({type:"setANTID",payload:o}),!ee.init({processId:o.toString()}))throw new Error("Contract not found")}if(!i)return e.jsx(xe,{size:80});async function W(){try{if(!h){const c=new URLSearchParams({redirect:"true"});L("/connect",{state:{to:`/register/${s}?${c.toString()}`,from:`/register/${s}`}});return}A(!0);const n=await x.getBalance({address:h.toString()}).then(c=>new te(c).toIO()),a=be({balances:{AR:E.ar,[f]:n.valueOf()},costs:{AR:d.ar,[f]:d[f]}});if(a.length){a.forEach(c=>{O.emit("error",new je(c.message))});return}if($)throw new Error("Issue calculating transaction cost.");if(I)throw new Se("Please fix the errors above before continuing.")}catch(n){O.emit("error",n),A(!1);return}finally{A(!1)}const t={name:s&&Ne().test(s)?ke(s):s,processId:(S==null?void 0:S.toString())??"atomic",years:i===y.LEASE?b:void 0,type:i,targetId:p};D({type:"setTransactionData",payload:{assetId:R,functionName:"buyRecord",...t,interactionPrice:d==null?void 0:d[f]}}),D({type:"setInteractionType",payload:ae.BUY_RECORD}),m({type:"reset"}),D({type:"setWorkflowName",payload:ae.BUY_RECORD}),L("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Ie,{message:"Loading Domain info, please wait.",loading:F}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Le,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Te,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>m({type:"setRegistrationType",payload:y.LEASE}),style:{position:"relative",background:i===y.LEASE?"var(--text-white)":"",color:i===y.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",i===y.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:i===y.BUY?"var(--text-white)":"",color:i===y.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>m({type:"setRegistrationType",payload:y.BUY}),children:["Buy"," ",i===y.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:i===y.LEASE?e.jsx(Ce,{value:b,setValue:o=>{m({type:"setLeaseDuration",payload:o})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:b>1?"years":"year",detail:`Until ${Ee(Date.now()+b*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):i===y.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ae,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:V||C?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(le,{inputId:"target-id-input",value:C??"",setValue:o=>{q(o.trim()),ue(o.trim())&&m({type:"setTargetId",payload:new Y(o.trim())}),o.trim().length===0&&T(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:o=>M.validateArweaveId(o)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:o=>{T(!o)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(H,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Be,{selectedTokenCallback:o=>G(o)})]})},"1"),e.jsx(De,{ioRequired:!0,fee:d,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(Re,{nextText:"Next",backText:"Back",onNext:z?void 0:W,onBack:()=>L("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{We as default};
//# sourceMappingURL=Register-26c73d15.js.map

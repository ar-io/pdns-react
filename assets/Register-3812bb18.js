import{B as ie,a3 as oe,r as l,a8 as le,A as U,j as e,V as ce,a9 as pe,I as de,a4 as xe,J as ue,aa as me,ab as Y,P as fe,ac as ee,e as _,ad as he,b as ge,u as we,ae as ye,a as ve,af as be,ag as te,ah as Se,ai as je,aj as Ne,ak as Ie,al as ke,am as y,an as Te,ao as ae,ap as Ee,aq as Re,ar as re,M as se,as as Ae,at as Ce,au as Pe}from"./index-c8f70bd5.js";import{C as De}from"./Counter-3e61baab.js";import{S as ne}from"./HamburgerOutline-c967305b.js";import{T as Le}from"./TransactionCost-0fe861dc.js";import{S as Be}from"./StepProgressBar-fe47628d.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[c]="72efe561-2057-4be2-b34d-61e63996f41d",s._sentryDebugIdIdentifier="sentry-dbid-72efe561-2057-4be2-b34d-61e63996f41d")}catch{}})();function Oe({selectedTokenCallback:s}){var C;const[{arweaveDataProvider:c}]=ie(),[{walletAddress:b}]=oe(),[n,j]=l.useState(),[m,f]=l.useState(),[H,h]=l.useState(!1),[d,E]=l.useState(),[p,R]=l.useState(void 0),[N,F]=l.useState(!1),[L,B]=l.useState(!1),[M,P]=l.useState(void 0),G=le("name-token-input"),I=l.useRef(null),[k,S]=l.useState(1),A=3;l.useEffect(()=>{s(p?new U(p.id):void 0),S(1)},[p]),l.useEffect(()=>{if(I.current)return document.addEventListener("click",T),()=>{document.removeEventListener("click",T)}},[I]);function T(t){I.current&&t.target!==I.current&&!I.current.contains(t.target)&&(j(""),B(!1),E(void 0),S(1))}async function V(t,o=[]){try{if(h(!0),!t)throw new Error("No address provided");const a=[],x=o.length?await Promise.all(o.map(async r=>{try{const u=ee.init({processId:r.toString()}),O=await u.getInfo();if(!u||!O)throw new Error("Unable to get contract");return P(!0),r}catch(u){_.emit("error",u)}})).then(r=>r.filter(u=>!!u)):[];if(!a.length&&!x.length)return;const g=a.concat(x),w=await c.getRecords({filters:{processId:g}}),v=await Promise.all(g.map(async r=>{const u=ee.init({processId:r.toString()}),O=Object.keys(w).reduce((W,Z)=>(w[Z].processId===r.toString()&&(W[Z]=w[Z]),W),{}),[q,X,Q,K]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:r,names:O,owner:q,controllers:X,ticker:Q,name:K}})).then(r=>r.filter(u=>!!u));if(!v.length)throw new Error("Unable to get details for Name Tokens");const D=v.reduce(async(r,u)=>{const{processId:O,owner:q,controllers:X,name:Q,ticker:K,names:W}=u;return{...r,[O.toString()]:{owner:q,controllers:X,name:Q,ticker:K,names:Object.keys(W)}}},{});if(f(await D),x.length){const r=D[x[0].toString()];R({name:r==null?void 0:r.name,ticker:r==null?void 0:r.ticker,id:x[0].toString(),names:(r==null?void 0:r.names)??[]})}}catch(a){_.emit("error",a)}finally{h(!1),S(1)}}function J(t){try{if(F(!0),P(void 0),!t){j("");return}if(j(t),!m)throw new Error("No Name Tokens Found");const o=Object.keys(m).filter(a=>{const{owner:x,controllers:g,name:w,ticker:v}=m[a];return[x,g,w,v,a].some(r=>r&&r.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:x,ticker:g,names:w}=m[a];return{id:a,name:x??"",ticker:g??"",names:w}}).filter(a=>!!a);if(!o.length)throw new Error("No ANT tokens found for that search");E(o)}catch{E(void 0)}finally{F(!1),S(1)}}function z({id:t,name:o,ticker:a,names:x}){try{if(j(""),E(void 0),t===void 0)throw new Error(`No ID provided for ${o??a??""}`);R({id:t,name:o??"",ticker:a??"",names:x}),s(new U(t)),S(1)}catch(g){_.emit("error",g)}finally{B(!1)}}const $=(t,o,a)=>{if(m&&!(o==="next"||o==="prev"))return o==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:k==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function i(t){S(t)}return e.jsxs("div",{ref:I,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:G||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(ce,{inputId:"name-token-input",onClick:()=>B(!0),showValidationIcon:!0,setValue:t=>J(t),value:n??"",maxCharLength:pe,placeholder:p?(C=p.name)!=null&&C.length?p.name:p.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>c.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${p?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${p?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:H||N?e.jsx(xe,{size:20,color:"var(--text-white)"}):n&&M===!1?e.jsx(e.Fragment,{}):n&&ue(n)&&!Object.keys(m??[]).includes(n)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{V(b,[new U(n)])},children:"Import"}):p?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{R(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(Y,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),m&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[n&&!(d!=null&&d.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):d?d.slice(Math.max((k-1)*A,0),k*A).map((t,o)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(x=>e.jsx("span",{children:x},x))})},o):e.jsx(e.Fragment,{})]},o)}):Object.entries(m).slice(Math.max((k-1)*A,0),k*A).map((t,o)=>{if(!t)return;const[a,x]=t,{name:g,ticker:w,names:v}=x;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:a,name:g??"",ticker:w??"",names:v??[]})},children:[g&&w?`${g.slice(0,20)} ${g.length>20?"...":""} (${w}) - ${a}`:a,v!=null&&v.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:v.map(D=>e.jsx("span",{children:D},D))})}):e.jsx(e.Fragment,{})]},o)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[m.length||d!=null&&d.length||!n?e.jsx(fe,{total:Object.keys(m).length&&!d?Object.keys(m).length:d?d.length:0,itemRender:$,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:i,current:k,defaultPageSize:A}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function We(){const[{domain:s,fee:c,leaseDuration:b,registrationType:n,antID:j,targetId:m},f]=he(),[{arweaveDataProvider:H,ioTicker:h,arioContract:d}]=ie(),[{walletAddress:E,balances:p}]=oe(),[,R]=ge(),{name:N}=we(),{loading:F}=ye(N??s),[L,B]=l.useState(),M=le("target-id-input"),P=ve(),[G,I]=be(),[k,S]=l.useState(!1),[A,T]=l.useState(!1),V=c==null?void 0:c[h],J=V&&V<0;l.useEffect(()=>{if(G.get("redirect")&&N){if(!p[h])return;I(),$();return}},[p,c]),l.useEffect(()=>{if(!d||!s||!h||!n)return;(async()=>{f({type:"setFee",payload:{ar:0,[h]:void 0}}),T(!0);const C=await d.getTokenCost({intent:"Buy-Record",name:s,purchaseType:n,years:b}).then(t=>new te(t).toIO().valueOf()).catch(()=>{});T(!1),f({type:"setFee",payload:{ar:0,[h]:C}})})()},[d,f,s,h,b,n]),l.useEffect(()=>{N&&s!==N&&f({type:"setDomainName",payload:N})},[N,s]);async function z(i){if(!i){f({type:"setANTID",payload:void 0});return}if(f({type:"setANTID",payload:i}),!ee.init({processId:i.toString()}))throw new Error("Contract not found")}if(!n)return e.jsx(xe,{size:80});async function $(){try{if(!E){const a=new URLSearchParams({redirect:"true"});P("/connect",{state:{to:`/register/${s}?${a.toString()}`,from:`/register/${s}`}});return}T(!0);const t=await d.getBalance({address:E.toString()}).then(a=>new te(a).toIO()),o=Se({balances:{AR:p.ar,[h]:t.valueOf()},costs:{AR:c.ar,[h]:c[h]}});if(o.length){o.forEach(a=>{_.emit("error",new je(a.message))});return}if(J)throw new Error("Issue calculating transaction cost.");if(k)throw new Ne("Please fix the errors above before continuing.")}catch(t){_.emit("error",t),T(!1);return}finally{T(!1)}const C={name:s&&Ie().test(s)?ke(s):s,processId:(j==null?void 0:j.toString())??"atomic",years:n===y.LEASE?b:void 0,type:n,targetId:m};R({type:"setTransactionData",payload:{assetId:Te.toString(),functionName:"buyRecord",...C,interactionPrice:c==null?void 0:c[h]}}),R({type:"setInteractionType",payload:ae.BUY_RECORD}),f({type:"reset"}),R({type:"setWorkflowName",payload:ae.BUY_RECORD}),P("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Ee,{message:"Loading Domain info, please wait.",loading:F}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",gap:"50px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"20px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Be,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Re,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"15px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>f({type:"setRegistrationType",payload:y.LEASE}),style:{position:"relative",background:n===y.LEASE?"var(--text-white)":"",color:n===y.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",n===y.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:n===y.BUY?"var(--text-white)":"",color:n===y.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>f({type:"setRegistrationType",payload:y.BUY}),children:["Buy"," ",n===y.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"25px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:n===y.LEASE?e.jsx(De,{value:b,setValue:i=>{f({type:"setLeaseDuration",payload:i})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:b>1?"years":"year",detail:`Until ${Ae(Date.now()+b*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):n===y.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ce,{title:e.jsx("span",{className:"text-medium",children:"Advanced Options"}),children:e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{border:M||L?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(ce,{inputId:"target-id-input",value:L??"",setValue:i=>{B(i.trim()),ue(i.trim())&&f({type:"setTargetId",payload:new U(i.trim())}),i.trim().length===0&&S(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:i=>H.validateArweaveId(i)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:i=>{S(!i)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(Y,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Oe,{selectedTokenCallback:i=>z(i)})]})},"1"),e.jsx(Le,{ioRequired:!0,fee:c,feeWrapperStyle:{alignItems:"center",justifyContent:"center",height:"100%"}}),e.jsx("div",{style:{marginTop:"0px"},children:e.jsx(Pe,{nextText:"Next",backText:"Back",onNext:A?void 0:$,onBack:()=>P("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{We as default};
//# sourceMappingURL=Register-3812bb18.js.map

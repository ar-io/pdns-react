{"version":3,"file":"TransactionReview-f5fdebd3.js","sources":["../../src/state/actions/dispatchArIOInteraction.ts","../../src/components/pages/Transaction/transaction-headers.tsx","../../src/components/pages/Transaction/TransactionReview.tsx"],"sourcesContent":["import {\n  ANTRegistry,\n  ANT_REGISTRY_ID,\n  AoClient,\n  AoIOWrite,\n  AoMessageResult,\n  ContractSigner,\n  DEFAULT_SCHEDULER_ID,\n  createAoSigner,\n  spawnANT,\n} from '@ar.io/sdk/web';\nimport { ArweaveTransactionID } from '@src/services/arweave/ArweaveTransactionID';\nimport { TransactionAction } from '@src/state/reducers/TransactionReducer';\nimport { ARNS_INTERACTION_TYPES, ContractInteraction } from '@src/types';\nimport { lowerCaseDomain } from '@src/utils';\nimport { DEFAULT_ANT_LUA_ID, WRITE_OPTIONS } from '@src/utils/constants';\nimport eventEmitter from '@src/utils/events';\nimport { Dispatch } from 'react';\n\nexport default async function dispatchArIOInteraction({\n  payload,\n  workflowName,\n  owner,\n  arioContract,\n  processId,\n  dispatch,\n  signer,\n  ao,\n  scheduler = DEFAULT_SCHEDULER_ID,\n}: {\n  payload: Record<string, any>;\n  workflowName: ARNS_INTERACTION_TYPES;\n  owner: ArweaveTransactionID;\n  arioContract?: AoIOWrite;\n  processId: string;\n  dispatch: Dispatch<TransactionAction>;\n  signer?: ContractSigner;\n  ao?: AoClient;\n  scheduler?: string;\n}): Promise<ContractInteraction> {\n  let result: AoMessageResult | undefined = undefined;\n  const aoCongestedTimeout = setTimeout(\n    () => {\n      eventEmitter.emit('network:ao:congested', true);\n    }, // if it is taking longer than 10 seconds, consider the network congested\n    1000 * 10,\n  );\n  try {\n    if (!arioContract) throw new Error('ArIO provider is not defined');\n    if (!signer) throw new Error('signer is not defined');\n    dispatch({\n      type: 'setSigning',\n      payload: true,\n    });\n    switch (workflowName) {\n      case ARNS_INTERACTION_TYPES.BUY_RECORD: {\n        const { name, type, years } = payload;\n        let antProcessId: string = payload.processId;\n\n        if (antProcessId === 'atomic') {\n          antProcessId = await spawnANT({\n            state: payload.state,\n            signer: createAoSigner(signer),\n            ao: ao,\n            scheduler: scheduler,\n            luaCodeTxId: DEFAULT_ANT_LUA_ID,\n          });\n\n          const antRegistry = ANTRegistry.init({\n            signer,\n            processId: ANT_REGISTRY_ID,\n          });\n          await antRegistry\n            .register({\n              processId: antProcessId,\n            })\n            .catch((error) => {\n              eventEmitter.emit(\n                'error',\n                new Error(\n                  `Failed to register ANT process: ${error}. You may need to manually register the process`,\n                ),\n              );\n            });\n        }\n\n        const buyRecordResult = await arioContract.buyRecord({\n          name: lowerCaseDomain(name),\n          type,\n          years,\n          processId: antProcessId,\n        });\n\n        payload.processId = antProcessId;\n\n        result = buyRecordResult;\n        break;\n      }\n      case ARNS_INTERACTION_TYPES.EXTEND_LEASE:\n        result = await arioContract.extendLease(\n          {\n            name: lowerCaseDomain(payload.name),\n            years: payload.years,\n          },\n          WRITE_OPTIONS,\n        );\n        break;\n      case ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES:\n        result = await arioContract.increaseUndernameLimit(\n          {\n            name: lowerCaseDomain(payload.name),\n            increaseCount: payload.qty,\n          },\n          WRITE_OPTIONS,\n        );\n        break;\n      default:\n        throw new Error(`Unsupported workflow name: ${workflowName}`);\n    }\n  } catch (error) {\n    eventEmitter.emit('error', error);\n  } finally {\n    dispatch({\n      type: 'setSigning',\n      payload: false,\n    });\n    clearTimeout(aoCongestedTimeout);\n  }\n  if (!result) {\n    throw new Error('Failed to dispatch ArIO interaction');\n  }\n\n  const interaction: ContractInteraction = {\n    deployer: owner.toString(),\n    processId: processId.toString(),\n    id: result.id,\n    type: 'interaction',\n    payload,\n  };\n\n  dispatch({\n    type: 'setWorkflowName',\n    payload: workflowName,\n  });\n  dispatch({\n    type: 'setInteractionResult',\n    payload: interaction,\n  });\n  return interaction;\n}\n","import { ANT_INTERACTION_TYPES, ARNS_INTERACTION_TYPES } from '@src/types';\n\nexport function getTransactionHeader({\n  workflowName,\n  ...params // eslint-disable-line @typescript-eslint/no-unused-vars\n}: {\n  workflowName: ARNS_INTERACTION_TYPES | ANT_INTERACTION_TYPES;\n} & Record<string, any>) {\n  switch (workflowName) {\n    case ARNS_INTERACTION_TYPES.INCREASE_UNDERNAMES:\n    case ARNS_INTERACTION_TYPES.EXTEND_LEASE:\n      return (\n        <h1\n          className=\"flex white\"\n          style={{ width: '100%', paddingBottom: '30px' }}\n        >\n          Review\n        </h1>\n      );\n    case ARNS_INTERACTION_TYPES.BUY_RECORD:\n      return `Review your Purchase`;\n    default:\n      return undefined;\n  }\n}\n","import { IOWriteable } from '@ar.io/sdk/web';\nimport { ANTCard } from '@src/components/cards';\nimport WarningCard from '@src/components/cards/WarningCard/WarningCard';\nimport { InfoIcon } from '@src/components/icons';\nimport WorkflowButtons from '@src/components/inputs/buttons/WorkflowButtons/WorkflowButtons';\nimport TransactionCost from '@src/components/layout/TransactionCost/TransactionCost';\nimport { StepProgressBar } from '@src/components/layout/progress';\nimport PageLoader from '@src/components/layout/progress/PageLoader/PageLoader';\nimport { useIsMobile } from '@src/hooks';\nimport { dispatchArNSUpdate, useArNSState } from '@src/state';\nimport dispatchArIOInteraction from '@src/state/actions/dispatchArIOInteraction';\nimport { useGlobalState } from '@src/state/contexts/GlobalState';\nimport { useTransactionState } from '@src/state/contexts/TransactionState';\nimport { useWalletState } from '@src/state/contexts/WalletState';\nimport {\n  ARNSMapping,\n  ARNS_INTERACTION_TYPES,\n  TransactionData,\n  ValidInteractionType,\n} from '@src/types';\nimport {\n  getARNSMappingByInteractionType,\n  getWorkflowStepsForInteraction,\n} from '@src/utils';\nimport eventEmitter from '@src/utils/events';\nimport { StepProps } from 'antd';\nimport { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { getTransactionDescription } from './transaction-descriptions';\nimport { getTransactionHeader } from './transaction-headers';\n\n// page on route transaction/review\n// on completion routes to transaction/complete\nfunction TransactionReview() {\n  const navigate = useNavigate();\n  const [{ ioTicker, arioContract, ioProcessId, aoNetwork, aoClient }] =\n    useGlobalState();\n  const [{ arnsEmitter }, dispatchArNSState] = useArNSState();\n  const [{ walletAddress, wallet }] = useWalletState();\n  const [\n    { workflowName, interactionType, transactionData, interactionResult },\n    dispatchTransactionState,\n  ] = useTransactionState();\n  const isMobile = useIsMobile();\n  const [antProps, setAntProps] = useState<ARNSMapping>();\n  const [steps, setSteps] = useState<StepProps[] | undefined>(\n    getWorkflowStepsForInteraction(interactionType),\n  );\n  const [header, setHeader] = useState<string | JSX.Element | undefined>(\n    getTransactionHeader({\n      workflowName: workflowName as ARNS_INTERACTION_TYPES,\n    }),\n  );\n  const [transactionDescription, setTransactionDescription] = useState(\n    getTransactionDescription({\n      workflowName: workflowName as ARNS_INTERACTION_TYPES,\n      ioTicker,\n    }),\n  );\n\n  useEffect(() => {\n    if (!transactionData && !workflowName) {\n      navigate('/');\n      return;\n    }\n    setAntProps(\n      getARNSMappingByInteractionType({\n        interactionType: interactionType as ValidInteractionType,\n        transactionData: {\n          ...transactionData,\n          deployedTransactionId: interactionResult?.id,\n        } as any as TransactionData,\n      }) as ARNSMapping,\n    );\n    setTransactionDescription(\n      getTransactionDescription({\n        workflowName: workflowName as ARNS_INTERACTION_TYPES,\n        ioTicker,\n      }),\n    );\n    setSteps(getWorkflowStepsForInteraction(interactionType));\n    setHeader(\n      getTransactionHeader({\n        workflowName: workflowName as ARNS_INTERACTION_TYPES,\n      }),\n    );\n  }, [\n    transactionData,\n    interactionResult,\n    workflowName,\n    interactionType,\n    walletAddress,\n  ]);\n\n  async function handleNext() {\n    try {\n      if (!(arioContract instanceof IOWriteable)) {\n        throw new Error('Wallet must be connected to dispatch transactions.');\n      }\n      if (!transactionData || !workflowName) {\n        throw new Error('Transaction data is missing');\n      }\n\n      if (!walletAddress) {\n        throw new Error('Wallet address is missing');\n      }\n      // TODO: check that it's connected\n      await dispatchArIOInteraction({\n        arioContract: arioContract,\n        workflowName: workflowName as ARNS_INTERACTION_TYPES,\n        payload: transactionData,\n        owner: walletAddress,\n        processId: ioProcessId,\n        dispatch: dispatchTransactionState,\n        signer: wallet?.arconnectSigner,\n        ao: aoClient,\n        scheduler: aoNetwork.SCHEDULER,\n      });\n\n      navigate('/transaction/complete');\n    } catch (error) {\n      eventEmitter.emit('error', error);\n    } finally {\n      if (walletAddress) {\n        dispatchArNSUpdate({\n          emitter: arnsEmitter,\n          dispatch: dispatchArNSState,\n          ioProcessId,\n          walletAddress,\n        });\n      }\n    }\n  }\n\n  if (!antProps) {\n    return (\n      <PageLoader loading={true} message={'Loading transaction data...'} />\n    );\n  }\n\n  return (\n    <div className=\"page\">\n      <div\n        className=\"flex flex-column center\"\n        style={isMobile ? {} : { gap: '0px', maxWidth: '900px', width: '100%' }}\n      >\n        {steps && steps.length ? (\n          <div\n            className=\"flex flex-row\"\n            style={{\n              marginBottom: '20px',\n              width: '100%',\n            }}\n          >\n            <StepProgressBar stage={3} stages={steps} />\n          </div>\n        ) : (\n          <></>\n        )}\n\n        {typeof header === 'string' ? (\n          <div\n            className=\"flex flex-row text-large white bold center\"\n            style={{\n              height: '100%',\n              padding: '50px 0px',\n              borderTop: steps?.length ? 'solid 1px var(--text-faded)' : '',\n            }}\n          >\n            {header}\n          </div>\n        ) : (\n          header\n        )}\n        <ANTCard {...antProps} bordered compact={true} />\n        <TransactionCost\n          feeWrapperStyle={{\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '100%',\n          }}\n          fee={{\n            [ioTicker]: transactionData?.interactionPrice,\n          }}\n          info={\n            transactionDescription && (\n              <div>\n                <WarningCard\n                  wrapperStyle={{\n                    padding: '10px',\n                    fontSize: '14px',\n                    alignItems: 'center',\n                  }}\n                  customIcon={\n                    <InfoIcon width={'20px'} fill={'var(--accent)'} />\n                  }\n                  text={transactionDescription}\n                />\n              </div>\n            )\n          }\n        />\n        <div\n          className=\"flex\"\n          style={{\n            marginTop: 20,\n            width: '100%',\n            justifyContent: 'flex-end',\n          }}\n        >\n          <WorkflowButtons\n            onNext={() => handleNext()}\n            onBack={() => navigate(-1)}\n            backText={'Back'}\n            nextText={'Confirm'}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TransactionReview;\n"],"names":["dispatchArIOInteraction","payload","workflowName","owner","arioContract","processId","dispatch","signer","ao","scheduler","DEFAULT_SCHEDULER_ID","result","aoCongestedTimeout","eventEmitter","ARNS_INTERACTION_TYPES","name","type","years","antProcessId","spawnANT","createAoSigner","DEFAULT_ANT_LUA_ID","ANTRegistry","ANT_REGISTRY_ID","error","buyRecordResult","lowerCaseDomain","WRITE_OPTIONS","interaction","getTransactionHeader","params","jsxRuntimeExports","TransactionReview","navigate","useNavigate","ioTicker","ioProcessId","aoNetwork","aoClient","useGlobalState","arnsEmitter","dispatchArNSState","useArNSState","walletAddress","wallet","useWalletState","interactionType","transactionData","interactionResult","dispatchTransactionState","useTransactionState","isMobile","useIsMobile","antProps","setAntProps","reactExports","steps","setSteps","getWorkflowStepsForInteraction","header","setHeader","transactionDescription","setTransactionDescription","getTransactionDescription","getARNSMappingByInteractionType","handleNext","IOWriteable","dispatchArNSUpdate","StepProgressBar","ANTCard","TransactionCost","WarningCard","SvgInfo","WorkflowButtons","PageLoader"],"mappings":"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"}
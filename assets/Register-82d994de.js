import{j as e,T as pe,E as ie,b as oe,r as l,a8 as ce,A as U,V as le,X as me,a9 as fe,J as de,a4 as xe,L as ue,aa as ge,P as he,ab as ee,h as F,ac as we,c as ye,u as ve,ad as be,a as Se,ae as je,af as te,ag as Ne,ah as Ie,ai as ke,aj as Te,ak as Ee,al as v,am as Re,an as Ae,ao as ae,ap as Ce,aq as Pe,ar as re,M as se,as as De,at as Le}from"./index-ef930000.js";import{S as Be}from"./Info-9e39646b.js";import{C as _e}from"./Counter-42524baf.js";import{S as ne}from"./HamburgerOutline-376d6d0f.js";import{T as Fe}from"./TransactionCost-dec20489.js";import{S as Oe}from"./StepProgressBar-624d54c6.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[c]="38d1e6c9-460c-428c-27fc-7501e232e25e",r._sentryDebugIdIdentifier="sentry-dbid-38d1e6c9-460c-428c-27fc-7501e232e25e")}catch{}})();function Y({message:r,icon:c=e.jsx(Be,{style:{fontSize:"20px",fill:"var(--text-grey)",width:"20px"}}),tooltipOverrides:w}){return e.jsx(e.Fragment,{children:e.jsx(pe,{title:r,color:"var(--card-bg)",className:"pointer",overlayInnerStyle:{padding:"15px"},...w,children:c})})}function Ve({selectedTokenCallback:r}){var C;const[{arweaveDataProvider:c}]=ie(),[{walletAddress:w}]=oe(),[n,j]=l.useState(),[p,f]=l.useState(),[H,g]=l.useState(!1),[d,N]=l.useState(),[m,R]=l.useState(void 0),[I,O]=l.useState(!1),[L,B]=l.useState(!1),[M,P]=l.useState(void 0),X=ce("name-token-input"),k=l.useRef(null),[T,S]=l.useState(1),A=3;l.useEffect(()=>{r(m?new U(m.id):void 0),S(1)},[m]),l.useEffect(()=>{if(k.current)return document.addEventListener("click",E),()=>{document.removeEventListener("click",E)}},[k]);function E(t){k.current&&t.target!==k.current&&!k.current.contains(t.target)&&(j(""),B(!1),N(void 0),S(1))}async function V(t,o=[]){try{if(g(!0),!t)throw new Error("No address provided");const a=[],x=o.length?await Promise.all(o.map(async s=>{try{const u=ee.init({processId:s.toString()}),_=await u.getInfo();if(!u||!_)throw new Error("Unable to get contract");return P(!0),s}catch(u){F.emit("error",u)}})).then(s=>s.filter(u=>!!u)):[];if(!a.length&&!x.length)return;const h=a.concat(x),y=await c.getRecords({filters:{processId:h}}),b=await Promise.all(h.map(async s=>{const u=ee.init({processId:s.toString()}),_=Object.keys(y).reduce((W,K)=>(y[K].processId===s.toString()&&(W[K]=y[K]),W),{}),[J,q,Q,Z]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:s,names:_,owner:J,controllers:q,ticker:Q,name:Z}})).then(s=>s.filter(u=>!!u));if(!b.length)throw new Error("Unable to get details for Name Tokens");const D=b.reduce(async(s,u)=>{const{processId:_,owner:J,controllers:q,name:Q,ticker:Z,names:W}=u;return{...s,[_.toString()]:{owner:J,controllers:q,name:Q,ticker:Z,names:Object.keys(W)}}},{});if(f(await D),x.length){const s=D[x[0].toString()];R({name:s==null?void 0:s.name,ticker:s==null?void 0:s.ticker,id:x[0].toString(),names:(s==null?void 0:s.names)??[]})}}catch(a){F.emit("error",a)}finally{g(!1),S(1)}}function G(t){try{if(O(!0),P(void 0),!t){j("");return}if(j(t),!p)throw new Error("No Name Tokens Found");const o=Object.keys(p).filter(a=>{const{owner:x,controllers:h,name:y,ticker:b}=p[a];return[x,h,y,b,a].some(s=>s&&s.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:x,ticker:h,names:y}=p[a];return{id:a,name:x??"",ticker:h??"",names:y}}).filter(a=>!!a);if(!o.length)throw new Error("No ANT tokens found for that search");N(o)}catch{N(void 0)}finally{O(!1),S(1)}}function z({id:t,name:o,ticker:a,names:x}){try{if(j(""),N(void 0),t===void 0)throw new Error(`No ID provided for ${o??a??""}`);R({id:t,name:o??"",ticker:a??"",names:x}),r(new U(t)),S(1)}catch(h){F.emit("error",h)}finally{B(!1)}}const $=(t,o,a)=>{if(p&&!(o==="next"||o==="prev"))return o==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:T==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function i(t){S(t)}return e.jsxs("div",{ref:k,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:X||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0,boxSizing:"border-box"},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(le,{inputId:"name-token-input",onClick:()=>B(!0),showValidationIcon:!0,setValue:t=>G(t.length===me?t.trim():t),value:n??"",maxCharLength:fe,placeholder:m?(C=m.name)!=null&&C.length?m.name:m.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>c.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${m?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${m?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:H||I?e.jsx(xe,{size:20,color:"var(--text-white)"}):n&&M===!1?e.jsx(e.Fragment,{}):n&&ue(n)&&!Object.keys(p??[]).includes(n)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{V(w,[new U(n)])},children:"Import"}):m?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{R(void 0),r(void 0)},children:[e.jsx(ge,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(Y,{message:"For advanced use cases only, you can register this name with a custom ANT by entering its Process ID."})})]}),p&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[n&&!(d!=null&&d.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):d?d.slice(Math.max((T-1)*A,0),T*A).map((t,o)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(x=>e.jsx("span",{children:x},x))})},o):e.jsx(e.Fragment,{})]},o)}):Object.entries(p).slice(Math.max((T-1)*A,0),T*A).map((t,o)=>{if(!t)return;const[a,x]=t,{name:h,ticker:y,names:b}=x;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:a,name:h??"",ticker:y??"",names:b??[]})},children:[h&&y?`${h.slice(0,20)} ${h.length>20?"...":""} (${y}) - ${a}`:a,b!=null&&b.length?e.jsx(Y,{icon:e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"}),message:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:b.map(D=>e.jsx("span",{children:D},D))})}):e.jsx(e.Fragment,{})]},o)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[p.length||d!=null&&d.length||!n?e.jsx(he,{total:Object.keys(p).length&&!d?Object.keys(p).length:d?d.length:0,itemRender:$,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:i,current:T,defaultPageSize:A}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Me(){const[{domain:r,fee:c,leaseDuration:w,registrationType:n,antID:j,targetId:p},f]=we(),[{arweaveDataProvider:H,ioTicker:g,arioContract:d}]=ie(),[{walletAddress:N,balances:m}]=oe(),[,R]=ye(),{name:I}=ve(),{loading:O}=be(I??r),[L,B]=l.useState(),M=ce("target-id-input"),P=Se(),[X,k]=je(),[T,S]=l.useState(!1),[A,E]=l.useState(!1),V=c==null?void 0:c[g],G=V&&V<0;l.useEffect(()=>{if(X.get("redirect")&&I){if(!m[g])return;k(),$();return}},[m,c]),l.useEffect(()=>{if(!d||!r||!g||!n)return;(async()=>{f({type:"setFee",payload:{ar:0,[g]:void 0}}),E(!0);const C=await d.getTokenCost({intent:"Buy-Record",name:r,purchaseType:n,years:w}).then(t=>new te(t).toIO().valueOf()).catch(()=>{});E(!1),f({type:"setFee",payload:{ar:0,[g]:C}})})()},[d,f,r,g,w,n]),l.useEffect(()=>{I&&r!==I&&f({type:"setDomainName",payload:I})},[I,r]);async function z(i){if(!i){f({type:"setANTID",payload:void 0});return}if(f({type:"setANTID",payload:i}),!ee.init({processId:i.toString()}))throw new Error("Contract not found")}if(!n)return e.jsx(xe,{size:80});async function $(){try{if(!N){const a=new URLSearchParams({redirect:"true"});P("/connect",{state:{to:`/register/${r}?${a.toString()}`,from:`/register/${r}`}});return}E(!0);const t=await d.getBalance({address:N.toString()}).then(a=>new te(a).toIO()),o=Ne({balances:{AR:m.ar,[g]:t.valueOf()},costs:{AR:c.ar,[g]:c[g]}});if(o.length){o.forEach(a=>{F.emit("error",new Ie(a.message))});return}if(G)throw new Error("Issue calculating transaction cost.");if(T)throw new ke("Please fix the errors above before continuing.")}catch(t){F.emit("error",t),E(!1);return}finally{E(!1)}const i=r&&Te().test(r)?Ee(r):r,C={name:i,processId:(j==null?void 0:j.toString())??"atomic",years:n===v.LEASE?w:void 0,type:n,targetId:p,state:Re(i,N,p)};R({type:"setTransactionData",payload:{assetId:Ae.toString(),functionName:"buyRecord",...C,interactionPrice:c==null?void 0:c[g]}}),R({type:"setInteractionType",payload:ae.BUY_RECORD}),f({type:"reset"}),R({type:"setWorkflowName",payload:ae.BUY_RECORD}),P("/transaction/review",{state:`/register/${r}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Ce,{message:"Loading Domain info, please wait.",loading:O}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",margin:"50px",gap:"80px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"40px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Oe,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[r," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Pe,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"25px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>f({type:"setRegistrationType",payload:v.LEASE}),style:{position:"relative",background:n===v.LEASE?"var(--text-white)":"",color:n===v.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",n===v.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:n===v.BUY?"var(--text-white)":"",color:n===v.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>f({type:"setRegistrationType",payload:v.BUY}),children:["Buy"," ",n===v.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"35px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:n===v.LEASE?e.jsx(_e,{value:w,setValue:i=>{f({type:"setLeaseDuration",payload:i})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:w>1?"years":"year",detail:`Until ${De(Date.now()+w*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):n===v.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(Ve,{selectedTokenCallback:i=>z(i)}),e.jsxs("div",{className:"name-token-input-wrapper",style:{border:M||L?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(le,{inputId:"target-id-input",value:L??"",setValue:i=>{B(i.trim()),ue(i.trim())&&f({type:"setTargetId",payload:new U(i.trim())}),i.trim().length===0&&S(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:i=>H.validateArweaveId(i)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:i=>{S(!i)}}),e.jsx("span",{className:"flex flex-row text grey flex-center",style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:e.jsx(Y,{message:"The Target ID is the Arweave Transaction ID that will be resolved at the root of this ArNS name"})})]}),e.jsx(Fe,{ioRequired:!0,fee:c,feeWrapperStyle:{alignItems:"flex-start"}}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx(Le,{nextText:"Next",backText:"Back",onNext:A?void 0:$,onBack:()=>P("/",{state:`/register/${r}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{Me as default};
//# sourceMappingURL=Register-82d994de.js.map

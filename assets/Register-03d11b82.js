import{B as oe,b as ie,r as l,a7 as le,A as U,j as e,V as ce,X as pe,a8 as fe,I as de,a3 as xe,J as ue,a9 as me,T as Y,P as he,aa as ee,f as _,ab as ge,c as we,u as ye,ac as ve,a as be,ad as Se,ae as te,af as je,ag as Ne,ah as ke,ai as Ie,aj as Ee,ak as y,al as Te,am as Ae,an as ae,ao as Re,ap as Ce,aq as re,M as se,ar as Pe,as as De}from"./index-d334f754.js";import{C as Le}from"./Counter-71d7434e.js";import{S as ne}from"./HamburgerOutline-40a14356.js";import{T as Be}from"./TransactionCost-dea13bb4.js";import{S as Oe}from"./StepProgressBar-38924e38.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new Error().stack;c&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[c]="d1984cd3-5742-4686-8633-f3563d170d9c",s._sentryDebugIdIdentifier="sentry-dbid-d1984cd3-5742-4686-8633-f3563d170d9c")}catch{}})();function _e({selectedTokenCallback:s}){var C;const[{arweaveDataProvider:c}]=oe(),[{walletAddress:b}]=ie(),[n,j]=l.useState(),[p,m]=l.useState(),[M,h]=l.useState(!1),[d,N]=l.useState(),[f,A]=l.useState(void 0),[k,F]=l.useState(!1),[L,B]=l.useState(!1),[H,P]=l.useState(void 0),X=le("name-token-input"),I=l.useRef(null),[E,S]=l.useState(1),R=3;l.useEffect(()=>{s(f?new U(f.id):void 0),S(1)},[f]),l.useEffect(()=>{if(I.current)return document.addEventListener("click",T),()=>{document.removeEventListener("click",T)}},[I]);function T(t){I.current&&t.target!==I.current&&!I.current.contains(t.target)&&(j(""),B(!1),N(void 0),S(1))}async function V(t,i=[]){try{if(h(!0),!t)throw new Error("No address provided");const a=[],x=i.length?await Promise.all(i.map(async r=>{try{const u=ee.init({processId:r.toString()}),O=await u.getInfo();if(!u||!O)throw new Error("Unable to get contract");return P(!0),r}catch(u){_.emit("error",u)}})).then(r=>r.filter(u=>!!u)):[];if(!a.length&&!x.length)return;const g=a.concat(x),w=await c.getRecords({filters:{processId:g}}),v=await Promise.all(g.map(async r=>{const u=ee.init({processId:r.toString()}),O=Object.keys(w).reduce((W,K)=>(w[K].processId===r.toString()&&(W[K]=w[K]),W),{}),[J,q,Q,Z]=await Promise.all([u.getOwner(),u.getControllers(),u.getTicker(),u.getName()]).catch(()=>{throw new Error("Unable to get contract details")});return{processId:r,names:O,owner:J,controllers:q,ticker:Q,name:Z}})).then(r=>r.filter(u=>!!u));if(!v.length)throw new Error("Unable to get details for Name Tokens");const D=v.reduce(async(r,u)=>{const{processId:O,owner:J,controllers:q,name:Q,ticker:Z,names:W}=u;return{...r,[O.toString()]:{owner:J,controllers:q,name:Q,ticker:Z,names:Object.keys(W)}}},{});if(m(await D),x.length){const r=D[x[0].toString()];A({name:r==null?void 0:r.name,ticker:r==null?void 0:r.ticker,id:x[0].toString(),names:(r==null?void 0:r.names)??[]})}}catch(a){_.emit("error",a)}finally{h(!1),S(1)}}function G(t){try{if(F(!0),P(void 0),!t){j("");return}if(j(t),!p)throw new Error("No Name Tokens Found");const i=Object.keys(p).filter(a=>{const{owner:x,controllers:g,name:w,ticker:v}=p[a];return[x,g,w,v,a].some(r=>r&&r.toString().toLowerCase().includes(t.toLowerCase()))}).map(a=>{const{name:x,ticker:g,names:w}=p[a];return{id:a,name:x??"",ticker:g??"",names:w}}).filter(a=>!!a);if(!i.length)throw new Error("No ANT tokens found for that search");N(i)}catch{N(void 0)}finally{F(!1),S(1)}}function z({id:t,name:i,ticker:a,names:x}){try{if(j(""),N(void 0),t===void 0)throw new Error(`No ID provided for ${i??a??""}`);A({id:t,name:i??"",ticker:a??"",names:x}),s(new U(t)),S(1)}catch(g){_.emit("error",g)}finally{B(!1)}}const $=(t,i,a)=>{if(p&&!(i==="next"||i==="prev"))return i==="page"?e.jsx("span",{className:"flex flex-row hover center",style:{color:E==t?"white":"var(--text-grey)",width:"32px"},children:t}):a};function o(t){S(t)}return e.jsxs("div",{ref:I,className:"flex flex-column radius",style:{position:"relative",height:"fit-content",maxHeight:"400px",border:X||L?"1px solid var(--text-white)":"1px solid var(--text-faded)",gap:0},children:[e.jsxs("div",{className:"name-token-input-wrapper",style:{borderBottom:"1px solid var(--text-faded)"},children:[e.jsx(ce,{inputId:"name-token-input",onClick:()=>B(!0),showValidationIcon:!0,setValue:t=>G(t.length===pe?t.trim():t),value:n??"",maxCharLength:fe,placeholder:f?(C=f.name)!=null&&C.length?f.name:f.id:"Add an Arweave Name Token (ANT)",validationPredicates:{[de.ARWEAVE_ID]:{fn:t=>c.validateArweaveId(t)}},validityCallback:t=>t,wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box",paddingLeft:"10px"},inputClassName:`white ${f?"name-token-input-selected":"name-token-input"}`}),e.jsx("span",{className:`flex flex-row text grey flex-center ${f?"bold":""} hover`,style:{width:"fit-content",height:"fit-content",wordBreak:"keep-all"},children:M||k?e.jsx(xe,{size:20,color:"var(--text-white)"}):n&&H===!1?e.jsx(e.Fragment,{}):n&&ue(n)&&!Object.keys(p??[]).includes(n)?e.jsx("button",{className:"outline-button flex flex-row center pointer",style:{borderRadius:"50px",width:"fit-content",padding:"3px 6px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{V(b,[new U(n)])},children:"Import"}):f?e.jsxs("button",{className:"outline-button flex flex-row center pointer",style:{gap:"3px",borderRadius:"50px",width:"fit-content",padding:"3px 7px",fontSize:"12px",minWidth:"fit-content",border:"1px solid var(--text-grey)"},onClick:()=>{A(void 0),s(void 0)},children:[e.jsx(me,{width:"13px",height:"13px"}),"Remove"]}):e.jsx(Y,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"You can import an ANT by entering its process ID, or search for one of your own by name, ticker, owner, or controller status, as well is its own process ID",children:"Optional"})})]}),p&&L?e.jsxs("div",{className:"flex flex-column",style:{alignItems:"flex-start",justifyContent:"flex-start",gap:0,height:"fit-content",width:"100%",backgroundColor:"var(--card-bg)",boxSizing:"border-box",zIndex:10},children:[n&&!(d!=null&&d.length)?e.jsx("span",{className:"text-large center",style:{color:"#444547",margin:"auto",height:"50px"},children:"No Results"}):d?d.slice(Math.max((E-1)*R,0),E*R).map((t,i)=>{var a;if(t)return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:t.id,name:t.name??"",ticker:t.ticker??"",names:t.names??[]})},children:[t.name&&t.ticker?`${t.name.slice(0,20)} (${t.ticker}) - ${t.id}`:t.id,(a=t.names)!=null&&a.length?e.jsxs(Y,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",gap:"5px",boxSizing:"border-box"},children:t.names.map(x=>e.jsx("span",{children:x},x))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"})," "]},i):e.jsx(e.Fragment,{})]},i)}):Object.entries(p).slice(Math.max((E-1)*R,0),E*R).map((t,i)=>{if(!t)return;const[a,x]=t,{name:g,ticker:w,names:v}=x;return e.jsxs("button",{className:"name-token-item pointer",onClick:()=>{z({id:a,name:g??"",ticker:w??"",names:v??[]})},children:[g&&w?`${g.slice(0,20)} ${g.length>20?"...":""} (${w}) - ${a}`:a,v!=null&&v.length?e.jsxs(Y,{title:e.jsx("div",{className:"flex flex-column",style:{padding:"5px",boxSizing:"border-box"},children:v.map(D=>e.jsx("span",{children:D},D))}),color:"var(--card-bg)",placement:"top",showArrow:!0,children:[e.jsx(ne,{width:20,height:20,fill:"var(--text-grey)"})," "]}):e.jsx(e.Fragment,{})]},i)}),e.jsxs("div",{className:"custom-next-pagination flex flex-column",style:{padding:"10px 25px",boxSizing:"border-box",width:"100%",justifyContent:"flex-start"},children:[p.length||d!=null&&d.length||!n?e.jsx(he,{total:Object.keys(p).length&&!d?Object.keys(p).length:d?d.length:0,itemRender:$,showPrevNextJumpers:!0,showSizeChanger:!1,showQuickJumper:!1,onChange:o,current:E,defaultPageSize:R}):e.jsx(e.Fragment,{})," "]})]}):e.jsx(e.Fragment,{})]})}function Ue(){const[{domain:s,fee:c,leaseDuration:b,registrationType:n,antID:j,targetId:p},m]=ge(),[{arweaveDataProvider:M,ioTicker:h,arioContract:d}]=oe(),[{walletAddress:N,balances:f}]=ie(),[,A]=we(),{name:k}=ye(),{loading:F}=ve(k??s),[L,B]=l.useState(),H=le("target-id-input"),P=be(),[X,I]=Se(),[E,S]=l.useState(!1),[R,T]=l.useState(!1),V=c==null?void 0:c[h],G=V&&V<0;l.useEffect(()=>{if(X.get("redirect")&&k){if(!f[h])return;I(),$();return}},[f,c]),l.useEffect(()=>{if(!d||!s||!h||!n)return;(async()=>{m({type:"setFee",payload:{ar:0,[h]:void 0}}),T(!0);const C=await d.getTokenCost({intent:"Buy-Record",name:s,purchaseType:n,years:b}).then(t=>new te(t).toIO().valueOf()).catch(()=>{});T(!1),m({type:"setFee",payload:{ar:0,[h]:C}})})()},[d,m,s,h,b,n]),l.useEffect(()=>{k&&s!==k&&m({type:"setDomainName",payload:k})},[k,s]);async function z(o){if(!o){m({type:"setANTID",payload:void 0});return}if(m({type:"setANTID",payload:o}),!ee.init({processId:o.toString()}))throw new Error("Contract not found")}if(!n)return e.jsx(xe,{size:80});async function $(){try{if(!N){const a=new URLSearchParams({redirect:"true"});P("/connect",{state:{to:`/register/${s}?${a.toString()}`,from:`/register/${s}`}});return}T(!0);const t=await d.getBalance({address:N.toString()}).then(a=>new te(a).toIO()),i=je({balances:{AR:f.ar,[h]:t.valueOf()},costs:{AR:c.ar,[h]:c[h]}});if(i.length){i.forEach(a=>{_.emit("error",new Ne(a.message))});return}if(G)throw new Error("Issue calculating transaction cost.");if(E)throw new ke("Please fix the errors above before continuing.")}catch(t){_.emit("error",t),T(!1);return}finally{T(!1)}const o=s&&Ie().test(s)?Ee(s):s,C={name:o,processId:(j==null?void 0:j.toString())??"atomic",years:n===y.LEASE?b:void 0,type:n,targetId:p,state:Te(o,N,p)};A({type:"setTransactionData",payload:{assetId:Ae.toString(),functionName:"buyRecord",...C,interactionPrice:c==null?void 0:c[h]}}),A({type:"setInteractionType",payload:ae.BUY_RECORD}),m({type:"reset"}),A({type:"setWorkflowName",payload:ae.BUY_RECORD}),P("/transaction/review",{state:`/register/${s}`})}return e.jsxs("div",{className:"page center",children:[e.jsx(Re,{message:"Loading Domain info, please wait.",loading:F}),e.jsxs("div",{className:"flex flex-column flex-center",style:{maxWidth:"900px",width:"100%",padding:"0px",margin:"50px",gap:"80px",boxSizing:"border-box"},children:[e.jsx("div",{className:"flex flex-row flex-center",style:{paddingBottom:"40px",borderBottom:"solid 1px var(--text-faded)"},children:e.jsx(Oe,{stages:[{title:"Choose",description:"Pick a name",status:"finish"},{title:"Configure",description:"Registration Period",status:"process"},{title:"Confirm",description:"Review transaction",status:"wait"}],stage:1})}),e.jsxs("span",{className:"text-medium white center",style:{fontWeight:"500px",fontSize:"23px",gap:"15px"},children:[e.jsxs("span",{style:{color:"var(--success-green)"},children:[s," ",e.jsx("span",{className:"white",children:"is available!"})]})," ",e.jsx(Ce,{style:{fontSize:"20px",color:"var(--success-green)"}})]}),e.jsxs("div",{className:"flex flex-column flex-center",children:[e.jsxs("div",{className:"flex flex-column flex-center",style:{width:"100%",height:"fit-content",gap:"25px"},children:[e.jsxs("div",{className:"flex flex-row flex-space-between",style:{gap:"25px"},children:[e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",onClick:()=>m({type:"setRegistrationType",payload:y.LEASE}),style:{position:"relative",background:n===y.LEASE?"var(--text-white)":"",color:n===y.LEASE?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},children:["Lease"," ",n===y.LEASE?e.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]}),e.jsxs("button",{className:"flex flex-row center text-medium bold pointer",style:{position:"relative",background:n===y.BUY?"var(--text-white)":"",color:n===y.BUY?"var(--text-black)":"var(--text-white)",border:"solid 2px var(--text-faded)",borderRadius:"var(--corner-radius)",height:"56px",borderBottomWidth:"0.5px"},onClick:()=>m({type:"setRegistrationType",payload:y.BUY}),children:["Buy"," ",n===y.BUY?e.jsx("div",{style:{position:"absolute",bottom:-6,left:"50%",transform:"rotate(45deg)",width:"11px",height:"11px",background:"var(--text-white)"}}):e.jsx(e.Fragment,{})]})]}),e.jsx("div",{className:"flex flex-column flex-center card",style:{width:"100%",minHeight:"0px",height:"fit-content",maxWidth:"unset",padding:"35px",boxSizing:"border-box",borderTopWidth:"0.2px",borderRadius:"var(--corner-radius)",justifyContent:"flex-start"},children:n===y.LEASE?e.jsx(Le,{value:b,setValue:o=>{m({type:"setLeaseDuration",payload:o})},minValue:re,maxValue:se,valueStyle:{padding:"20px 120px"},valueName:b>1?"years":"year",detail:`Until ${Pe(Date.now()+b*365*24*60*60*1e3)}`,title:e.jsx("span",{className:"white",style:{padding:"0px 10px 10px 10px",fontWeight:"500"},children:`Registration period (between ${re}-${se} years)`})}):n===y.BUY?e.jsxs("div",{className:"flex flex-column flex-center",style:{gap:"1em"},children:[e.jsx("span",{className:"text-medium grey center",children:"Registration Period"}),e.jsx("span",{className:"text-medium white center",children:"Permanent"})]}):e.jsx(e.Fragment,{})})]}),e.jsxs("div",{className:"flex flex-column",style:{gap:"1em"},children:[e.jsx(_e,{selectedTokenCallback:o=>z(o)}),e.jsxs("div",{className:"name-token-input-wrapper",style:{border:H||L?"solid 1px var(--text-white)":"solid 1px var(--text-faded)",position:"relative"},children:[e.jsx(ce,{inputId:"target-id-input",value:L??"",setValue:o=>{B(o.trim()),ue(o.trim())&&m({type:"setTargetId",payload:new U(o.trim())}),o.trim().length===0&&S(!1)},wrapperCustomStyle:{width:"100%",hieght:"45px",borderRadius:"0px",backgroundColor:"var(--card-bg)",boxSizing:"border-box"},inputClassName:"white name-token-input",inputCustomStyle:{paddingLeft:"10px",background:"transparent"},maxCharLength:43,placeholder:"Arweave Transaction ID (Target ID)",validationPredicates:{[de.ARWEAVE_ID]:{fn:o=>M.validateArweaveId(o)}},showValidationChecklist:!1,showValidationIcon:!0,validityCallback:o=>{S(!o)}}),e.jsx("span",{className:"grey pointer hover",style:{fontSize:"12px"},children:e.jsx(Y,{placement:"right",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"190px",color:"var(--text-black)",textAlign:"center",fontFamily:"Rubik-Bold",fontSize:"14px",backgroundColor:"var(--text-white)",padding:"15px"},title:"The Target ID is the arweave ID that will be resolved by the ArNS name.",children:"Optional"})})]}),e.jsx(Be,{ioRequired:!0,fee:c,feeWrapperStyle:{alignItems:"flex-start"}}),e.jsx("div",{style:{marginTop:"30px"},children:e.jsx(De,{nextText:"Next",backText:"Back",onNext:R?void 0:$,onBack:()=>P("/",{state:`/register/${s}`}),customNextStyle:{width:"100px"}})})]})]})]})]})}export{Ue as default};
//# sourceMappingURL=Register-03d11b82.js.map

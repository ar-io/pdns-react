import{at as j,au as S,av as U,aw as k,ax as B,ay as L,an as d,l as y,az as I,aA as h,f as R,j as s,a as P,E as W,b as M,c as X,F,r as g,aB as T,aC as Y,ao as H,X as $,as as q,aD as z}from"./index-4b15107a.js";import{S as G}from"./Info-8b232c9f.js";import{T as J}from"./TransactionCost-077da441.js";import{S as V}from"./StepProgressBar-166513ef.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="46081eeb-1491-44e9-e280-58004682d9bb",e._sentryDebugIdIdentifier="sentry-dbid-46081eeb-1491-44e9-e280-58004682d9bb")}catch{}})();async function K({signer:e,module:a=U,luaCodeTxId:l=k,ao:c=B(),scheduler:u=L,state:i,stateContractTxId:n}){const r=await j.transactions.getData(l,{decode:!0,string:!0}),t=await c.spawn({module:a,scheduler:u,signer:await S.createAoSigner(e)}),o=new S({processId:t,ao:c});return await o.send({tags:[{name:"Action",value:"Eval"},{name:"App-Name",value:"ArNS-ANT"},{name:"Source-Code-TX-ID",value:l}],data:r,signer:e}),i&&await o.send({tags:[{name:"Action",value:"Initialize-State"},...n!==void 0?[{name:"State-Contract-TX-ID",value:n}]:[]],data:JSON.stringify(i),signer:e}),t}const Q="rYRd9foqUVvMScTnX63FuyUOaP5tmlJx5tG1btCx6sg";async function Z({payload:e,workflowName:a,owner:l,arioContract:c,processId:u,dispatch:i,signer:n}){let r,t;try{if(!c)throw new Error("ArIO provider is not defined");if(!n)throw new Error("signer is not defined");switch(i({type:"setSigning",payload:!0}),a){case d.BUY_RECORD:{const{name:x,type:w,years:m}=e;let p=e.processId;p==="atomic"&&(p=await K({state:e.state,signer:n,luaCodeTxId:Q}));const f=await c.buyRecord({name:y(x),type:w,years:m,processId:p});e.processId=p,r=f,t=h.BUY_RECORD;break}case d.EXTEND_LEASE:r=await c.extendLease({name:y(e.name),years:e.years},I),t=h.EXTEND_RECORD;break;case d.INCREASE_UNDERNAMES:r=await c.increaseUndernameLimit({name:y(e.name),increaseCount:e.qty},I),t=h.INCREASE_UNDERNAME_COUNT;break;default:throw new Error(`Unsupported workflow name: ${a}`)}}catch(x){R.emit("error",x)}finally{i({type:"setSigning",payload:!1})}if(!r)throw new Error("Failed to dispatch ArIO interaction");if(!t)throw new Error("Failed to set workflow name");const o={deployer:l.toString(),processId:u.toString(),id:r.id,payload:{...e,function:t},type:"interaction"};return i({type:"setWorkflowName",payload:a}),i({type:"setInteractionResult",payload:o}),o}function A({workflowName:e,...a}){switch(e){case d.INCREASE_UNDERNAMES:return`Increasing your undernames is paid in ${a.ioTicker} tokens.`;case d.EXTEND_LEASE:case d.BUY_RECORD:return`This includes a registration fee (paid in ${a.ioTicker} tokens).`;default:return}}function D({workflowName:e,...a}){switch(e){case d.INCREASE_UNDERNAMES:case d.EXTEND_LEASE:return s.jsx("h1",{className:"flex white",style:{width:"100%",paddingBottom:"30px"},children:"Review"});case d.BUY_RECORD:return"Review your Purchase";default:return}}function ne(){const e=P(),[{ioTicker:a,arioContract:l,arnsContractId:c}]=W(),[{walletAddress:u,wallet:i}]=M(),[{workflowName:n,interactionType:r,transactionData:t,interactionResult:o},x]=X(),w=F(),[m,p]=g.useState(),[f,_]=g.useState(T(r)),[E,b]=g.useState(D({workflowName:n})),[N,v]=g.useState(A({workflowName:n,ioTicker:a}));g.useEffect(()=>{if(!t&&!n){e("/");return}p(Y({interactionType:r,transactionData:{...t,deployedTransactionId:o==null?void 0:o.id}})),v(A({workflowName:n,ioTicker:a})),_(T(r)),b(D({workflowName:n}))},[t,o,n,r,u]);async function C(){try{if(!(l instanceof z))throw new Error("Wallet must be connected to dispatch transactions.");if(!t||!n)throw new Error("Transaction data is missing");if(!u)throw new Error("Wallet address is missing");await Z({arioContract:l,workflowName:n,payload:t,owner:u,processId:c,dispatch:x,signer:i==null?void 0:i.arconnectSigner}),e("/transaction/complete")}catch(O){R.emit("error",O)}}return m?s.jsx("div",{className:"page",children:s.jsxs("div",{className:"flex flex-column center",style:w?{}:{gap:"0px",maxWidth:"900px",width:"100%"},children:[f&&f.length?s.jsx("div",{className:"flex flex-row",style:{marginBottom:"30px",width:"100%"},children:s.jsx(V,{stage:3,stages:f})}):s.jsx(s.Fragment,{}),typeof E=="string"?s.jsx("div",{className:"flex flex-row text-large white bold center",style:{height:"100%",padding:"80px 0px",borderTop:f!=null&&f.length?"solid 1px var(--text-faded)":""},children:E}):E,s.jsx($,{...m,bordered:!0,compact:!1}),s.jsx(J,{fee:{[a]:t==null?void 0:t.interactionPrice},info:N&&s.jsxs("div",{className:"flex flex-row flex-left",style:{gap:"10px",maxWidth:"50%",justifyContent:"flex-start",alignItems:"flex-start"},children:[s.jsx(G,{width:"20px",height:"20px",fill:"var(--text-grey)"}),s.jsx("span",{className:"flex flex-column flex-left grey text",style:{textAlign:"left",lineHeight:"1.5em"},children:N})]})}),s.jsx("div",{className:"flex",style:{marginTop:20,width:"100%",justifyContent:"flex-end"},children:s.jsx(q,{onNext:()=>C(),onBack:()=>e(-1),backText:"Back",nextText:"Confirm"})})]})}):s.jsx(H,{loading:!0,message:"Loading transaction data..."})}export{ne as default};
//# sourceMappingURL=TransactionReview-e84226cf.js.map

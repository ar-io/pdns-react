import{u as Ce,a as Re,b as Ae,c as je,d as we,e as De,r as s,E as W,A as _e,F as Y,G as Me,H as Le,J as Oe,D as ke,g as Fe,K as Pe,N as Ve,f as Ue,h as ze,j as e,C as $e,i as R,O as Xe,T as Be,m as H,Q as Ge,L as We,k as Ye,l as He,n as Ke,V as qe,o as Je,p as Qe,M as K,q as Ze,s as q,U as et,t as g,v as tt,y as V,z as at,B as nt,I as J,w as U,x as st}from"./index-e4dea035.js";import{T as it,S as rt}from"./TransactionSuccessCard-c5613f20.js";import{S as ot,a as Q,T as lt,A as dt,R as ct}from"./RemoveControllerModal-dad9ae9f.js";import{S as ut}from"./HamburgerOutline-5e6e2ae5.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A=new Error().stack;A&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[A]="4ea3526e-7064-4711-e2be-da5d76bf63f9",i._sentryDebugIdIdentifier="sentry-dbid-4ea3526e-7064-4711-e2be-da5d76bf63f9")}catch{}})();const xt=["name","ticker","targetID","ttlSeconds"];function ht(){const{name:i}=Ce(),A=Re(),h=Ae(),Z=je(),[{arweaveDataProvider:b}]=we(),[{walletAddress:N}]=De(),[ee,te]=s.useState([]),[j,ae]=s.useState(!1),[w,ne]=s.useState(!1),[se,ie]=s.useState(),[T,z]=s.useState(!0),[re,D]=s.useState(!1),[oe,_]=s.useState(!1),[le,M]=s.useState(!1),[f,v]=s.useState(),[de,p]=s.useState(!1),[x,E]=s.useState(),[ce,y]=s.useState(),[O,$]=s.useState(),[k,ue]=s.useState([]),[I,C]=s.useState(),[c,xe]=s.useState(),[u,pe]=s.useState();s.useEffect(()=>{if(!i||!N){h("/manage/names");return}me(i)},[i,O]);async function me(a){var t;try{z(!0);const r=await b.getRecord({domain:W(a)}),o=r==null?void 0:r.contractTxId;if(!o)throw Error("This name is not registered");const d=new _e(o),[l,fe,B,he]=await Promise.all([b.buildANTContract(d),b.getTransactionStatus(d).then(m=>m[d.toString()].confirmations),b.getPendingContractInteractions(d),b.getRecords({filters:{contractTxId:[d]}})]);if(!l.isValid())throw Error("Invalid ANT contract");const G=Object.keys(he).filter(m=>m!==i),n=i?await b.getRecord({domain:W(i)}).catch(()=>{}):void 0;if(!n)throw Error("This name is not registered");const L=n!=null&&n.endTimestamp?Y(n.startTimestamp*1e3,n.endTimestamp*1e3):"Indefinite",be=()=>{if(n!=null&&n.endTimestamp){const m=Math.max(1,Y(n.startTimestamp*1e3,n.endTimestamp*1e3)),S=m>1?"years":"year";return`${m} ${S}`}return"Indefinite"};ae(L&&typeof L=="number"&&L>=Me||L==="Indefinite"),ie(n.undernames),ne(!!se&&n.undernames>=Le);const F={expiryDate:n!=null&&n.endTimestamp?+n.endTimestamp:"Indefinite",leaseDuration:`${be()}`,associatedNames:G.length?G.join(", "):"N/A",status:fe,name:l.name??"N/A",contractTxId:d.toString(),targetID:l.getRecord("@")&&Oe(l.getRecord("@").transactionId)?l.getRecord("@").transactionId:"N/A",ticker:l.ticker??"N/A",controllers:l.controllers.join(", ")??"N/A",owner:l.owner??"N/A",ttlSeconds:((t=l.getRecord("@"))==null?void 0:t.ttlSeconds)??ke,undernames:`${Fe(l.records)}/${((n==null?void 0:n.undernames)??Pe).toLocaleString()}`},Te=Ve(B,F),Se=Object.keys(F).reduce((m,S,ye)=>{const Ie=F[S],P=Te.find(Ee=>Ee.attribute===S),Ne=P?P.value:Ie,ve={attribute:S,value:Ne,key:ye,interactionType:Ue(S),pendingInteraction:P,editable:xt.includes(S)};return m.push(ve),m},[]);te(Se),xe(l),pe(d),ue(B),z(!1)}catch(r){ze.emit("error",r),h("/manage/names",{state:Z.pathname})}}function ge(a,t){switch(t.attribute){case"ttlSeconds":return{[V.VALID_TTL]:{fn:nt}};case"name":case"ticker":return{[V.VALID_ANT_NAME]:{fn:r=>at(r,q)}};case"targetID":case"controller":return{[V.ARWEAVE_ID]:{fn:r=>b.validateArweaveId(r)}};default:return{}}}function X(a){var r,o,d;if(!a.isValid||!a.interactionType||!c)return;const t=a.interactionType===J.SET_TARGET_ID?U(a.interactionType,["@",I.toString(),((r=c.getRecord("@"))==null?void 0:r.ttlSeconds)??K]):a.interactionType===J.SET_TTL_SECONDS?U(a.interactionType,["@",(d=(o=c.getRecord("@"))==null?void 0:o.transactionId)!=null&&d.length?c.getRecord("@").transactionId:st,+I]):U(a.interactionType,I.toString());if(t&&a.interactionType&&u){const l={...t,assetId:u};E(a.interactionType),y(l),p(!0)}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page",style:{gap:"30px"},children:[O&&x?e.jsx(it,{txId:O,title:$e[x].successHeader,close:()=>{$(void 0),E(void 0)}}):e.jsx(e.Fragment,{}),e.jsxs("div",{className:"flex flex-row",style:{justifyContent:"space-between",width:"100%"},children:[e.jsxs("h2",{className:"flex white center",style:{gap:"16px"},children:[e.jsx(ut,{width:"20px",height:"20px",fill:"var(--text-white)"}),i]}),e.jsxs("div",{className:"flex flex-row",style:{gap:"20px",width:"fit-content"},children:[e.jsx(R,{trigger:["hover"],title:w?"Max undername support reached":"Increase undername support",color:"#222224",placement:"top",rootClassName:"notification-tooltip",children:e.jsx("button",{disabled:T||w,className:`button-secondary ${T||w?"disabled-button":"hover"}`,style:{padding:T||w?"0px":"9px",gap:"8px",fontSize:"14px",color:"var(--accent)",fontFamily:"Rubik"},onClick:()=>h(`/manage/names/${i}/upgrade-undernames`),children:"Increase Undernames"})}),e.jsx(R,{trigger:["hover"],title:j?"Max lease duration reached":"Extend lease",color:"#222224",placement:"top",rootClassName:"notification-tooltip",children:e.jsx("button",{disabled:T||j,className:`button-primary ${T||j?"disabled-button":"hover"}`,style:{padding:T||j?"0px":"9px",gap:"8px",fontSize:"14px",color:"var(--text-black)",fontFamily:"Rubik"},onClick:()=>h(`/manage/names/${i}/extend`),children:"Extend Lease"})})]})]}),e.jsx("div",{className:"flex-row center",children:T||!c?e.jsx("div",{className:"flex",style:{padding:"10%"},children:e.jsx(Xe,{size:80})}):e.jsx(Be,{showHeader:!1,style:{width:"100%"},onRow:a=>({className:a.attribute===f?"active-row":""}),scroll:{x:!0},pagination:!1,prefixCls:"manage-ant-table",columns:[{title:"",dataIndex:"attribute",key:"attribute",align:"left",width:A?"0px":"20%",className:"grey whitespace-no-wrap",render:a=>`${H(a)}:`},{title:"",dataIndex:"value",key:"value",align:"left",width:"70%",className:"white",render:(a,t)=>{const r=t.attribute===f;return t.attribute==="expiryDate"&&typeof a=="number"?e.jsx("span",{style:{color:a*1e3>Date.now()?"var(--success-green)":a*1e3+Ge*1e3<Date.now()?"var(--accent)":"var(--error-red)"},children:Intl.DateTimeFormat("en-US").format(a*1e3)}):t.attribute==="status"&&k?e.jsx(R,{placement:"right",title:k.map((o,d)=>e.jsxs(We,{className:"link white text underline",to:`https://viewblock.io/arweave/tx/${o.contractTxId}`,target:"_blank",children:["There is a pending transaction modifying this field.",e.jsx(Ye,{height:12,width:12,fill:"var(--text-white)"})]},"interaction-"+d)),showArrow:!0,overlayStyle:{maxWidth:"fit-content"},children:k.length?e.jsx(Ke,{height:20,width:20,fill:"var(--accent)"}):e.jsx(He,{confirmations:+a})}):t.attribute==="undernames"?e.jsxs("span",{className:"flex center",style:{justifyContent:"flex-start",gap:"10px"},children:[a,e.jsx(ot,{width:"20px",height:"20px",fill:"var(--text-grey)"})]}):t.editable?e.jsx(e.Fragment,{children:e.jsx(qe,{customPattern:t.attribute==="targetID"?Je:t.attribute==="ttlSeconds"?Qe:void 0,catchInvalidInput:!0,showValidationIcon:t.attribute==f&&!!I,onPressEnter:()=>X(t),showValidationOutline:!1,inputId:t.attribute+"-input",minNumber:K,maxNumber:Ze,onClick:()=>{f!==t.attribute&&(v(t.attribute),C(a))},inputClassName:"flex",wrapperCustomStyle:{position:"relative",boxSizing:"border-box"},inputCustomStyle:{width:"100%",overflow:"hidden",fontSize:"13px",outline:"none",color:"white",alignContent:"center",borderBottom:"none",boxSizing:"border-box",...r?{background:"var(--card-bg)",borderRadius:"var(--corner-radius)",border:"1px solid var(--text-faded)",padding:"15px"}:{border:"none",background:"transparent"}},disabled:f!==t.attribute,placeholder:`Enter a ${H(t.attribute)}`,value:f===t.attribute?I:t.value,setValue:o=>{t.attribute===f&&C(o??"")},validityCallback:o=>{t.isValid=o},validationPredicates:ge(I,t),maxCharLength:o=>t.attribute==="name"||t.attribute==="ticker"?o.length<=q:t.attribute==="ttlSeconds"?o.length<=7:t.attribute==="targetID"?o.length<=43:!1})}):a}},{title:"",dataIndex:"action",key:"action",width:"10%",align:"right",className:"white",render:(a,t)=>t.editable&&c.getOwnershipStatus(N)?e.jsx(e.Fragment,{children:f!==t.attribute?e.jsx("button",{className:"button pointer hover",onClick:()=>{v(t.attribute),C(t.value)},style:{boxSizing:"border-box"},children:e.jsx(rt,{style:{width:"16px",height:"16px",fill:"var(--text-grey)",boxSizing:"border-box"}})}):e.jsxs("span",{className:"flex flex-row",style:{boxSizing:"border-box",gap:"10px"},children:[e.jsx("button",{className:"button bold grey pointer hover",style:{padding:"6px",fontSize:"13px",boxSizing:"border-box"},onClick:()=>v(""),children:"Cancel"}),e.jsx("button",{className:"button-primary hover",style:{padding:"9px 12px",fontSize:"13px",boxSizing:"border-box"},onClick:()=>X(t),children:"Save"})]})}):t.attribute==="owner"&&c.getOwnershipStatus(N)==="owner"?e.jsx("span",{className:"flex flex-right",children:e.jsx("button",{onClick:()=>D(!0),className:"button-secondary",style:{padding:"9px 12px",fontSize:"13px",boxSizing:"border-box",letterSpacing:"0.5px",fontWeight:500},children:"Transfer"})}):t.attribute==="controllers"&&c.getOwnershipStatus(N)==="owner"?e.jsx(R,{open:void 0,placement:"bottomRight",color:"var(--card-bg)",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"fit-content",border:"1px solid var(--text-faded)",padding:"9px 12px"},overlayStyle:{width:"fit-content"},trigger:"click",title:e.jsxs("div",{className:"flex-column flex",style:{gap:"10px"},children:[e.jsx("button",{className:"flex flex-right white pointer button",onClick:()=>_(!0),children:"Add Controller"}),e.jsx("button",{className:"flex flex-right white pointer button",onClick:()=>M(!0),children:"Remove Controller"})]}),children:e.jsx(Q,{width:"18px",height:"18px",fill:"var(--text-grey)",className:"pointer"})}):t.attribute==="undernames"?e.jsx(R,{placement:"bottomRight",color:"var(--card-bg)",autoAdjustOverflow:!0,arrow:!1,overlayInnerStyle:{width:"fit-content",border:"1px solid var(--text-faded)",padding:"9px 12px"},overlayStyle:{width:"fit-content"},trigger:"click",title:e.jsxs("div",{className:"flex-column flex",style:{gap:"10px"},children:[e.jsx("button",{className:"flex flex-right white pointer button",onClick:()=>h(`/manage/names/${i}/undernames`),children:"Manage"}),c!=null&&c.getOwnershipStatus(N)&&u?e.jsx("button",{className:"flex flex-right white pointer button",onClick:()=>{const r=new URLSearchParams({modal:et.CREATE});h(encodeURI(`/manage/names/${i}/undernames?${r.toString()}`))},children:"Add Undername"}):e.jsx(e.Fragment,{})]}),children:e.jsx(Q,{width:"18px",height:"18px",fill:"var(--text-grey)",className:"pointer"})}):a}],dataSource:ee})})]}),re&&u?e.jsx(lt,{closeModal:()=>D(!1),antId:u,payloadCallback:a=>{y(a),E(g.TRANSFER),p(!0),D(!1)}}):e.jsx(e.Fragment,{}),oe&&u?e.jsx(dt,{closeModal:()=>_(!1),antId:u,payloadCallback:a=>{y(a),E(g.SET_CONTROLLER),p(!0),_(!1)}}):e.jsx(e.Fragment,{}),le&&u?e.jsx(ct,{closeModal:()=>M(!1),antId:u,payloadCallback:a=>{y(a),E(g.REMOVE_CONTROLLER),p(!0),M(!1)}}):e.jsx(e.Fragment,{}),de&&x&&u?e.jsx(tt,{interactionType:x,payload:ce,close:()=>{p(!1),y(void 0),v(void 0),C(void 0)},cancel:()=>{if(x===g.TRANSFER){D(!0),p(!1);return}if(x===g.SET_CONTROLLER){_(!0),p(!1);return}if(x===g.REMOVE_CONTROLLER){M(!0),p(!1);return}p(!1),y(void 0),v(void 0),C(void 0)},cancelText:x===g.TRANSFER||x===g.SET_CONTROLLER||x===g.REMOVE_CONTROLLER?"Back":"Cancel",setDeployedTransactionId:a=>$(a),assetId:u}):e.jsx(e.Fragment,{})]})}export{ht as default};
//# sourceMappingURL=ManageDomain-a4183e74.js.map
